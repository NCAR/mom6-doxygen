<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DART CAM-SE: /Users/hkershaw/DART/Doxygen/DART/assimilation_code/modules/assimilation/filter_mod.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DART CAM-SE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4b8c547e68dcddf016c38a1b08f5c7a9.html">DART</a></li><li class="navelem"><a class="el" href="dir_45bc59af759ed40ec308edf679618634.html">assimilation_code</a></li><li class="navelem"><a class="el" href="dir_b72b743c828fcd5d2c7dc1877007622f.html">modules</a></li><li class="navelem"><a class="el" href="dir_d78ed87430fac0d960d4b4f65a0ced15.html">assimilation</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">filter_mod.f90</div></div>
</div><!--header-->
<div class="contents">
<a href="filter__mod_8f90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">! DART software - Copyright UCAR. This open source software is provided</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">! by UCAR, &quot;as is&quot;, without charge, subject to all terms of use at</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">! http://www.image.ucar.edu/DAReS/DART/DART_download</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html">    5</a></span><span class="keyword">module</span> <a class="code hl_namespace" href="namespacefilter__mod.html">filter_mod</a></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">!------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacetypes__mod.html">types_mod</a>,             <span class="keywordtype">only</span> : <a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>, <a class="code hl_variable" href="namespacetypes__mod.html#abf1cb9466172ca1d02137e70ce1ae7e3">i8</a>, <a class="code hl_variable" href="namespacetypes__mod.html#a487646d1dd17cda0f0920a943edfb077">missing_r8</a>, <a class="code hl_variable" href="namespacetypes__mod.html#a4693e78690b9e434602f5a8634988ccf">metadatalength</a>, <a class="code hl_variable" href="namespacetypes__mod.html#a1e2772ead7275ce0da368baa04c8cec7">max_num_doms</a>, <a class="code hl_variable" href="namespacetypes__mod.html#a2bcc059ce33ea404751ac973800ef87d">max_files</a></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceoptions__mod.html">options_mod</a>,           <span class="keywordtype">only</span> : <a class="code hl_function" href="namespaceoptions__mod.html#a536448bfef7c5c838d79e714ca7bbb6a">get_missing_ok_status</a>, <a class="code hl_function" href="namespaceoptions__mod.html#a66a52ec2d5459c7cdb514f26ea6e1c68">set_missing_ok_status</a></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceobs__sequence__mod.html">obs_sequence_mod</a>,      <span class="keywordtype">only</span> : <a class="code hl_function" href="namespaceobs__sequence__mod.html#a65bd44dd192cbaa173c1a6abb5e900e2">read_obs_seq</a>, <a class="code hl_struct" href="structobs__sequence__mod_1_1obs__type.html">obs_type</a>, <a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>,                  &amp;</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span>                                  <a class="code hl_function" href="namespaceobs__sequence__mod.html#a8126596a8e537768e04be706daec4254">get_obs_from_key</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d6f7b7025c6c9d400bdaa4a9d15013e">set_copy_meta_data</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a3373f7292e3704ca5ac594e939f0523f">get_copy_meta_data</a>,   &amp;</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span>                                  <a class="code hl_function" href="namespaceobs__sequence__mod.html#ae884000e024da5fcb714a50e3e07235e">get_obs_def</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a519ce153ee2d450b79117a730296dcc9">get_time_range_keys</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#ab79782b84c5c610876e5f96f6d64b895">set_obs_values</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#aef1831e41128a3eca03600ee6a9f0d46">set_obs</a>,  &amp;</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>                                  <a class="code hl_function" href="namespaceobs__sequence__mod.html#a24c15eefbff5a6484a7cf953678e6ca7">write_obs_seq</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a7a13675815775edb06f71a84fa09d334">get_num_obs</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#ad2d03abd4ff723482610c1bc35eee900">get_obs_values</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a0397f5139207309fc5807b9b3b69f1de">init_obs</a>,       &amp;</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>                                  <span class="keyword">assignment</span>(=), <a class="code hl_function" href="namespaceobs__sequence__mod.html#afdc0061940a4415db77188d81429ac97">get_num_copies</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a534a13c649cdf1bc6c1ab4684d185410">get_qc</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a251405e9c2065d7a5bdfb9d50617eb5a">get_num_qc</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#ae409f58556d2955357b70cce43648b0d">set_qc</a>,  &amp;</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>                                  <a class="code hl_function" href="namespaceobs__sequence__mod.html#af0206e62734fbd29cd26a3487e7a8997">static_init_obs_sequence</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a31c6f2a944a254a1a8d5c817d2c69cc5">destroy_obs</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a75c8a2e004f5e060234b1ce4e776356c">read_obs_seq_header</a>, &amp;</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>                                  <a class="code hl_function" href="namespaceobs__sequence__mod.html#aaf29a2edd6656bc1159b6e0b81d017bb">set_qc_meta_data</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a23ba15f0f119df95d4d528dd4c77636d">get_first_obs</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a0c1486accd611ac04e269ab6799e21ba">get_obs_time_range</a>,        &amp;</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>                                  <a class="code hl_function" href="namespaceobs__sequence__mod.html#aad650f058335a5d9f0215cd0f2426d9f">delete_obs_from_seq</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a2b5fc4db58ccaae0b5804d4e77e721f4">delete_seq_head</a>,                       &amp;</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>                                  <a class="code hl_function" href="namespaceobs__sequence__mod.html#a2e39be37600163c6a933b87aa1dcb367">delete_seq_tail</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a2a3abc0b65b16b2ab4c6f3f6f494bedf">replace_obs_values</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#af23b49f36e14be5744be1d6046c29299">replace_qc</a>,            &amp;</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>                                  <a class="code hl_function" href="namespaceobs__sequence__mod.html#a04453c924b6c433af2d05c3260432f5a">destroy_obs_sequence</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d0eb7fd4d5bf9d607023de100ac8a94">get_qc_meta_data</a>, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a84db51e90a66b42eb04d2fcb29e6d616">add_qc</a></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>                                 </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceobs__def__mod.html">obs_def_mod</a>,           <span class="keywordtype">only</span> : <a class="code hl_struct" href="structobs__def__mod_1_1obs__def__type.html">obs_def_type</a>, <a class="code hl_function" href="namespaceobs__def__mod.html#aee84192b347db927d7401173240157b8">get_obs_def_error_variance</a>, <a class="code hl_function" href="namespaceobs__def__mod.html#abe1a0f69f359ce770251b6e896e4f708">get_obs_def_time</a>, &amp;</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>                                  <a class="code hl_function" href="namespaceobs__def__mod.html#a766a4b5931e96b862d50f04ad5b56a1a">get_obs_def_type_of_obs</a></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceobs__def__utilities__mod.html">obs_def_utilities_mod</a>, <span class="keywordtype">only</span> : <a class="code hl_function" href="namespaceobs__def__utilities__mod.html#a3732608dacf5a1438cc02de8a53fb764">set_debug_fwd_op</a></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacetime__manager__mod.html">time_manager_mod</a>,      <span class="keywordtype">only</span> : <a class="code hl_struct" href="structtime__manager__mod_1_1time__type.html">time_type</a>, <a class="code hl_function" href="namespacetime__manager__mod.html#a579c796316d18ecb716c5face232cb8c">get_time</a>, <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>, <span class="keyword">operator</span>(/=), <span class="keyword">operator</span>(&gt;),   &amp;</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>                                  <span class="keyword">operator</span>(-), <a class="code hl_function" href="namespacetime__manager__mod.html#a4f3d8b893f84f06cc655708c58098435">print_time</a></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceutilities__mod.html">utilities_mod</a>,         <span class="keywordtype">only</span> : <a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>, <a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>, <a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>, <a class="code hl_variable" href="namespaceutilities__mod.html#ae928d8495bb269d07c2d8ae26390c5b2">e_dbg</a>,                         &amp;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>                                  <a class="code hl_variable" href="namespaceutilities__mod.html#a7f7028c1f8fd499c0964b9955a7c0149">logfileunit</a>, <a class="code hl_variable" href="namespaceutilities__mod.html#a2e4229a51f48d48570bb0b7d304662c3">nmlfileunit</a>, <a class="code hl_function" href="namespaceutilities__mod.html#ad297e7b3a121a9c280417846a9198ac9">timestamp</a>,                        &amp;</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>                                  <a class="code hl_function" href="namespaceutilities__mod.html#ae5919d9aaedac3ac4128d1d68ed05769">do_output</a>, <a class="code hl_function" href="namespaceutilities__mod.html#ad4d01f7f0f751b03c2480fb100dc7c6a">find_namelist_in_file</a>, <a class="code hl_function" href="namespaceutilities__mod.html#ada43bd6e7099952a626e082d7fa0e440">check_namelist_read</a>,      &amp;</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>                                  <a class="code hl_function" href="namespaceutilities__mod.html#a77ad7301456803b1c560cd7c75a37549">open_file</a>, <a class="code hl_function" href="namespaceutilities__mod.html#aaa23ed1a0469bb9addcd0de6c52645b8">close_file</a>, <a class="code hl_function" href="namespaceutilities__mod.html#ada0bc0fbdb62dda0a03f7b23a7de35aa">do_nml_file</a>, <a class="code hl_function" href="namespaceutilities__mod.html#a57146d1bf098cd251ef93abb838d1f30">do_nml_term</a>, <a class="code hl_function" href="namespaceutilities__mod.html#a3cd818255d7f98765915ab676582b413">to_upper</a>,  &amp;</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>                                  <a class="code hl_function" href="namespaceutilities__mod.html#aeafbbb638346cc6ff201d3d9db2ee25b">set_multiple_filename_lists</a>, <a class="code hl_function" href="namespaceutilities__mod.html#ae943a84ea3b7e8579a41d1f744f4be7f">find_textfile_dims</a></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceassim__model__mod.html">assim_model_mod</a>,       <span class="keywordtype">only</span> : <a class="code hl_function" href="namespaceassim__model__mod.html#a85453749da1f84414285aa89f143bfc6">static_init_assim_model</a>, get_model_size,                    &amp;</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>                                  <a class="code hl_function" href="namespaceassim__model__mod.html#aaaf9136986343075c66fc81616b24c43">end_assim_model</a>,  pert_model_copies, get_state_meta_data</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceassim__tools__mod.html">assim_tools_mod</a>,       <span class="keywordtype">only</span> : <a class="code hl_function" href="group__assim__tools.html#ga593869155163638696fb5a3f593a79b4">filter_assim</a>, <a class="code hl_function" href="group__assim__tools.html#gae6a5cb9fd7c12f32393a170017220a72">set_assim_tools_trace</a>, <a class="code hl_function" href="group__assim__tools.html#gac278264f661864a82a6e3ccdace43d54">test_state_copies</a></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceobs__model__mod.html">obs_model_mod</a>,         <span class="keywordtype">only</span> : <a class="code hl_function" href="namespaceobs__model__mod.html#ab274fdab0af4375f044a81cd6f27cb94">move_ahead</a>, <a class="code hl_function" href="namespaceobs__model__mod.html#a03fc749b8153a9183a25baa68e40b6b1">advance_state</a>, <a class="code hl_function" href="namespaceobs__model__mod.html#a5ba75c3d4925959b387beafb52538b89">set_obs_model_trace</a></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceensemble__manager__mod.html">ensemble_manager_mod</a>,  <span class="keywordtype">only</span> : <a class="code hl_function" href="namespaceensemble__manager__mod.html#a8e433f241a2a14ca4f6034f70ebe7cc9">init_ensemble_manager</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#af5913d365d22029f1cb212eabb965833">end_ensemble_manager</a>,                &amp;</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>                                  <a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#afeab8324b47d0683e6156f466d78ae63">get_copy</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a2974e8f65e2455080e426fb9ae228c13">get_my_num_copies</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a50a52ae3fca66fdf6cdc3494cff26e65">put_copy</a>,       &amp;</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>                                  <a class="code hl_function" href="namespaceensemble__manager__mod.html#a560cdc48f932d328a341116abe462455">all_vars_to_all_copies</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#ad77490836a39d93bafc07d1130b15d03">all_copies_to_all_vars</a>,             &amp;</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>                                  <a class="code hl_function" href="namespaceensemble__manager__mod.html#a0fabb5d192d3b09305b5e5e25f3cc39f">compute_copy_mean</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a0f0832a7c5cabfb5291cf174adcd6b0a">compute_copy_mean_sd</a>,                    &amp;</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>                                  <a class="code hl_function" href="namespaceensemble__manager__mod.html#abc9c33415ca313004a2385fbc7b6b5cb">compute_copy_mean_var</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a0ff9b71c42eb5e4c87d60428d4edd0db">duplicate_ens</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a77071efdef7cc8ea113667122f8a86ef">get_copy_owner_index</a>, &amp;</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>                                  <a class="code hl_function" href="namespaceensemble__manager__mod.html#a1500b736b8e9992f705b2c5af3870172">get_ensemble_time</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a6dba0cf88e6588f7c50b999e0242871b">set_ensemble_time</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a8484d5e765733567bfc5fc3ac349926c">broadcast_copy</a>,       &amp;</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>                                  <a class="code hl_function" href="namespaceensemble__manager__mod.html#acd680bca47a44ef5b88a7beff4843816">map_pe_to_task</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a9c12d5753063f93c6e6981ddd4960a99">copies_in_window</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a9f35904acaa6d026fc5d004a23104e23">set_num_extra_copies</a>,     &amp;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>                                  <a class="code hl_function" href="namespaceensemble__manager__mod.html#ad50c046a15db7895115f472f56cecf2e">get_allow_transpose</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#ad77490836a39d93bafc07d1130b15d03">all_copies_to_all_vars</a>,                &amp;</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>                                  <a class="code hl_function" href="namespaceensemble__manager__mod.html#a0b1af28e9b02fa19a22a44815e6994be">allocate_single_copy</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#ae290ccc4e130e2cc3280aff6a920eae5">allocate_vars</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a79ff62ccd778cc3782b91291991bbf1c">get_single_copy</a>,       &amp;</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>                                  <a class="code hl_function" href="namespaceensemble__manager__mod.html#adf4c59fd6a11b63ca3b348f09b860a16">put_single_copy</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a13c0b50b0f720b889565d4f7c69fa619">deallocate_single_copy</a>, <a class="code hl_function" href="namespaceensemble__manager__mod.html#a1c8d13ec99a69a57f877b584b59d993e">print_ens_handle</a></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span> </div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceadaptive__inflate__mod.html">adaptive_inflate_mod</a>,  <span class="keywordtype">only</span> : <a class="code hl_function" href="group__adaptive__inflate.html#ga3f51d4c989b159a9a447451cae99116e">do_ss_inflate</a>, <a class="code hl_function" href="group__adaptive__inflate.html#ga6b7b01c13f591ca5aaa2450cb0c18d2e">mean_from_restart</a>, <a class="code hl_function" href="group__adaptive__inflate.html#gae3900d28b408cedd58072e5b5d9515a7">sd_from_restart</a>,  &amp;</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>                                  <a class="code hl_function" href="group__adaptive__inflate.html#ga85001cecec972148adcec6c7ef31e1e5">inflate_ens</a>, <a class="code hl_function" href="group__adaptive__inflate.html#ga5e2b2164fc43832ae208ab74dbcbddbc">adaptive_inflate_init</a>,                 &amp;</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>                                  <a class="code hl_struct" href="structadaptive__inflate__mod_1_1adaptive__inflate__type.html">adaptive_inflate_type</a>, <a class="code hl_function" href="group__adaptive__inflate.html#ga04f520c0ed73033b24269c4624e537ee">set_inflation_mean_copy</a> ,    &amp;</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>                                  <a class="code hl_function" href="group__adaptive__inflate.html#gaf9ad03b403779b745244bc055e04c6fc">log_inflation_info</a>, <a class="code hl_function" href="group__adaptive__inflate.html#ga6cd0390aea56fdaa321b9fb3f58c5e99">set_inflation_sd_copy</a>,          &amp;</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>                                  <a class="code hl_function" href="group__adaptive__inflate.html#gabcdf2fa88b452f8772a4812d1696b2fb">get_minmax_task_zero</a>, <a class="code hl_function" href="group__adaptive__inflate.html#gaaa80278515e32002fc8dfa1a431482af">do_rtps_inflate</a>,              &amp;</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>                                  <a class="code hl_function" href="group__adaptive__inflate.html#ga9b7a2f79554831e034bf1a1ee85090ea">validate_inflate_options</a>, <a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>, <a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>, &amp;</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>                                  <a class="code hl_variable" href="group__adaptive__inflate.html#ga81a04174a5714a8630dd252999afa301">no_inflation</a>, <a class="code hl_variable" href="group__adaptive__inflate.html#gaa8d41eed01259f2e25d03340be3114ef">obs_inflation</a>, <a class="code hl_variable" href="group__adaptive__inflate.html#gaec84d7ffa9da5dbcbd5226e8f8786ba6">varying_ss_inflation</a>,  &amp;</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>                                  <a class="code hl_variable" href="group__adaptive__inflate.html#gaf8861082a4e0deb56ae02bda79e45dbe">single_ss_inflation</a>, <a class="code hl_variable" href="group__adaptive__inflate.html#ga0d3e082200dc5636420dacddccdd35a2">relaxation_to_prior_spread</a>,    &amp;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>                                  <a class="code hl_variable" href="group__adaptive__inflate.html#gabc7fca9bfb048d5f738b3da299e18765">enhanced_ss_inflation</a></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span> </div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacempi__utilities__mod.html">mpi_utilities_mod</a>,     <span class="keywordtype">only</span> : <a class="code hl_function" href="namespacempi__utilities__mod.html#ae08b6543f55b372bd6addea0eb1e04a0">my_task_id</a>, <a class="code hl_function" href="namespacempi__utilities__mod.html#a19228477ddb48773bf4fb3858c997d82">task_sync</a>, <a class="code hl_function" href="namespacempi__utilities__mod.html#a5d695a71f9877df21d7ff2a39dba9821">broadcast_send</a>, <a class="code hl_function" href="namespacempi__utilities__mod.html#abf5f213db52aac32b7f0bdf774d1a1d9">broadcast_recv</a>,      &amp;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>                                  <a class="code hl_function" href="namespacempi__utilities__mod.html#ae8ccd09884b18c6d167291247089bd27">task_count</a></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span> </div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacerandom__seq__mod.html">random_seq_mod</a>,        <span class="keywordtype">only</span> : <a class="code hl_struct" href="structrandom__seq__mod_1_1random__seq__type.html">random_seq_type</a>, <a class="code hl_function" href="namespacerandom__seq__mod.html#a89f70b37eedada36ce65245a8c2f84e6">init_random_seq</a>, <a class="code hl_function" href="namespacerandom__seq__mod.html#a70e7d279fc09edf6033d21e78dc41a3c">random_gaussian</a></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span> </div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacestate__vector__io__mod.html">state_vector_io_mod</a>,   <span class="keywordtype">only</span> : <a class="code hl_function" href="group__state__vector__io__mod.html#gaa022725c0fb4622a7ee3cc13eb92a2aa">state_vector_io_init</a>, <a class="code hl_function" href="group__state__vector__io__mod.html#ga2cf6bb0500d00f01633c84ba7fc0be63">read_state</a>, <a class="code hl_function" href="group__state__vector__io__mod.html#gab0cd1b1a5e523fff63e58b5e32aa137f">write_state</a>, &amp;</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>                                  <a class="code hl_function" href="group__state__vector__io__mod.html#gaa80af78515963bcd545f18c9349e8c87">set_stage_to_write</a>, <a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceio__filenames__mod.html">io_filenames_mod</a>,      <span class="keywordtype">only</span> : <a class="code hl_function" href="group__io__filenames__mod.html#ga29f2ee6ce9ec4ffb32c45586e7208e1c">io_filenames_init</a>, <a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>, &amp;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>                                  <a class="code hl_function" href="group__io__filenames__mod.html#ga0136923a3644e55ac4ddf7216026fbcd">combine_file_info</a>, <a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__file__metadata.html">set_file_metadata</a>,  &amp;</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>                                  <a class="code hl_function" href="group__io__filenames__mod.html#ga70cbfa7f0895d3a51ed17ebc7fea96fa">set_member_file_metadata</a>,  <a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>, &amp;</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>                                  <a class="code hl_function" href="group__io__filenames__mod.html#ga84a5562fae8dc096e6b2330ad8da4bbf">check_file_info_variable_shape</a>, &amp;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>                                  <a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>, <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a>, &amp;</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>                                  <a class="code hl_variable" href="group__io__filenames__mod.html#gaae140d2c2c3279b00cf73e97268b14e9">read_copy</a>, <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, <a class="code hl_variable" href="group__io__filenames__mod.html#ga519831c8d731b5b4fcc2b2d54cf54e1f">read_write_copy</a></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacedirect__netcdf__mod.html">direct_netcdf_mod</a>,     <span class="keywordtype">only</span> : <a class="code hl_function" href="group__direct__netcdf__mod.html#ga5da57561c4275530367b53a116303f9f">finalize_single_file_io</a>, <a class="code hl_function" href="group__direct__netcdf__mod.html#ga4db4441591f610b3e2c4d06480c28535">write_augmented_state</a>, &amp;</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>                                  <a class="code hl_function" href="group__direct__netcdf__mod.html#gafb7b451fc6de3f86bffb169fa700f668">nc_get_num_times</a></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span> </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacestate__structure__mod.html">state_structure_mod</a>,   <span class="keywordtype">only</span> : <a class="code hl_function" href="group__state__structure__mod.html#gad2bdf8059dbbe43bc0a3a3d3c875a0bb">get_num_domains</a></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceforward__operator__mod.html">forward_operator_mod</a>,  <span class="keywordtype">only</span> : <a class="code hl_function" href="namespaceforward__operator__mod.html#af35dca4b85910d40d7a83747b059600b">get_obs_ens_distrib_state</a></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacequality__control__mod.html">quality_control_mod</a>,   <span class="keywordtype">only</span> : <a class="code hl_function" href="namespacequality__control__mod.html#a342c54d59c3177cff4f0a1b7c963728c">initialize_qc</a></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span> </div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacelocation__mod.html">location_mod</a>,          <span class="keywordtype">only</span> : <a class="code hl_struct" href="structlocation__mod_1_1location__type.html">location_type</a></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceprobit__transform__mod.html">probit_transform_mod</a>,  <span class="keywordtype">only</span> : <a class="code hl_function" href="namespaceprobit__transform__mod.html#a3877b6f0aac0e1b3ea4162d37353e08a">transform_to_probit</a>, <a class="code hl_function" href="namespaceprobit__transform__mod.html#a75a14657fa6d3bd74786f41d48c1ebf7">transform_from_probit</a></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span> </div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacealgorithm__info__mod.html">algorithm_info_mod</a>, <span class="keywordtype">only</span> : <a class="code hl_function" href="namespacealgorithm__info__mod.html#a3d99ad78a28fe88d7430ed7a308c5d05">probit_dist_info</a>, <a class="code hl_function" href="namespacealgorithm__info__mod.html#ac3aa86f6c6131c861fe87798b65ebf4b">init_algorithm_info_mod</a>, <a class="code hl_function" href="namespacealgorithm__info__mod.html#aceea3ca8de97dd02da91db543102682a">end_algorithm_info_mod</a></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="keywordtype">use </span><a class="code hl_namespace" href="namespacedistribution__params__mod.html">distribution_params_mod</a>, <span class="keywordtype">only</span> : <a class="code hl_struct" href="structdistribution__params__mod_1_1distribution__params__type.html">distribution_params_type</a></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span> </div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span><span class="comment">!------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> </div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span><span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span><span class="keywordtype">private</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span><span class="keywordtype">public</span> :: <a class="code hl_function" href="namespacefilter__mod.html#a29d20310501029db7a1c0444e07498c8">filter_sync_keys_time</a>, &amp;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>          <a class="code hl_function" href="namespacefilter__mod.html#a7e5549afa9086b05dd99a6a7369473cf">filter_set_initial_time</a>, &amp;</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>          <a class="code hl_function" href="namespacefilter__mod.html#abfe5d4c835d0046ed1e49f24094a01ff">filter_main</a></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span> </div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a7ef49d27760f974266791dc0b6e314b0">  105</a></span><span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a> = <span class="stringliteral">&#39;filter_mod.f90&#39;</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span><span class="comment">! Some convenient global storage items</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a3cd4b6f8780ee9cd83e7497464b711c3">  108</a></span><span class="keywordtype">character(len=512)</span>      :: <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span> </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a6151f2410c1f3bd1431eb143ec1a606a">  110</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a6d1b20f110ea472a3a31fbb956e42e0e">trace_level</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a6151f2410c1f3bd1431eb143ec1a606a">timestamp_level</a></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="comment">! Defining whether diagnostics are for prior or posterior</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a7966f96271850d19516047b1c7b38070">  113</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#ab8cdd1126d0e8c7b386f1a31be904877">prior_diag</a> = 0, <a class="code hl_variable" href="namespacefilter__mod.html#a7966f96271850d19516047b1c7b38070">posterior_diag</a> = 2</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span> </div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="comment">! Determine if inflation it turned on or off for reading and writing</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span><span class="comment">! inflation restart files</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a98fbf532050fe3d2ac8674e4d7b0eaf7">  117</a></span><span class="keywordtype">logical</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a98fbf532050fe3d2ac8674e4d7b0eaf7">output_inflation</a> = .false.</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="comment">! Identifier for different copies for diagnostic files</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">  120</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">mem_start</a>     = 1</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ac97d329291d9ed859f969a8cf2ac8c99">  121</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#ac97d329291d9ed859f969a8cf2ac8c99">mem_end</a>       = 2</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">  122</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">ens_mean</a>      = 3</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">  123</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">ens_sd</a>        = 4</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">  124</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a> = 5</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">  125</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>   = 6</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">  126</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>  = 7</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">  127</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>    = 8</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span><span class="comment">! Number of Stage Copies</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a40d30bf4dd881d3b72955859d9741cdf">  130</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a40d30bf4dd881d3b72955859d9741cdf">num_scopies</a>    = 8</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span><span class="comment">! Ensemble copy numbers</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aa81a00c06bd9825573e5ae0b45676655">  133</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#aa81a00c06bd9825573e5ae0b45676655">ens_mem_start</a>                   = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#af75dd9a652c6247d3ed145ce5e67abdc">  134</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#af75dd9a652c6247d3ed145ce5e67abdc">ens_mem_end</a>                     = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">  135</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>                   = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">  136</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>                     = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">  137</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>                  = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">  138</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a>               = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">  139</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>                   = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">  140</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a>                = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span> </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">  142</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a40d30bf4dd881d3b72955859d9741cdf">num_scopies</a> )     = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span> </div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a61eec52627cc461c7ba4797880958ce5">  144</a></span><span class="keywordtype">integer</span> ::   <a class="code hl_variable" href="namespacefilter__mod.html#a61eec52627cc461c7ba4797880958ce5">current_copies</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a40d30bf4dd881d3b72955859d9741cdf">num_scopies</a> ) = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a1d29faddb7d7f0f640f15c6a9e39b38b">  145</a></span><span class="keywordtype">integer</span> ::  <a class="code hl_variable" href="namespacefilter__mod.html#a1d29faddb7d7f0f640f15c6a9e39b38b">forecast_copies</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a40d30bf4dd881d3b72955859d9741cdf">num_scopies</a> ) = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aa78ffea5f7c1c36719ee2c6497cfeb06">  146</a></span><span class="keywordtype">integer</span> ::  <a class="code hl_variable" href="namespacefilter__mod.html#aa78ffea5f7c1c36719ee2c6497cfeb06">preassim_copies</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a40d30bf4dd881d3b72955859d9741cdf">num_scopies</a> ) = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ab7d4c1aa67478d6c8aec44eb82d0c7e7">  147</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#ab7d4c1aa67478d6c8aec44eb82d0c7e7">postassim_copies</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a40d30bf4dd881d3b72955859d9741cdf">num_scopies</a> ) = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a38ed5812756013876b9a3fb4319d1ec5">  148</a></span><span class="keywordtype">integer</span> ::  <a class="code hl_variable" href="namespacefilter__mod.html#a38ed5812756013876b9a3fb4319d1ec5">analysis_copies</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a40d30bf4dd881d3b72955859d9741cdf">num_scopies</a> ) = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span> </div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aaf1e25fd8591ef5235d72965ec31be1a">  150</a></span><span class="keywordtype">integer</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#aaf1e25fd8591ef5235d72965ec31be1a">spare_prior_spread</a>              = <a class="code hl_variable" href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">copy_not_present</a></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span> </div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span><span class="comment">! Module Global Variables for inflation</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">  153</a></span><span class="keywordtype">logical</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a>     = .false.</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">  154</a></span><span class="keywordtype">logical</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> = .false.</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">  155</a></span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structadaptive__inflate__mod_1_1adaptive__inflate__type.html">adaptive_inflate_type</a>) :: <a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span> </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">  157</a></span><span class="keywordtype">logical</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">has_cycling</a>          = .false. <span class="comment">! filter will advance the model</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span><span class="comment">! parms for trace/timing messages</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a57fb40636aeb9aaa81403bb9a1706210">  160</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a57fb40636aeb9aaa81403bb9a1706210">t_before</a>  = 1</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a3784b41754c7c894fc931b34344b4dc2">  161</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a3784b41754c7c894fc931b34344b4dc2">t_after</a>   = 2</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#adb06e014f938682a0f0aa6fa3d73c43c">  162</a></span><span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#adb06e014f938682a0f0aa6fa3d73c43c">t_neither</a> = 3</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#af78ca27ca66a25de58fae8a63628b05c">  163</a></span><span class="keywordtype">logical</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#af78ca27ca66a25de58fae8a63628b05c">p_time</a>    = .true.</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span> </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span><span class="comment">! Namelist input with default values</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span><span class="comment">!</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a12f0243b9f8139a944865f8ce704247c">  168</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a12f0243b9f8139a944865f8ce704247c">async</a> = 0, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a> = 20</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a982adbff91f97ba1e1ab17dc6023366f">  169</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a982adbff91f97ba1e1ab17dc6023366f">tasks_per_model_advance</a> = 1</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span><span class="comment">! if init_time_days and seconds are negative initial time is 0, 0</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span><span class="comment">! for no restart or comes from restart if restart exists</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a7c24d0881a16cb679683d2a6e767fb86">  172</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a7c24d0881a16cb679683d2a6e767fb86">init_time_days</a>    = 0</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aed15c0af9f08f929a1d112381a09f6ad">  173</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#aed15c0af9f08f929a1d112381a09f6ad">init_time_seconds</a> = 0</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="comment">! Time of first and last observations to be used from obs_sequence</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span><span class="comment">! If negative, these are not used</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#adf38423aa561b42883a121952ee4ecd6">  176</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#adf38423aa561b42883a121952ee4ecd6">first_obs_days</a>      = -1</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ab4235d433b1b5d095798608d9032d8f0">  177</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#ab4235d433b1b5d095798608d9032d8f0">first_obs_seconds</a>   = -1</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#af1e7b985d8df3e6af8f2587261d8641b">  178</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#af1e7b985d8df3e6af8f2587261d8641b">last_obs_days</a>       = -1</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#abee3c2d14c91fe599a09d179c7c0f9a9">  179</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#abee3c2d14c91fe599a09d179c7c0f9a9">last_obs_seconds</a>    = -1</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span><span class="comment">! Assimilation window; defaults to model timestep size.</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a6021be572f1393433e386c5c7072e176">  181</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a6021be572f1393433e386c5c7072e176">obs_window_days</a>     = -1</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a46f9eeb3cd59c99cc97dc9f23bbc9c6c">  182</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a46f9eeb3cd59c99cc97dc9f23bbc9c6c">obs_window_seconds</a>  = -1</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><span class="comment">! Control diagnostic output for state variables</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a2e635d221f9df63c2e45a0404c77b542">  184</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a2e635d221f9df63c2e45a0404c77b542">num_output_state_members</a> = 0</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">  185</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">num_output_obs_members</a>   = 0</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">  186</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a>     = 1</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">  187</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">num_groups</a>          = 1</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a4baff862c93f0257ec0da92bcd70d122">  188</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a4baff862c93f0257ec0da92bcd70d122">output_forward_op_errors</a> = .false.</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a95db313d402d4f31b9ddb5f4347b9a6f">  189</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a95db313d402d4f31b9ddb5f4347b9a6f">output_timestamps</a>        = .false.</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a349103b2b5767dd7dad2bc4a2d32cd0f">  190</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a349103b2b5767dd7dad2bc4a2d32cd0f">trace_execution</a>          = .false.</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a5cab9c21b1b37f563e583a4789290337">  191</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a5cab9c21b1b37f563e583a4789290337">write_obs_every_cycle</a>    = .false.  <span class="comment">! debug only</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a2e6d996cd39b3f4929f0085c751e6950">  192</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a2e6d996cd39b3f4929f0085c751e6950">silence</a>                  = .false.</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a7d44418ecce7613f1e900dfd71e2c525">  193</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a7d44418ecce7613f1e900dfd71e2c525">distributed_state</a> = .true. <span class="comment">! Default to do distributed forward operators.</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span> </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="comment">! IO options</span><span class="comment"></span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span><span class="comment">!&gt;@todo FIXME - how does this work for multiple domains?  ens1d1, ens2d1, ... ens1d2 or</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span><span class="comment">!&gt; ens1d1 ens1d2, ens1d1 ens2d2, etc   i like the latter better.</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ab751fbc6a9ea198bae7c0f7a23c3f340">  198</a></span><span class="keywordtype">character(len=256)</span> ::  <a class="code hl_variable" href="namespacefilter__mod.html#ab751fbc6a9ea198bae7c0f7a23c3f340">input_state_files</a>(<a class="code hl_variable" href="namespacetypes__mod.html#a2bcc059ce33ea404751ac973800ef87d">max_files</a>) = <span class="stringliteral">&#39;&#39;</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a782a1d98e3e47c18d480c4397af79f93">  199</a></span><span class="keywordtype">character(len=256)</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a782a1d98e3e47c18d480c4397af79f93">output_state_files</a>(<a class="code hl_variable" href="namespacetypes__mod.html#a2bcc059ce33ea404751ac973800ef87d">max_files</a>) = <span class="stringliteral">&#39;&#39;</span> </div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span><span class="comment">! Name of files containing a list of {input,output} restart files, 1 file per domain</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a8576eaefc8bad0b49d7c893588bde7f9">  202</a></span><span class="keywordtype">character(len=256)</span> ::  <a class="code hl_variable" href="namespacefilter__mod.html#a8576eaefc8bad0b49d7c893588bde7f9">input_state_file_list</a>(<a class="code hl_variable" href="namespacetypes__mod.html#a1e2772ead7275ce0da368baa04c8cec7">max_num_doms</a>) = <span class="stringliteral">&#39;&#39;</span> </div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a317b51268d909d4934f51b732df4531c">  203</a></span><span class="keywordtype">character(len=256)</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a317b51268d909d4934f51b732df4531c">output_state_file_list</a>(<a class="code hl_variable" href="namespacetypes__mod.html#a1e2772ead7275ce0da368baa04c8cec7">max_num_doms</a>) = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span><span class="comment">! Read in a single file and perturb this to create an ensemble</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ab21ff1ee87b3f7e9bfab3fed249624b1">  206</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#ab21ff1ee87b3f7e9bfab3fed249624b1">perturb_from_single_instance</a> = .false.</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ac57764243591fe7c29cffbee0d7882d5">  207</a></span><span class="keywordtype">real</span>(<a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>) :: <a class="code hl_variable" href="namespacefilter__mod.html#ac57764243591fe7c29cffbee0d7882d5">perturbation_amplitude</a>       = 0.2_r8</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span><span class="comment">! File options.  Single vs. Multiple.  really &#39;unified&#39; or &#39;combination&#39; vs &#39;individual&#39;</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a72faee5fd84c3e52b6191c8f0043693f">  210</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a72faee5fd84c3e52b6191c8f0043693f">single_file_in</a>  = .false. <span class="comment">! all copies read  from 1 file</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">  211</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a> = .false. <span class="comment">! all copies written to 1 file</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span> </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="comment">! optimization option:</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ab501d4bc83880f73c2b4d8425043701d">  214</a></span><span class="keywordtype">logical</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#ab501d4bc83880f73c2b4d8425043701d">compute_posterior</a>   = .true. <span class="comment">! set to false to not compute posterior values</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span><span class="comment">! Stages to write.  Valid values are:</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span><span class="comment">! multi-file:    input, forecast, preassim, postassim, analysis, output</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span><span class="comment">! single-file:          forecast, preassim, postassim, analysis, output</span></div>
<div class="foldopen" id="foldopen00219" data-start="" data-end="">
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a8f6342435f800eaf2a4cb52c82415935">  219</a></span><span class="keywordtype">character(len=10)</span>  :: <a class="code hl_struct" href="structstate__vector__io__mod_1_1stages__to__write.html">stages_to_write</a>(6) = (/<span class="stringliteral">&quot;output    &quot;</span>, <span class="stringliteral">&quot;null      &quot;</span>, <span class="stringliteral">&quot;null      &quot;</span>, &amp;</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>                                             <span class="stringliteral">&quot;null      &quot;</span>, <span class="stringliteral">&quot;null      &quot;</span>, <span class="stringliteral">&quot;null      &quot;</span> /)</div>
</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span><span class="comment"></span> </div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span><span class="comment">!&gt;@todo FIXME</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span><span class="comment">!&gt; for preassim and postassim output it might be we should</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span><span class="comment">!&gt; be controlling the writing of individual ensemble members</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span><span class="comment">!&gt; by looking at the num_output_state_member value.  0 means</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span><span class="comment">!&gt; don&#39;t write any members, otherwise it&#39;s a count.  and for</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span><span class="comment">!&gt; completeness, there could be a count for pre and a count for post.</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span> </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a8f715cc2fb31b5b14a58f9bd06cf86f3">  229</a></span><span class="keywordtype">logical</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a8f715cc2fb31b5b14a58f9bd06cf86f3">output_members</a>   = .true.</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a34bfafb5e98fec24b32f651f7996a59f">  230</a></span><span class="keywordtype">logical</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a34bfafb5e98fec24b32f651f7996a59f">output_mean</a>      = .true.</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a6a0afbade119eb0c73644e49b86b9fb8">  231</a></span><span class="keywordtype">logical</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a6a0afbade119eb0c73644e49b86b9fb8">output_sd</a>        = .true.</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">  232</a></span><span class="keywordtype">logical</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">write_all_stages_at_end</a> = .false.</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span> </div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a03faf9e8afe7f8f8daa826f225c936b4">  234</a></span><span class="keywordtype">character(len=256)</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a5931e52ebd8d067e36ce011e28b6f8c9">obs_sequence_in_name</a>  = <span class="stringliteral">&quot;obs_seq.out&quot;</span>,    &amp;</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>                      <a class="code hl_variable" href="namespacefilter__mod.html#a77b537fbf821744ae02ea89603f1c92c">obs_sequence_out_name</a> = <span class="stringliteral">&quot;obs_seq.final&quot;</span>,  &amp;</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>                      <a class="code hl_variable" href="namespacefilter__mod.html#a03faf9e8afe7f8f8daa826f225c936b4">adv_ens_command</a>       = <span class="stringliteral">&#39;./advance_model.csh&#39;</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span> </div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span><span class="comment">! The inflation algorithm variables are defined in adaptive_inflate_mod.</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span><span class="comment">! We use the integer parameters for PRIOR_INF and POSTERIOR_INF from </span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span><span class="comment">! adaptive_inflate_mod to index these &#39;length 2&#39; arrays.</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span> </div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a1a06628fdb3e51bc068347aad285730a">  242</a></span><span class="keywordtype">integer</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a1a06628fdb3e51bc068347aad285730a">inf_flavor</a>(2)                  = 0</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aa52472d92f849fc0b5de5a57806ed8ad">  243</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#aa52472d92f849fc0b5de5a57806ed8ad">inf_initial_from_restart</a>(2)    = .false.</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#acc88936518a51aed421d731d3c628402">  244</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#acc88936518a51aed421d731d3c628402">inf_sd_initial_from_restart</a>(2) = .false.</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a24a32282421d3c0070cb5f54e05ea81d">  245</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#a24a32282421d3c0070cb5f54e05ea81d">inf_deterministic</a>(2)           = .true.</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ab755c9150a3ba240b43f8930123d861a">  246</a></span><span class="keywordtype">real</span>(<a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>) :: <a class="code hl_variable" href="namespacefilter__mod.html#ab755c9150a3ba240b43f8930123d861a">inf_initial</a>(2)                 = 1.0_r8</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a1fa8e21f160e9d2dfb2618ff99b840c4">  247</a></span><span class="keywordtype">real</span>(<a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>) :: <a class="code hl_variable" href="namespacefilter__mod.html#a1fa8e21f160e9d2dfb2618ff99b840c4">inf_sd_initial</a>(2)              = 0.0_r8</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a0e052301e8e06be3c37a1a48a908dc6e">  248</a></span><span class="keywordtype">real</span>(<a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>) :: <a class="code hl_variable" href="namespacefilter__mod.html#a0e052301e8e06be3c37a1a48a908dc6e">inf_sd_max_change</a>(2)           = 1.05_r8</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">  249</a></span><span class="keywordtype">real</span>(<a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>) :: <a class="code hl_variable" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">inf_damping</a>(2)                 = 1.0_r8</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a2a8aaf06161e0c132e0a86f19ff02f0b">  250</a></span><span class="keywordtype">real</span>(<a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>) :: <a class="code hl_variable" href="namespacefilter__mod.html#a2a8aaf06161e0c132e0a86f19ff02f0b">inf_lower_bound</a>(2)             = 1.0_r8</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a8f03d4175a8c5e6dd1666487dfe91226">  251</a></span><span class="keywordtype">real</span>(<a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>) :: <a class="code hl_variable" href="namespacefilter__mod.html#a8f03d4175a8c5e6dd1666487dfe91226">inf_upper_bound</a>(2)             = 1000000.0_r8</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#af58e04c3bdb3f7063488a3861dfdc442">  252</a></span><span class="keywordtype">real</span>(<a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>) :: <a class="code hl_variable" href="namespacefilter__mod.html#af58e04c3bdb3f7063488a3861dfdc442">inf_sd_lower_bound</a>(2)          = 0.0_r8</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span><span class="comment">! Some models are allowed to have MISSING_R8 values in the DART state vector.</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span><span class="comment">! If they are encountered, it is not necessarily a FATAL error.</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span><span class="comment">! Most of the time, if a MISSING_R8 is encountered, DART should die.</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span><span class="comment">! CLM should have allow_missing_clm = .true.</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ac69f82a4c4e290f82acdc71b118edfe3">  258</a></span><span class="keywordtype">logical</span>  :: <a class="code hl_variable" href="namespacefilter__mod.html#ac69f82a4c4e290f82acdc71b118edfe3">allow_missing_clm</a> = .false.</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span> </div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span> </div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>namelist /filter_nml/ <a class="code hl_variable" href="namespacefilter__mod.html#a12f0243b9f8139a944865f8ce704247c">async</a>,     &amp;</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a03faf9e8afe7f8f8daa826f225c936b4">adv_ens_command</a>,              &amp;</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>,                     &amp;</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a982adbff91f97ba1e1ab17dc6023366f">tasks_per_model_advance</a>,      &amp;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a8f715cc2fb31b5b14a58f9bd06cf86f3">output_members</a>,               &amp;</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a5931e52ebd8d067e36ce011e28b6f8c9">obs_sequence_in_name</a>,         &amp;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a77b537fbf821744ae02ea89603f1c92c">obs_sequence_out_name</a>,        &amp;</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a7c24d0881a16cb679683d2a6e767fb86">init_time_days</a>,               &amp;</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>   <a class="code hl_variable" href="namespacefilter__mod.html#aed15c0af9f08f929a1d112381a09f6ad">init_time_seconds</a>,            &amp;</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>   <a class="code hl_variable" href="namespacefilter__mod.html#adf38423aa561b42883a121952ee4ecd6">first_obs_days</a>,               &amp;</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>   <a class="code hl_variable" href="namespacefilter__mod.html#ab4235d433b1b5d095798608d9032d8f0">first_obs_seconds</a>,            &amp;</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>   <a class="code hl_variable" href="namespacefilter__mod.html#af1e7b985d8df3e6af8f2587261d8641b">last_obs_days</a>,                &amp;</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>   <a class="code hl_variable" href="namespacefilter__mod.html#abee3c2d14c91fe599a09d179c7c0f9a9">last_obs_seconds</a>,             &amp;</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a6021be572f1393433e386c5c7072e176">obs_window_days</a>,              &amp;</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a46f9eeb3cd59c99cc97dc9f23bbc9c6c">obs_window_seconds</a>,           &amp;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a2e635d221f9df63c2e45a0404c77b542">num_output_state_members</a>,     &amp;</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">num_output_obs_members</a>,       &amp;</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a>,              &amp;</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">num_groups</a>,                   &amp;</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a349103b2b5767dd7dad2bc4a2d32cd0f">trace_execution</a>,              &amp;</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a4baff862c93f0257ec0da92bcd70d122">output_forward_op_errors</a>,     &amp;</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a95db313d402d4f31b9ddb5f4347b9a6f">output_timestamps</a>,            &amp;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a1a06628fdb3e51bc068347aad285730a">inf_flavor</a>,                   &amp;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>   <a class="code hl_variable" href="namespacefilter__mod.html#aa52472d92f849fc0b5de5a57806ed8ad">inf_initial_from_restart</a>,     &amp;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>   <a class="code hl_variable" href="namespacefilter__mod.html#acc88936518a51aed421d731d3c628402">inf_sd_initial_from_restart</a>,  &amp;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a0e052301e8e06be3c37a1a48a908dc6e">inf_sd_max_change</a>,            &amp; </div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a24a32282421d3c0070cb5f54e05ea81d">inf_deterministic</a>,            &amp;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>   <a class="code hl_variable" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">inf_damping</a>,                  &amp;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>   <a class="code hl_variable" href="namespacefilter__mod.html#ab755c9150a3ba240b43f8930123d861a">inf_initial</a>,                  &amp;</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a1fa8e21f160e9d2dfb2618ff99b840c4">inf_sd_initial</a>,               &amp;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a2a8aaf06161e0c132e0a86f19ff02f0b">inf_lower_bound</a>,              &amp;</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a8f03d4175a8c5e6dd1666487dfe91226">inf_upper_bound</a>,              &amp;</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>   <a class="code hl_variable" href="namespacefilter__mod.html#af58e04c3bdb3f7063488a3861dfdc442">inf_sd_lower_bound</a>,           &amp;</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a2e6d996cd39b3f4929f0085c751e6950">silence</a>,                      &amp;</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a7d44418ecce7613f1e900dfd71e2c525">distributed_state</a>,            &amp;</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a72faee5fd84c3e52b6191c8f0043693f">single_file_in</a>,               &amp;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a>,              &amp;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>   <a class="code hl_variable" href="namespacefilter__mod.html#ab21ff1ee87b3f7e9bfab3fed249624b1">perturb_from_single_instance</a>, &amp;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>   <a class="code hl_variable" href="namespacefilter__mod.html#ac57764243591fe7c29cffbee0d7882d5">perturbation_amplitude</a>,       &amp;</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>   <a class="code hl_variable" href="namespacefilter__mod.html#ab501d4bc83880f73c2b4d8425043701d">compute_posterior</a>,            &amp;</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>   <a class="code hl_struct" href="structstate__vector__io__mod_1_1stages__to__write.html">stages_to_write</a>,              &amp;</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>   <a class="code hl_variable" href="namespacefilter__mod.html#ab751fbc6a9ea198bae7c0f7a23c3f340">input_state_files</a>,            &amp;</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a782a1d98e3e47c18d480c4397af79f93">output_state_files</a>,           &amp;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a317b51268d909d4934f51b732df4531c">output_state_file_list</a>,       &amp;</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a8576eaefc8bad0b49d7c893588bde7f9">input_state_file_list</a>,        &amp;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a34bfafb5e98fec24b32f651f7996a59f">output_mean</a>,                  &amp;</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a6a0afbade119eb0c73644e49b86b9fb8">output_sd</a>,                    &amp;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">write_all_stages_at_end</a>,      &amp;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a5cab9c21b1b37f563e583a4789290337">write_obs_every_cycle</a>,        &amp; </div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>   <a class="code hl_variable" href="namespacefilter__mod.html#ac69f82a4c4e290f82acdc71b118edfe3">allow_missing_clm</a></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span><span class="comment">!----------------------------------------------------------------</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span><span class="keyword">contains</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span> </div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span><span class="comment">!----------------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span><span class="comment">!&gt; The code does not use %vars arrays except:</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span><span class="comment">!&gt; * Task 0 still writes the obs_sequence file, so there is a transpose (copies to vars)</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span><span class="comment">!&gt;   and sending the obs_fwd_op_ens_handle%vars to task 0. Keys is also size obs%vars.</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span><span class="comment">!&gt; * If you read dart restarts state_ens_handle%vars is allocated.</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span><span class="comment">!&gt; * If you write dart diagnostics state_ens_handle%vars is allocated.</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span><span class="comment">!&gt; * If you are not doing distributed forward operators state_ens_handle%vars is allocated</span></div>
<div class="foldopen" id="foldopen00323" data-start="" data-end="">
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#abfe5d4c835d0046ed1e49f24094a01ff">  323</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#abfe5d4c835d0046ed1e49f24094a01ff">filter_main</a>()</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>)         :: state_ens_handle, obs_fwd_op_ens_handle, qc_ens_handle</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>)     :: seq</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structtime__manager__mod_1_1time__type.html">time_type</a>)             :: time1, first_obs_time, last_obs_time</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structtime__manager__mod_1_1time__type.html">time_type</a>)             :: curr_ens_time, next_ens_time, window_time</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span> </div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span><span class="keywordtype">integer</span>,    <span class="keywordtype">allocatable</span> :: keys(:)</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span><span class="keywordtype">integer(i8)</span>             :: model_size</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span><span class="keywordtype">integer</span>                 :: iunit, io, time_step_number, num_obs_in_set, ntimes</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span><span class="keywordtype">integer</span>                 :: last_key_used, key_bounds(2)</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span><span class="keywordtype">integer</span>                 :: in_obs_copy, obs_val_index</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span><span class="keywordtype">integer</span>                 :: prior_obs_mean_index, posterior_obs_mean_index</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span><span class="keywordtype">integer</span>                 :: prior_obs_spread_index, posterior_obs_spread_index</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span><span class="comment">! Global indices into ensemble storage - observations</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span><span class="keywordtype">integer</span>                 :: obs_val_copy, obs_err_var_copy, obs_key_copy</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span><span class="keywordtype">integer</span>                 :: obs_global_qc_copy,obs_extra_qc_copy</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span><span class="keywordtype">integer</span>                 :: obs_mean_start, obs_mean_end</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span><span class="keywordtype">integer</span>                 :: obs_var_start, obs_var_end, total_obs_copies</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span><span class="keywordtype">integer</span>                 :: input_qc_index, dart_qc_index</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span><span class="keywordtype">integer</span>                 :: num_state_ens_copies</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span><span class="keywordtype">logical</span>                 :: read_time_from_file</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span><span class="keywordtype">integer</span> :: num_extras <span class="comment">! the extra ensemble copies</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>) :: file_info_input</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>) :: file_info_mean_sd</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>) :: file_info_forecast</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>) :: file_info_preassim</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>) :: file_info_postassim</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>) :: file_info_analysis</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>) :: file_info_output</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>) :: file_info_all</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span> </div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span><span class="keywordtype">logical</span> :: all_gone, allow_missing</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span><span class="keywordtype">real</span>(<a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>), <span class="keywordtype">allocatable</span>   :: prior_qc_copy(:)</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span> </div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ab2c376d8c98d53a47939ed391ced0654">filter_initialize_modules_used</a>() <span class="comment">! static_init_model called in here</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> </div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span><span class="comment">! Read the namelist entry</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span><span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#ad4d01f7f0f751b03c2480fb100dc7c6a">find_namelist_in_file</a>(<span class="stringliteral">&quot;input.nml&quot;</span>, <span class="stringliteral">&quot;filter_nml&quot;</span>, iunit)</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="keyword">read</span>(iunit, nml = filter_nml, iostat = io)</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span><span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#ada43bd6e7099952a626e082d7fa0e440">check_namelist_read</a>(iunit, io, <span class="stringliteral">&quot;filter_nml&quot;</span>)</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span> </div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span><span class="comment">! Record the namelist values used for the run ...</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceutilities__mod.html#ada0bc0fbdb62dda0a03f7b23a7de35aa">do_nml_file</a>()) <span class="keyword">write</span>(<a class="code hl_variable" href="namespaceutilities__mod.html#a2e4229a51f48d48570bb0b7d304662c3">nmlfileunit</a>, nml=filter_nml)</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceutilities__mod.html#a57146d1bf098cd251ef93abb838d1f30">do_nml_term</a>()) <span class="keyword">write</span>(     *     , nml=filter_nml)</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespacempi__utilities__mod.html#ae8ccd09884b18c6d167291247089bd27">task_count</a>() == 1) <a class="code hl_variable" href="namespacefilter__mod.html#a7d44418ecce7613f1e900dfd71e2c525">distributed_state</a> = .true.</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span><span class="keyword">call </span><a class="code hl_function" href="namespaceobs__def__utilities__mod.html#a3732608dacf5a1438cc02de8a53fb764">set_debug_fwd_op</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a4baff862c93f0257ec0da92bcd70d122">output_forward_op_errors</a>)</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a27e9b289aac5155c54ec925951569906">set_trace</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a349103b2b5767dd7dad2bc4a2d32cd0f">trace_execution</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a95db313d402d4f31b9ddb5f4347b9a6f">output_timestamps</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a2e6d996cd39b3f4929f0085c751e6950">silence</a>)</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span><span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Filter start&#39;</span>)</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Filter start&#39;</span>)</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span><span class="comment">! Make sure ensemble size is at least 2 (NEED MANY OTHER CHECKS)</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span><span class="keywordflow">if</span>(<a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a> &lt; 2) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>   <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, *) <span class="stringliteral">&#39;ens_size in namelist is &#39;</span>, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <span class="stringliteral">&#39;: Must be &gt; 1&#39;</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;filter_main&#39;</span>, <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, <a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span> </div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span><span class="comment">! informational message to log</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span><span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, <span class="stringliteral">&#39;(A,I5)&#39;</span>) <span class="stringliteral">&#39;running with an ensemble size of &#39;</span>, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span><span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>,<span class="stringliteral">&#39;filter_main:&#39;</span>, <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, <a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span><span class="keyword">call </span><a class="code hl_function" href="namespaceoptions__mod.html#a66a52ec2d5459c7cdb514f26ea6e1c68">set_missing_ok_status</a>(<a class="code hl_variable" href="namespacefilter__mod.html#ac69f82a4c4e290f82acdc71b118edfe3">allow_missing_clm</a>)</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>allow_missing = <a class="code hl_function" href="namespaceoptions__mod.html#a536448bfef7c5c838d79e714ca7bbb6a">get_missing_ok_status</a>()</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span> </div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before initializing inflation&#39;</span>)</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span> </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span><span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#ga9b7a2f79554831e034bf1a1ee85090ea">validate_inflate_options</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a1a06628fdb3e51bc068347aad285730a">inf_flavor</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">inf_damping</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aa52472d92f849fc0b5de5a57806ed8ad">inf_initial_from_restart</a>, &amp;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>   <a class="code hl_variable" href="namespacefilter__mod.html#acc88936518a51aed421d731d3c628402">inf_sd_initial_from_restart</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a24a32282421d3c0070cb5f54e05ea81d">inf_deterministic</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a0e052301e8e06be3c37a1a48a908dc6e">inf_sd_max_change</a>,            &amp;</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>   <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a98fbf532050fe3d2ac8674e4d7b0eaf7">output_inflation</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ab501d4bc83880f73c2b4d8425043701d">compute_posterior</a>)</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span><span class="comment">! Initialize the adaptive inflation module</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span><span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#ga5e2b2164fc43832ae208ab74dbcbddbc">adaptive_inflate_init</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>, &amp;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a1a06628fdb3e51bc068347aad285730a">inf_flavor</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>), &amp;</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#aa52472d92f849fc0b5de5a57806ed8ad">inf_initial_from_restart</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>), &amp; </div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#acc88936518a51aed421d731d3c628402">inf_sd_initial_from_restart</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>), &amp;</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a98fbf532050fe3d2ac8674e4d7b0eaf7">output_inflation</a>, &amp;</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a24a32282421d3c0070cb5f54e05ea81d">inf_deterministic</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>), &amp;</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#ab755c9150a3ba240b43f8930123d861a">inf_initial</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>), &amp;</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a1fa8e21f160e9d2dfb2618ff99b840c4">inf_sd_initial</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>), &amp;</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a2a8aaf06161e0c132e0a86f19ff02f0b">inf_lower_bound</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>), &amp;</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a8f03d4175a8c5e6dd1666487dfe91226">inf_upper_bound</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>), &amp;</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#af58e04c3bdb3f7063488a3861dfdc442">inf_sd_lower_bound</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>), &amp;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a0e052301e8e06be3c37a1a48a908dc6e">inf_sd_max_change</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>), &amp;</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>                           allow_missing, <span class="stringliteral">&#39;Prior&#39;</span>)</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span> </div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span><span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#ga5e2b2164fc43832ae208ab74dbcbddbc">adaptive_inflate_init</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>, &amp;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a1a06628fdb3e51bc068347aad285730a">inf_flavor</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>), &amp;</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#aa52472d92f849fc0b5de5a57806ed8ad">inf_initial_from_restart</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>), &amp;</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#acc88936518a51aed421d731d3c628402">inf_sd_initial_from_restart</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>), &amp;</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a98fbf532050fe3d2ac8674e4d7b0eaf7">output_inflation</a>, &amp;</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a24a32282421d3c0070cb5f54e05ea81d">inf_deterministic</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>), &amp;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#ab755c9150a3ba240b43f8930123d861a">inf_initial</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>), &amp;</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a1fa8e21f160e9d2dfb2618ff99b840c4">inf_sd_initial</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>), &amp;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a2a8aaf06161e0c132e0a86f19ff02f0b">inf_lower_bound</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>), &amp;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a8f03d4175a8c5e6dd1666487dfe91226">inf_upper_bound</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>), &amp;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#af58e04c3bdb3f7063488a3861dfdc442">inf_sd_lower_bound</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>), &amp;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>                           <a class="code hl_variable" href="namespacefilter__mod.html#a0e052301e8e06be3c37a1a48a908dc6e">inf_sd_max_change</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>), &amp;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>                           allow_missing, <span class="stringliteral">&#39;Posterior&#39;</span>)</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span> </div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceutilities__mod.html#ae5919d9aaedac3ac4128d1d68ed05769">do_output</a>()) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a1a06628fdb3e51bc068347aad285730a">inf_flavor</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>) &gt; <a class="code hl_variable" href="group__adaptive__inflate.html#ga81a04174a5714a8630dd252999afa301">no_inflation</a> .and. &amp;</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>            <a class="code hl_variable" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">inf_damping</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>) &lt; 1.0_r8) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>      <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, <span class="stringliteral">&#39;(A,F12.6,A)&#39;</span>) <span class="stringliteral">&#39;Prior inflation damping of &#39;</span>, &amp;</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>                                      <a class="code hl_variable" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">inf_damping</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>), <span class="stringliteral">&#39; will be used&#39;</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>,<span class="stringliteral">&#39;filter_main:&#39;</span>, <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>)</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a1a06628fdb3e51bc068347aad285730a">inf_flavor</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>) &gt; <a class="code hl_variable" href="group__adaptive__inflate.html#ga81a04174a5714a8630dd252999afa301">no_inflation</a> .and. &amp;</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>            <a class="code hl_variable" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">inf_damping</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>) &lt; 1.0_r8) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>      <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, <span class="stringliteral">&#39;(A,F12.6,A)&#39;</span>) <span class="stringliteral">&#39;Posterior inflation damping of &#39;</span>, &amp;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>                                      <a class="code hl_variable" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">inf_damping</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>), <span class="stringliteral">&#39; will be used&#39;</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>,<span class="stringliteral">&#39;filter_main:&#39;</span>, <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>)</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span> </div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  initializing inflation&#39;</span>)</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span><span class="comment">! for now, set &#39;has_cycling&#39; to match &#39;single_file_out&#39; since we&#39;re only supporting</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span><span class="comment">! multi-file output for a single pass through filter, and allowing cycling if we&#39;re</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span><span class="comment">! writing to a single file.</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span> </div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span><a class="code hl_variable" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">has_cycling</a> = <a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span> </div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span><span class="comment">! don&#39;t allow cycling and write all at end - might never be supported</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">has_cycling</a> .and. <a class="code hl_variable" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">write_all_stages_at_end</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;filter:&#39;</span>, &amp;</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>         <span class="stringliteral">&#39;advancing the model inside filter and writing all state data at end not supported&#39;</span>, &amp;</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>          <a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>, text2=<span class="stringliteral">&#39;delaying write until end only supported when advancing model outside filter&#39;</span>, &amp;</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>          text3=<span class="stringliteral">&#39;set &quot;write_all_stages_at_end=.false.&quot; to cycle and write data as it is computed&#39;</span>)</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span><span class="comment">! Setup the indices into the ensemble storage:</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span> </div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="comment">! Can&#39;t output more ensemble members than exist</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span><span class="keywordflow">if</span>(<a class="code hl_variable" href="namespacefilter__mod.html#a2e635d221f9df63c2e45a0404c77b542">num_output_state_members</a> &gt; <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>) <a class="code hl_variable" href="namespacefilter__mod.html#a2e635d221f9df63c2e45a0404c77b542">num_output_state_members</a> = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span><span class="keywordflow">if</span>(<a class="code hl_variable" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">num_output_obs_members</a>   &gt; <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>) <a class="code hl_variable" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">num_output_obs_members</a>   = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span> </div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span><span class="comment">! Set up stages to write : input, preassim, postassim, output</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a01bd6b2eba904d41a35c868fd2ec1c13">parse_stages_to_write</a>(<a class="code hl_struct" href="structstate__vector__io__mod_1_1stages__to__write.html">stages_to_write</a>)</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span> </div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span><span class="comment">! Count and set up State copy numbers</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>num_state_ens_copies = <a class="code hl_function" href="namespacefilter__mod.html#aade0710f5022a2552c756dfc026fed63">count_state_ens_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>)</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>num_extras           = num_state_ens_copies - <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span> </div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span><span class="comment">! Observation</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>obs_err_var_copy     = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a> + 1</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>obs_val_copy         = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a> + 2</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>obs_key_copy         = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a> + 3</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>obs_global_qc_copy   = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a> + 4</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>obs_extra_qc_copy    = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a> + 5</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>obs_mean_start       = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a> + 6</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>obs_mean_end         = obs_mean_start + <a class="code hl_variable" href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">num_groups</a> - 1</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>obs_var_start        = obs_mean_start + <a class="code hl_variable" href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">num_groups</a></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>obs_var_end          = obs_var_start + <a class="code hl_variable" href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">num_groups</a> - 1</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>total_obs_copies = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a> + 5 + 2*<a class="code hl_variable" href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">num_groups</a></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span><span class="comment"></span> </div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span><span class="comment">!&gt;@todo FIXME turn trace/timestamp calls into:  </span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span><span class="comment">!&gt;</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span><span class="comment">!&gt; integer, parameter :: T_BEFORE = 1</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span><span class="comment">!&gt; integer, parameter :: T_AFTER  = 2</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span><span class="comment">!&gt; integer, parameter :: P_TIME   = 1</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span><span class="comment">!&gt;</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span><span class="comment">!&gt;  call progress(string, T_BEFORE)  ! simple trace msg</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="comment">!&gt;  call progress(string, T_AFTER)</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span><span class="comment">!&gt;</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span><span class="comment">!&gt;  call progress(string, T_BEFORE, P_TIME)  ! trace plus timestamp</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span><span class="comment">!&gt;  call progress(string, T_AFTER,  P_TIME)</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span><span class="comment"></span> </div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span><span class="comment">!&gt; DO NOT timestamp every trace message because some are</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span><span class="comment">!&gt; so quick that the timestamps don&#39;t impart any info.  </span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span><span class="comment">!&gt; we should be careful to timestamp logical *sections* instead.</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span> </div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span><span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before setting up space for observations&#39;</span>)</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before setting up space for observations&#39;</span>)</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span> </div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span><span class="comment">! Initialize the obs_sequence; every pe gets a copy for now</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a0ff0be69ea73156970fbb804687c8a60">filter_setup_obs_sequence</a>(seq, in_obs_copy, obs_val_index, input_qc_index, dart_qc_index, <a class="code hl_variable" href="namespacefilter__mod.html#ab501d4bc83880f73c2b4d8425043701d">compute_posterior</a>)</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span> </div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  setting up space for observations&#39;</span>)</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span><span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  setting up space for observations&#39;</span>)</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span> </div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before setting up space for ensembles&#39;</span>)</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span> </div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span><span class="comment">! Allocate model size storage and ens_size storage for metadata for outputting ensembles</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>model_size = get_model_size()</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span> </div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span><span class="keywordflow">if</span>(<a class="code hl_variable" href="namespacefilter__mod.html#a7d44418ecce7613f1e900dfd71e2c525">distributed_state</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a8e433f241a2a14ca4f6034f70ebe7cc9">init_ensemble_manager</a>(state_ens_handle, num_state_ens_copies, model_size)</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>   <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a> = <span class="stringliteral">&#39;running with distributed state; model states stay distributed across all tasks for the entire run&#39;</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a8e433f241a2a14ca4f6034f70ebe7cc9">init_ensemble_manager</a>(state_ens_handle, num_state_ens_copies, model_size, transpose_type_in = 2)</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>   <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a> = <span class="stringliteral">&#39;running without distributed state; model states are gathered by ensemble for forward operators&#39;</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="comment">! don&#39;t print if running single task.  transposes don&#39;t matter in this case.</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespacempi__utilities__mod.html#ae8ccd09884b18c6d167291247089bd27">task_count</a>() &gt; 1) &amp;</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>,<span class="stringliteral">&#39;filter_main:&#39;</span>, <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, <a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span> </div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span><span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a9f35904acaa6d026fc5d004a23104e23">set_num_extra_copies</a>(state_ens_handle, num_extras)</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  setting up space for ensembles&#39;</span>)</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span> </div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span><span class="comment">! Don&#39;t currently support number of processes &gt; model_size</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span><span class="keywordflow">if</span>(<a class="code hl_function" href="namespacempi__utilities__mod.html#ae8ccd09884b18c6d167291247089bd27">task_count</a>() &gt; model_size) <span class="keywordflow">then</span> </div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>   <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, *) <span class="stringliteral">&#39;number of MPI processes = &#39;</span>, <a class="code hl_function" href="namespacempi__utilities__mod.html#ae8ccd09884b18c6d167291247089bd27">task_count</a>(), &amp;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>                       <span class="stringliteral">&#39; while model size = &#39;</span>, model_size</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;filter_main&#39;</span>, &amp;</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>      <span class="stringliteral">&#39;Cannot have number of processes &gt; model size&#39;</span> ,<a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>, text2=<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>)</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span> </div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="keywordflow">if</span>(.not. <a class="code hl_variable" href="namespacefilter__mod.html#ab501d4bc83880f73c2b4d8425043701d">compute_posterior</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>   <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a> = <span class="stringliteral">&#39;skipping computation of posterior forward operators&#39;</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>,<span class="stringliteral">&#39;filter_main:&#39;</span>, <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, <a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span> </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span><span class="comment">! Set a time type for initial time if namelist inputs are not negative</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a7e5549afa9086b05dd99a6a7369473cf">filter_set_initial_time</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a7c24d0881a16cb679683d2a6e767fb86">init_time_days</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aed15c0af9f08f929a1d112381a09f6ad">init_time_seconds</a>, time1, read_time_from_file)</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span> </div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span><span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before reading in ensemble restart files&#39;</span>)</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before reading in ensemble restart files&#39;</span>)</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span> </div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span><span class="comment">! for now, assume that we only allow cycling if single_file_out is true.</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span><span class="comment">! code in this call needs to know how to initialize the output files.</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ae9eaef91b58f18b6b913aee9aa0ea912">initialize_file_information</a>(num_state_ens_copies ,                     &amp;</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>                                 file_info_input      , file_info_mean_sd,  &amp;</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>                                 file_info_forecast   , file_info_preassim, &amp;</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>                                 file_info_postassim  , file_info_analysis, &amp;</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>                                 file_info_output)</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span> </div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span><span class="keyword">call </span><a class="code hl_function" href="group__io__filenames__mod.html#ga84a5562fae8dc096e6b2330ad8da4bbf">check_file_info_variable_shape</a>(file_info_output, state_ens_handle)</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span> </div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span><span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#ga04f520c0ed73033b24269c4624e537ee">set_inflation_mean_copy</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a> )</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span><span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#ga6cd0390aea56fdaa321b9fb3f58c5e99">set_inflation_sd_copy</a>(   <a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a> )</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span><span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#ga04f520c0ed73033b24269c4624e537ee">set_inflation_mean_copy</a>( <a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>,  <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a> )</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span><span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#ga6cd0390aea56fdaa321b9fb3f58c5e99">set_inflation_sd_copy</a>(   <a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>,  <a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a> )</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span> </div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span><span class="keyword">call </span><a class="code hl_function" href="group__state__vector__io__mod.html#ga2cf6bb0500d00f01633c84ba7fc0be63">read_state</a>(state_ens_handle, file_info_input, read_time_from_file, time1, &amp;</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>                <a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ab21ff1ee87b3f7e9bfab3fed249624b1">perturb_from_single_instance</a>)</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span> </div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span><span class="comment">! This must be after read_state</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span><span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#gabcdf2fa88b452f8772a4812d1696b2fb">get_minmax_task_zero</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>, state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a>)</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span><span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#gaf9ad03b403779b745244bc055e04c6fc">log_inflation_info</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>, state_ens_handle%my_pe, <span class="stringliteral">&#39;Prior&#39;</span>, <a class="code hl_variable" href="namespacefilter__mod.html#a72faee5fd84c3e52b6191c8f0043693f">single_file_in</a>)</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span><span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#gabcdf2fa88b452f8772a4812d1696b2fb">get_minmax_task_zero</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>, state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a>)</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span><span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#gaf9ad03b403779b745244bc055e04c6fc">log_inflation_info</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>, state_ens_handle%my_pe, <span class="stringliteral">&#39;Posterior&#39;</span>, <a class="code hl_variable" href="namespacefilter__mod.html#a72faee5fd84c3e52b6191c8f0043693f">single_file_in</a>)</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span> </div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span> </div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#ab21ff1ee87b3f7e9bfab3fed249624b1">perturb_from_single_instance</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>,<span class="stringliteral">&#39;filter_main:&#39;</span>, &amp;</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>      <span class="stringliteral">&#39;Reading in a single member and perturbing data for the other ensemble members&#39;</span>)</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>   <span class="comment">! Only zero has the time, so broadcast the time to all other copy owners</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ac167793e46b9ae30bc56975ce777cae4">broadcast_time_across_copy_owners</a>(state_ens_handle, time1)</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9ee31f0112a3cd495806db9af6204aa4">create_ensemble_from_single_file</a>(state_ens_handle)</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>,<span class="stringliteral">&#39;filter_main:&#39;</span>, &amp;</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>      <span class="stringliteral">&#39;Reading in initial condition/restart data for all ensemble members from file(s)&#39;</span>)</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span> </div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  reading in ensemble restart files&#39;</span>)</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span><span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  reading in ensemble restart files&#39;</span>)</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span> </div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span><span class="comment">! see what our stance is on missing values in the state vector</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>allow_missing = <a class="code hl_function" href="namespaceoptions__mod.html#a536448bfef7c5c838d79e714ca7bbb6a">get_missing_ok_status</a>()</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span> </div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span><span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before initializing output files&#39;</span>)</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before initializing output files&#39;</span>)</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span> </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span><span class="comment">! Initialize the output sequences and state files and set their meta data</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a18dfcddac920a8f061dabcb6bb209896">filter_generate_copy_meta_data</a>(seq, in_obs_copy, &amp;</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>      prior_obs_mean_index, posterior_obs_mean_index, &amp;</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>      prior_obs_spread_index, posterior_obs_spread_index, &amp;</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>      <a class="code hl_variable" href="namespacefilter__mod.html#ab501d4bc83880f73c2b4d8425043701d">compute_posterior</a>)</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span> </div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  initializing output files&#39;</span>)</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span><span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  initializing output files&#39;</span>)</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span> </div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before trimming obs seq if start/stop time specified&#39;</span>)</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span> </div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span><span class="comment">! Need to find first obs with appropriate time, delete all earlier ones</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span><span class="keywordflow">if</span>(<a class="code hl_variable" href="namespacefilter__mod.html#ab4235d433b1b5d095798608d9032d8f0">first_obs_seconds</a> &gt; 0 .or. <a class="code hl_variable" href="namespacefilter__mod.html#adf38423aa561b42883a121952ee4ecd6">first_obs_days</a> &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>   first_obs_time = <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>(<a class="code hl_variable" href="namespacefilter__mod.html#ab4235d433b1b5d095798608d9032d8f0">first_obs_seconds</a>, <a class="code hl_variable" href="namespacefilter__mod.html#adf38423aa561b42883a121952ee4ecd6">first_obs_days</a>)</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a2b5fc4db58ccaae0b5804d4e77e721f4">delete_seq_head</a>(first_obs_time, seq, all_gone)</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>   <span class="keywordflow">if</span>(all_gone) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>      <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a> = <span class="stringliteral">&#39;All obs in sequence are before first_obs_days:first_obs_seconds&#39;</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;filter_main&#39;</span>,<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>,<a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span> </div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span><span class="comment">! Start assimilating at beginning of modified sequence</span></div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>last_key_used = -99</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span> </div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span><span class="comment">! Also get rid of observations past the last_obs_time if requested</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span><span class="keywordflow">if</span>(<a class="code hl_variable" href="namespacefilter__mod.html#abee3c2d14c91fe599a09d179c7c0f9a9">last_obs_seconds</a> &gt;= 0 .or. <a class="code hl_variable" href="namespacefilter__mod.html#af1e7b985d8df3e6af8f2587261d8641b">last_obs_days</a> &gt;= 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>   last_obs_time = <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>(<a class="code hl_variable" href="namespacefilter__mod.html#abee3c2d14c91fe599a09d179c7c0f9a9">last_obs_seconds</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af1e7b985d8df3e6af8f2587261d8641b">last_obs_days</a>)</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a2e39be37600163c6a933b87aa1dcb367">delete_seq_tail</a>(last_obs_time, seq, all_gone)</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>   <span class="keywordflow">if</span>(all_gone) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>      <a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a> = <span class="stringliteral">&#39;All obs in sequence are after last_obs_days:last_obs_seconds&#39;</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;filter_main&#39;</span>,<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>,<a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span> </div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  trimming obs seq if start/stop time specified&#39;</span>)</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span> </div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span><span class="comment">! Time step number is used to do periodic diagnostic output</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>time_step_number = -1</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>curr_ens_time = <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>(0, 0)</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>next_ens_time = <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>(0, 0)</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#aac69510af5cd47b53ce1c782db673a7b">filter_set_window_time</a>(window_time)</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span> </div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span><span class="comment">! Compute mean and spread</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span><span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a0f0832a7c5cabfb5291cf174adcd6b0a">compute_copy_mean_sd</a>(state_ens_handle, 1, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>)</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span> </div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span><span class="comment">! Write out the mean and sd for the input files if requested</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;input&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>   <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before input state space output&#39;</span>)</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before input state space output&#39;</span>)</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span> </div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">write_all_stages_at_end</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6cab091fff584d16a815ee1cae95cfc1">store_input</a>(state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>)</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>      <span class="comment">! if there is only one timestep in your input file insert the mean and sd if requested</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>      ntimes = <a class="code hl_function" href="group__direct__netcdf__mod.html#gafb7b451fc6de3f86bffb169fa700f668">nc_get_num_times</a>(file_info_input%stage_metadata%filenames(1,1))</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>        <span class="keywordflow">if</span> ( ntimes == 1 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>           <span class="keyword">call </span><a class="code hl_function" href="group__direct__netcdf__mod.html#ga4db4441591f610b3e2c4d06480c28535">write_augmented_state</a>(state_ens_handle, file_info_input)</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>           <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;filter_main&#39;</span>, &amp;</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>                   <span class="stringliteral">&#39;can not insert mean or spread into input files that have multiple time steps&#39;</span>,  &amp;</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>                   <a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>, text2=<span class="stringliteral">&#39;please remove &quot;input&quot; from stages_to_write&#39;</span>)</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>     <span class="keywordflow">else</span> <span class="comment">! muti file case</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>        <span class="comment">! write out input_mean.nc and input_sd.nc if requested</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>        <span class="keyword">call </span><a class="code hl_function" href="group__state__vector__io__mod.html#gab0cd1b1a5e523fff63e58b5e32aa137f">write_state</a>(state_ens_handle, file_info_mean_sd)</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span><span class="keywordflow">     endif</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span> </div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  input state space output&#39;</span>)</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>   <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  input state space output&#39;</span>)</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span> </div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span> </div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span> </div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>advancetime : <span class="keywordflow">do</span></div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Top of main advance time loop&#39;</span>)</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span> </div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>   time_step_number = time_step_number + 1</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>   <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a> , <span class="stringliteral">&#39;(A,I5)&#39;</span>) &amp;</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>      <span class="stringliteral">&#39;Main assimilation loop, starting iteration&#39;</span>, time_step_number</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39; &#39;</span>, <span class="stringliteral">&#39; &#39;</span>, -1)</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, <span class="stringliteral">&#39;filter: &#39;</span>, -1)</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span> </div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>   <span class="comment">! Check the time before doing the first model advance.  Not all tasks</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>   <span class="comment">! might have a time, so only check on PE0 if running multitask.</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>   <span class="comment">! This will get broadcast (along with the post-advance time) to all</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>   <span class="comment">! tasks so everyone has the same times, whether they have copies or not.</span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>   <span class="comment">! If smoothing, we need to know whether the move_ahead actually advanced</span></div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>   <span class="comment">! the model or not -- the first time through this loop the data timestamp</span></div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>   <span class="comment">! may already include the first observation, and the model will not need</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>   <span class="comment">! to be run.  Also, last time through this loop, the move_ahead call</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>   <span class="comment">! will determine if there are no more obs, not call the model, and return</span></div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>   <span class="comment">! with no keys in the list, which is how we know to exit.  In both of</span></div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>   <span class="comment">! these cases, we must not advance the times on the lags.</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span> </div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>   <span class="comment">! Figure out how far model needs to move data to make the window</span></div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>   <span class="comment">! include the next available observation.  recent change is</span></div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>   <span class="comment">! curr_ens_time in move_ahead() is intent(inout) and doesn&#39;t get changed</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>   <span class="comment">! even if there are no more obs.</span></div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before move_ahead checks time of data and next obs&#39;</span>)</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span> </div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__model__mod.html#ab274fdab0af4375f044a81cd6f27cb94">move_ahead</a>(state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, seq, last_key_used, window_time, &amp;</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>      key_bounds, num_obs_in_set, curr_ens_time, next_ens_time)</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span> </div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  move_ahead checks time of data and next obs&#39;</span>)</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span> </div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>   <span class="comment">! Only processes with an ensemble copy know to exit;</span></div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>   <span class="comment">! For now, let process 0 broadcast its value of key_bounds</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>   <span class="comment">! This will synch the loop here and allow everybody to exit</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>   <span class="comment">! Need to clean up and have a broadcast that just sends a single integer???</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>   <span class="comment">! PAR For now, can only broadcast real arrays</span></div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a29d20310501029db7a1c0444e07498c8">filter_sync_keys_time</a>(state_ens_handle, key_bounds, num_obs_in_set, &amp;</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>                              curr_ens_time, next_ens_time)</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span> </div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>   <span class="keywordflow">if</span>(key_bounds(1) &lt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;No more obs to assimilate, exiting main loop&#39;</span>, <span class="stringliteral">&#39;filter:&#39;</span>, -1)</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>      <span class="keywordflow">exit</span> advancetime</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span> </div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>   <span class="comment">! if model state data not at required time, advance model</span></div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>   <span class="keywordflow">if</span> (curr_ens_time /= next_ens_time) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span> </div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>      <span class="comment">! we are going to advance the model - make sure we&#39;re doing single file output</span></div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>      <span class="keywordflow">if</span> (.not. <a class="code hl_variable" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">has_cycling</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>         <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;filter:&#39;</span>, &amp;</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>             <span class="stringliteral">&#39;advancing the model inside filter and multiple file output not currently supported&#39;</span>, &amp;</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>             <a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>, text2=<span class="stringliteral">&#39;support will be added in subsequent releases&#39;</span>, &amp;</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>             text3=<span class="stringliteral">&#39;set &quot;single_file_out=.true&quot; for filter to advance the model, or advance the model outside filter&#39;</span>)</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span> </div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Ready to run model to advance data ahead in time&#39;</span>, <span class="stringliteral">&#39;filter:&#39;</span>, -1)</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a7e4cd481d9e540ad14c261eaa668cbab">print_ens_time</a>(state_ens_handle, <span class="stringliteral">&#39;Ensemble data time before advance&#39;</span>)</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>      <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before running model&#39;</span>)</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before running model&#39;</span>, sync=.true.)</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span> </div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>      <span class="comment">! make sure storage is allocated in ensemble manager for vars.</span></div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#ae290ccc4e130e2cc3280aff6a920eae5">allocate_vars</a>(state_ens_handle)</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span> </div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#ad77490836a39d93bafc07d1130b15d03">all_copies_to_all_vars</a>(state_ens_handle)</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span> </div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__model__mod.html#a03fc749b8153a9183a25baa68e40b6b1">advance_state</a>(state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, next_ens_time, <a class="code hl_variable" href="namespacefilter__mod.html#a12f0243b9f8139a944865f8ce704247c">async</a>, &amp;</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>              <a class="code hl_variable" href="namespacefilter__mod.html#a03faf9e8afe7f8f8daa826f225c936b4">adv_ens_command</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a982adbff91f97ba1e1ab17dc6023366f">tasks_per_model_advance</a>, file_info_output, file_info_input)</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span> </div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a560cdc48f932d328a341116abe462455">all_vars_to_all_copies</a>(state_ens_handle)</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span> </div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>      <span class="comment">! updated mean and spread after the model advance</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a0f0832a7c5cabfb5291cf174adcd6b0a">compute_copy_mean_sd</a>(state_ens_handle, 1, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>)</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span> </div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>      <span class="comment">! update so curr time is accurate.</span></div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>      curr_ens_time = next_ens_time</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>      state_ens_handle%current_time = curr_ens_time</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a448fd1d40ad4dc01e18b1035f72373f9">set_time_on_extra_copies</a>(state_ens_handle)</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span> </div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>      <span class="comment">! only need to sync here since we want to wait for the</span></div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>      <span class="comment">! slowest task to finish before outputting the time.</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  running model&#39;</span>, sync=.true.)</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>      <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  running model&#39;</span>)</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a7e4cd481d9e540ad14c261eaa668cbab">print_ens_time</a>(state_ens_handle, <span class="stringliteral">&#39;Ensemble data time after  advance&#39;</span>)</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Model does not need to run; data already at required time&#39;</span>, <span class="stringliteral">&#39;filter:&#39;</span>, -1)</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span> </div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before setup for next group of observations&#39;</span>)</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>   <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, <span class="stringliteral">&#39;(A,I7)&#39;</span>) <span class="stringliteral">&#39;Number of observations to be assimilated&#39;</span>, &amp;</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>      num_obs_in_set</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>)</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ab25b55818d4f6cd0b91c8a17365c4736">print_obs_time</a>(seq, key_bounds(1), <span class="stringliteral">&#39;Time of first observation in window&#39;</span>)</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ab25b55818d4f6cd0b91c8a17365c4736">print_obs_time</a>(seq, key_bounds(2), <span class="stringliteral">&#39;Time of last  observation in window&#39;</span>)</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span> </div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>   <span class="comment">! Create an ensemble for the observations from this time plus</span></div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>   <span class="comment">! obs_error_variance, observed value, key from sequence, global qc,</span></div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>   <span class="comment">! then mean for each group, then variance for each group</span></div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a8e433f241a2a14ca4f6034f70ebe7cc9">init_ensemble_manager</a>(obs_fwd_op_ens_handle, total_obs_copies, &amp;</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>                              int(num_obs_in_set,<a class="code hl_variable" href="namespacetypes__mod.html#abf1cb9466172ca1d02137e70ce1ae7e3">i8</a>), 1, transpose_type_in = 2)</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span> </div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>   <span class="comment">! Also need a qc field for copy of each observation</span></div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a8e433f241a2a14ca4f6034f70ebe7cc9">init_ensemble_manager</a>(qc_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, &amp;</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>                              int(num_obs_in_set,<a class="code hl_variable" href="namespacetypes__mod.html#abf1cb9466172ca1d02137e70ce1ae7e3">i8</a>), 1, transpose_type_in = 2)</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span> </div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>   <span class="comment">! Allocate storage for the keys for this number of observations</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>   <span class="keyword">allocate</span>(keys(num_obs_in_set)) <span class="comment">! This is still var size for writing out the observation sequence</span></div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span> </div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>   <span class="comment">! Get all the keys associated with this set of observations</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>   <span class="comment">! Is there a way to distribute this?</span></div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a519ce153ee2d450b79117a730296dcc9">get_time_range_keys</a>(seq, key_bounds, num_obs_in_set, keys)</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span> </div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  setup for next group of observations&#39;</span>)</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span> </div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>   <span class="comment">! Write out forecast file(s). This contains the incoming ensemble members and potentially</span></div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>   <span class="comment">! mean, sd, inflation values if requested.</span></div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;forecast&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>      <span class="keywordflow">if</span> ((<a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> &gt; 0) .and. &amp;</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>          (time_step_number / <a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> * <a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> == time_step_number)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span> </div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>         <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before forecast state space output&#39;</span>)</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before forecast state space output&#39;</span>)</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span> </div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>         <span class="comment">! save or output the data</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">write_all_stages_at_end</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>            <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ae4df205a40c5271f63f40b15a355a8ca">store_copies</a>(state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#a1d29faddb7d7f0f640f15c6a9e39b38b">forecast_copies</a>)</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>            <span class="keyword">call </span><a class="code hl_function" href="group__state__vector__io__mod.html#gab0cd1b1a5e523fff63e58b5e32aa137f">write_state</a>(state_ens_handle, file_info_forecast)</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span><span class="keywordflow">         endif</span></div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span> </div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  forecast state space output&#39;</span>)</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>         <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  forecast state space output&#39;</span>)</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span> </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span> </div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>   <span class="keywordflow">if</span>(<a class="code hl_function" href="group__adaptive__inflate.html#ga3f51d4c989b159a9a447451cae99116e">do_ss_inflate</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before prior inflation damping and prep&#39;</span>)</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span> </div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">inf_damping</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>) /= 1.0_r8) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>         state_ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, :) = 1.0_r8 + &amp;</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>            <a class="code hl_variable" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">inf_damping</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>) * (state_ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, :) - 1.0_r8)</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span> </div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a8fd1b250445c2c0f3787fb29ac42070d">filter_ensemble_inflate</a>(state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>, &amp;</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>                                   <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>)</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span> </div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>      <span class="comment">! Recompute the the mean and spread as required for diagnostics</span></div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a0f0832a7c5cabfb5291cf174adcd6b0a">compute_copy_mean_sd</a>(state_ens_handle, 1, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>)</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span> </div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  prior inflation damping and prep&#39;</span>)</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span> </div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>   <span class="comment">! if relaxation-to-prior-spread inflation, save the prior spread in SPARE_PRIOR_SPREAD</span></div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>   <span class="keywordflow">if</span> ( <a class="code hl_function" href="group__adaptive__inflate.html#gaaa80278515e32002fc8dfa1a431482af">do_rtps_inflate</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>) ) &amp;</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a0f0832a7c5cabfb5291cf174adcd6b0a">compute_copy_mean_sd</a>(state_ens_handle, 1, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, &amp;</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>                                   <a class="code hl_variable" href="namespacefilter__mod.html#aaf1e25fd8591ef5235d72965ec31be1a">spare_prior_spread</a>)</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span> </div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>   <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before computing prior observation values&#39;</span>)</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before computing prior observation values&#39;</span>)</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span> </div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>   <span class="comment">! Compute the ensemble of prior observations, load up the obs_err_var</span></div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>   <span class="comment">! and obs_values. ens_size is the number of regular ensemble members,</span></div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>   <span class="comment">! not the number of copies</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span> </div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>   <span class="comment">! allocate() space for the prior qc copy</span></div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a0b1af28e9b02fa19a22a44815e6994be">allocate_single_copy</a>(obs_fwd_op_ens_handle, prior_qc_copy)</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span> </div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceforward__operator__mod.html#af35dca4b85910d40d7a83747b059600b">get_obs_ens_distrib_state</a>(state_ens_handle, obs_fwd_op_ens_handle, &amp;</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>           qc_ens_handle, seq, keys, obs_val_index, input_qc_index, &amp;</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>           obs_err_var_copy, obs_val_copy, obs_key_copy, obs_global_qc_copy, &amp;</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>           obs_extra_qc_copy, obs_mean_start, obs_var_start, &amp;</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>           isprior=.true., prior_qc_copy=prior_qc_copy)</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span> </div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  computing prior observation values&#39;</span>)</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>   <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  computing prior observation values&#39;</span>)</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span> </div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>   <span class="comment">! Write out preassim diagnostic files if requested.  This contains potentially </span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>   <span class="comment">! damped prior inflation values and the inflated ensemble.</span></div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;preassim&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>      <span class="keywordflow">if</span> ((<a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> &gt; 0) .and. &amp;</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>          (time_step_number / <a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> * <a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> == time_step_number)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span> </div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>         <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before preassim state space output&#39;</span>)</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before preassim state space output&#39;</span>)</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span> </div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>         <span class="comment">! save or output the data</span></div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">write_all_stages_at_end</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>            <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ae4df205a40c5271f63f40b15a355a8ca">store_copies</a>(state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#aa78ffea5f7c1c36719ee2c6497cfeb06">preassim_copies</a>)</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>            <span class="keyword">call </span><a class="code hl_function" href="group__state__vector__io__mod.html#gab0cd1b1a5e523fff63e58b5e32aa137f">write_state</a>(state_ens_handle, file_info_preassim)</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span><span class="keywordflow">         endif</span></div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span> </div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  preassim state space output&#39;</span>)</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>         <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  preassim state space output&#39;</span>)</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span> </div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span> </div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before observation space diagnostics&#39;</span>)</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span> </div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>   <span class="comment">! This is where the mean obs</span></div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>   <span class="comment">! copy ( + others ) is moved to task 0 so task 0 can update seq.</span></div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>   <span class="comment">! There is a transpose (all_copies_to_all_vars(obs_fwd_op_ens_handle)) in obs_space_diagnostics</span></div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>   <span class="comment">! Do prior observation space diagnostics and associated quality control</span></div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#adf56dc433ec988bba9ea76465912e7fe">obs_space_diagnostics</a>(obs_fwd_op_ens_handle, qc_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, &amp;</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>           seq, keys, <a class="code hl_variable" href="namespacefilter__mod.html#ab8cdd1126d0e8c7b386f1a31be904877">prior_diag</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">num_output_obs_members</a>, in_obs_copy+1, &amp;</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>           obs_val_index, obs_key_copy, &amp;</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>           prior_obs_mean_index, prior_obs_spread_index, num_obs_in_set, &amp;</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>           obs_mean_start, obs_var_start, obs_global_qc_copy, &amp;</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>           obs_val_copy, obs_err_var_copy, dart_qc_index, <a class="code hl_variable" href="namespacefilter__mod.html#ab501d4bc83880f73c2b4d8425043701d">compute_posterior</a>)</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  observation space diagnostics&#39;</span>)</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span> </div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span> </div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>   <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, <span class="stringliteral">&#39;(A,I8,A)&#39;</span>) <span class="stringliteral">&#39;Ready to assimilate up to&#39;</span>, <span class="keyword">size</span>(keys), <span class="stringliteral">&#39; observations&#39;</span></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, <span class="stringliteral">&#39;filter:&#39;</span>, -1)</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span> </div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>   <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before observation assimilation&#39;</span>)</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before observation assimilation&#39;</span>)</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span> </div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>   <span class="keyword">call </span><a class="code hl_function" href="group__assim__tools.html#ga593869155163638696fb5a3f593a79b4">filter_assim</a>(state_ens_handle, obs_fwd_op_ens_handle, seq, keys, &amp;</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>      <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">num_groups</a>, obs_val_index, <a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>, &amp;</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>      <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>, &amp;</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>      <a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a>, obs_key_copy, obs_global_qc_copy, &amp;</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>      obs_mean_start, obs_mean_end, obs_var_start, &amp;</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>      obs_var_end, inflate_only = .false.)</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span> </div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  observation assimilation&#39;</span>)</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>   <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  observation assimilation&#39;</span>)</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span> </div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>   <span class="comment">! Already transformed, so compute mean and spread for state diag as needed</span></div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a0f0832a7c5cabfb5291cf174adcd6b0a">compute_copy_mean_sd</a>(state_ens_handle, 1, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>)</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span> </div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>   <span class="comment">! This block applies posterior inflation</span></div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span> </div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>   <span class="keywordflow">if</span>(<a class="code hl_function" href="group__adaptive__inflate.html#ga3f51d4c989b159a9a447451cae99116e">do_ss_inflate</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span> </div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before posterior inflation damping&#39;</span>)</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span> </div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">inf_damping</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>) /= 1.0_r8) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>         state_ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, :) = 1.0_r8 + &amp;</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>            <a class="code hl_variable" href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">inf_damping</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>) * (state_ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, :) - 1.0_r8)</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span> </div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  posterior inflation damping&#39;</span>)</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span> </div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span> </div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span> </div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>   <span class="comment">! Write out postassim diagnostic files if requested.  This contains the assimilated ensemble </span></div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>   <span class="comment">! and potentially damped posterior inflation and updated prior inflation.</span></div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;postassim&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>      <span class="keywordflow">if</span> ((<a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> &gt; 0) .and. &amp;</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>          (time_step_number / <a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> * <a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> == time_step_number)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span> </div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>         <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before postassim state space output&#39;</span>)</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before postassim state space output&#39;</span>)</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span> </div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>         <span class="comment">! save or output the data</span></div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">write_all_stages_at_end</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>            <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ae4df205a40c5271f63f40b15a355a8ca">store_copies</a>(state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#ab7d4c1aa67478d6c8aec44eb82d0c7e7">postassim_copies</a>)</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>            <span class="keyword">call </span><a class="code hl_function" href="group__state__vector__io__mod.html#gab0cd1b1a5e523fff63e58b5e32aa137f">write_state</a>(state_ens_handle, file_info_postassim)</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span><span class="keywordflow">         endif</span></div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span> </div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  postassim state space output&#39;</span>)</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>         <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  postassim state space output&#39;</span>)</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span> </div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span> </div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>   <span class="comment">! This block applies posterior inflation</span></div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span> </div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>   <span class="keywordflow">if</span>(<a class="code hl_function" href="group__adaptive__inflate.html#ga3f51d4c989b159a9a447451cae99116e">do_ss_inflate</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span> </div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before posterior inflation applied to state&#39;</span>)</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span> </div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="group__adaptive__inflate.html#gaaa80278515e32002fc8dfa1a431482af">do_rtps_inflate</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>)) <span class="keywordflow">then</span>   </div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a8fd1b250445c2c0f3787fb29ac42070d">filter_ensemble_inflate</a>(state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>, &amp;</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>                       <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aaf1e25fd8591ef5235d72965ec31be1a">spare_prior_spread</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>)</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a8fd1b250445c2c0f3787fb29ac42070d">filter_ensemble_inflate</a>(state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>, &amp;</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>                       <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>)</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span> </div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>      <span class="comment">! Recompute the mean or the mean and spread as required for diagnostics</span></div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a0f0832a7c5cabfb5291cf174adcd6b0a">compute_copy_mean_sd</a>(state_ens_handle, 1, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>)</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span> </div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  posterior inflation applied to state&#39;</span>)</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span> </div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span> </div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>   <span class="comment">! this block recomputes the expected obs values for the obs_seq.final file</span></div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span> </div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#ab501d4bc83880f73c2b4d8425043701d">compute_posterior</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>      <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before computing posterior observation values&#39;</span>)</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before computing posterior observation values&#39;</span>)</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>   </div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>      <span class="comment">! Compute the ensemble of posterior observations, load up the obs_err_var</span></div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>      <span class="comment">! and obs_values.  ens_size is the number of regular ensemble members,</span></div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>      <span class="comment">! not the number of copies</span></div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>   </div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>       <span class="keyword">call </span><a class="code hl_function" href="namespaceforward__operator__mod.html#af35dca4b85910d40d7a83747b059600b">get_obs_ens_distrib_state</a>(state_ens_handle, obs_fwd_op_ens_handle, &amp;</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>                qc_ens_handle, seq, keys, obs_val_index, input_qc_index, &amp;</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>                obs_err_var_copy, obs_val_copy, obs_key_copy, obs_global_qc_copy, &amp;</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>                obs_extra_qc_copy, obs_mean_start, obs_var_start, &amp;</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>                isprior=.false., prior_qc_copy=prior_qc_copy)</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>   </div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a13c0b50b0f720b889565d4f7c69fa619">deallocate_single_copy</a>(obs_fwd_op_ens_handle, prior_qc_copy)</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>   </div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  computing posterior observation values&#39;</span>)</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>      <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  computing posterior observation values&#39;</span>)</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>   </div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>   </div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before posterior obs space diagnostics&#39;</span>)</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>   </div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>      <span class="comment">! Write posterior observation space diagnostics</span></div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>      <span class="comment">! There is a transpose (all_copies_to_all_vars(obs_fwd_op_ens_handle)) in obs_space_diagnostics</span></div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#adf56dc433ec988bba9ea76465912e7fe">obs_space_diagnostics</a>(obs_fwd_op_ens_handle, qc_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, &amp;</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>              seq, keys, <a class="code hl_variable" href="namespacefilter__mod.html#a7966f96271850d19516047b1c7b38070">posterior_diag</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">num_output_obs_members</a>, in_obs_copy+2, &amp;</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>              obs_val_index, obs_key_copy, &amp;</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>              posterior_obs_mean_index, posterior_obs_spread_index, num_obs_in_set, &amp;</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>              obs_mean_start, obs_var_start, obs_global_qc_copy, &amp;</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>              obs_val_copy, obs_err_var_copy, dart_qc_index, <a class="code hl_variable" href="namespacefilter__mod.html#ab501d4bc83880f73c2b4d8425043701d">compute_posterior</a>)</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>   </div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  posterior obs space diagnostics&#39;</span>)</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>      <span class="comment">! call this alternate routine to collect any updated QC values that may</span></div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>      <span class="comment">! have been set in the assimilation loop and copy them to the outgoing obs seq</span></div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a0a62226d734bdac0c4382ccb5b40cb32">obs_space_sync_qcs</a>(obs_fwd_op_ens_handle, seq, keys, num_obs_in_set, &amp;</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>                              obs_global_qc_copy, dart_qc_index)</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a13c0b50b0f720b889565d4f7c69fa619">deallocate_single_copy</a>(obs_fwd_op_ens_handle, prior_qc_copy)</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span> </div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>   <span class="comment">! this block computes the adaptive state space posterior inflation</span></div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>   <span class="comment">! (it was applied earlier, this is computing the updated values for</span></div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>   <span class="comment">! the next cycle.)</span></div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span> </div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>   <span class="comment">! CSS added condition: Don&#39;t update posterior inflation if relaxing to prior spread</span></div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>   <span class="keywordflow">if</span>(<a class="code hl_function" href="group__adaptive__inflate.html#ga3f51d4c989b159a9a447451cae99116e">do_ss_inflate</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>) .and. ( .not. <a class="code hl_function" href="group__adaptive__inflate.html#gaaa80278515e32002fc8dfa1a431482af">do_rtps_inflate</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>)) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span> </div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>      <span class="comment">! If not reading the sd values from a restart file and the namelist initial</span></div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>      <span class="comment">!  sd &lt; 0, then bypass this entire code block altogether for speed.</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>      <span class="keywordflow">if</span> ((<a class="code hl_variable" href="namespacefilter__mod.html#a1fa8e21f160e9d2dfb2618ff99b840c4">inf_sd_initial</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>) &gt;= 0.0_r8) .or. &amp;</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>           <a class="code hl_variable" href="namespacefilter__mod.html#acc88936518a51aed421d731d3c628402">inf_sd_initial_from_restart</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span> </div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>         <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before computing posterior state space inflation&#39;</span>)</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before computing posterior state space inflation&#39;</span>)</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span> </div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>         <span class="keyword">call </span><a class="code hl_function" href="group__assim__tools.html#ga593869155163638696fb5a3f593a79b4">filter_assim</a>(state_ens_handle, obs_fwd_op_ens_handle, seq, keys, &amp;</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>                 <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">num_groups</a>, obs_val_index, <a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>, &amp;</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>                 <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a>, &amp;</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>                 obs_key_copy, obs_global_qc_copy, obs_mean_start, obs_mean_end, &amp;</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>                 obs_var_start, obs_var_end, inflate_only = .true.)</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span> </div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  computing posterior state space inflation&#39;</span>)</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>         <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  computing posterior state space inflation&#39;</span>)</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span> </div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>         <span class="comment">! recalculate standard deviation since this was overwritten in filter_assim</span></div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>         <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a0f0832a7c5cabfb5291cf174adcd6b0a">compute_copy_mean_sd</a>(state_ens_handle, 1, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>)</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span> </div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span> </div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span><span class="keywordflow">      endif</span>  <span class="comment">! sd &gt;= 0 or sd from restart file</span></div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span><span class="keywordflow">   endif</span>  <span class="comment">! if doing state space posterior inflate</span></div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span> </div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>   <span class="comment">! Write out analysis diagnostic files if requested.  This contains the </span></div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>   <span class="comment">! posterior inflated ensemble and updated {prior,posterior} inflation values</span></div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;analysis&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>      <span class="keywordflow">if</span> ((<a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> &gt; 0) .and. &amp;</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>          (time_step_number / <a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> * <a class="code hl_variable" href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">output_interval</a> == time_step_number)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span> </div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>         <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before analysis state space output&#39;</span>)</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before analysis state space output&#39;</span>)</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span> </div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>         <span class="comment">! save or output the data</span></div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">write_all_stages_at_end</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>            <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ae4df205a40c5271f63f40b15a355a8ca">store_copies</a>(state_ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#a38ed5812756013876b9a3fb4319d1ec5">analysis_copies</a>)</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>            <span class="keyword">call </span><a class="code hl_function" href="group__state__vector__io__mod.html#gab0cd1b1a5e523fff63e58b5e32aa137f">write_state</a>(state_ens_handle, file_info_analysis)</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span><span class="keywordflow">         endif</span></div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span> </div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  analysis state space output&#39;</span>)</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>         <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  analysis state space output&#39;</span>)</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span> </div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span> </div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>   <span class="comment">! only intended for debugging when cycling inside filter.</span></div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>   <span class="comment">! writing the obs_seq file here will be slow - but if filter crashes</span></div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>   <span class="comment">! you can get partial results by enabling this flag.</span></div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a5cab9c21b1b37f563e583a4789290337">write_obs_every_cycle</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>      <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before writing in-progress output sequence file&#39;</span>)</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before writing in-progress output sequence file&#39;</span>)</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>      <span class="comment">! Only pe 0 outputs the observation space diagnostic file</span></div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>      <span class="keywordflow">if</span>(<a class="code hl_function" href="namespacempi__utilities__mod.html#ae08b6543f55b372bd6addea0eb1e04a0">my_task_id</a>() == 0) <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a24c15eefbff5a6484a7cf953678e6ca7">write_obs_seq</a>(seq, <a class="code hl_variable" href="namespacefilter__mod.html#a77b537fbf821744ae02ea89603f1c92c">obs_sequence_out_name</a>)</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  writing in-progress output sequence file&#39;</span>)</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>      <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  writing in-progress output sequence file&#39;</span>)</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span> </div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Near bottom of main loop, cleaning up obs space&#39;</span>)</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>   <span class="comment">! Deallocate storage used for keys for each set</span></div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>   <span class="keyword">deallocate</span>(keys)</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span> </div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>   <span class="comment">! The last key used is updated to move forward in the observation sequence</span></div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>   last_key_used = key_bounds(2)</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span> </div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>   <span class="comment">! Free up the obs ensemble space; LATER, can just keep it if obs are same size next time</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#af5913d365d22029f1cb212eabb965833">end_ensemble_manager</a>(obs_fwd_op_ens_handle)</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#af5913d365d22029f1cb212eabb965833">end_ensemble_manager</a>(qc_ens_handle)</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span> </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Bottom of main advance time loop&#39;</span>)</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span> </div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span><span class="keywordflow">end do</span> advancetime</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span> </div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;End of main filter assimilation loop, starting cleanup&#39;</span>, <span class="stringliteral">&#39;filter:&#39;</span>, -1)</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span> </div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span><span class="comment">! Output the adjusted ensemble. If cycling only the last timestep is writen out</span></div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;output&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>      <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before state space output&#39;</span>)</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before state space output&#39;</span>)</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span> </div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>      <span class="comment">! will write outside loop</span></div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>      <span class="keywordflow">if</span> (.not. <a class="code hl_variable" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">write_all_stages_at_end</a>) &amp;</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>         <span class="keyword">call </span><a class="code hl_function" href="group__state__vector__io__mod.html#gab0cd1b1a5e523fff63e58b5e32aa137f">write_state</a>(state_ens_handle, file_info_output)</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>   </div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  state space output&#39;</span>)</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>      <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  state space output&#39;</span>)</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span> </div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span> </div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span><span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before writing output sequence file&#39;</span>)</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before writing output sequence file&#39;</span>)</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span><span class="comment">! Only pe 0 outputs the observation space diagnostic file</span></div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span><span class="keywordflow">if</span>(<a class="code hl_function" href="namespacempi__utilities__mod.html#ae08b6543f55b372bd6addea0eb1e04a0">my_task_id</a>() == 0) <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a24c15eefbff5a6484a7cf953678e6ca7">write_obs_seq</a>(seq, <a class="code hl_variable" href="namespacefilter__mod.html#a77b537fbf821744ae02ea89603f1c92c">obs_sequence_out_name</a>)</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  writing output sequence file&#39;</span>)</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span><span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  writing output sequence file&#39;</span>)</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span> </div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span><span class="comment">! Output all restart files if requested</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">write_all_stages_at_end</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>   <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before writing all state restart files at end&#39;</span>)</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Before writing all state restart files at end&#39;</span>)</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span> </div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>   file_info_all = <a class="code hl_function" href="group__io__filenames__mod.html#ga0136923a3644e55ac4ddf7216026fbcd">combine_file_info</a>( &amp;</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>                    (/file_info_input, file_info_mean_sd, file_info_forecast, &amp;</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>                      file_info_preassim, file_info_postassim, file_info_analysis, &amp;</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>                      file_info_output/) )</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span> </div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>   <span class="keyword">call </span><a class="code hl_function" href="group__state__vector__io__mod.html#gab0cd1b1a5e523fff63e58b5e32aa137f">write_state</a>(state_ens_handle, file_info_all)</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span> </div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;After  writing all state restart files at end&#39;</span>)</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>   <span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  writing all state restart files at end&#39;</span>)</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span> </div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span><span class="comment">! close the diagnostic/restart netcdf files</span></div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span> </div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;forecast&#39;</span>)) &amp;</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>      <span class="keyword">call </span><a class="code hl_function" href="group__direct__netcdf__mod.html#ga5da57561c4275530367b53a116303f9f">finalize_single_file_io</a>(file_info_forecast)</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span> </div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;preassim&#39;</span>)) &amp;</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>      <span class="keyword">call </span><a class="code hl_function" href="group__direct__netcdf__mod.html#ga5da57561c4275530367b53a116303f9f">finalize_single_file_io</a>(file_info_preassim)</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span> </div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;postassim&#39;</span>)) &amp;</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>      <span class="keyword">call </span><a class="code hl_function" href="group__direct__netcdf__mod.html#ga5da57561c4275530367b53a116303f9f">finalize_single_file_io</a>(file_info_postassim)</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span> </div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;analysis&#39;</span>)) &amp;</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>      <span class="keyword">call </span><a class="code hl_function" href="group__direct__netcdf__mod.html#ga5da57561c4275530367b53a116303f9f">finalize_single_file_io</a>(file_info_analysis)</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span> </div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;output&#39;</span>)) &amp;</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>      <span class="keyword">call </span><a class="code hl_function" href="group__direct__netcdf__mod.html#ga5da57561c4275530367b53a116303f9f">finalize_single_file_io</a>(file_info_output)</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span> </div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span><span class="comment">! Give the model_mod code a chance to clean up.</span></div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before end_model call&#39;</span>)</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span><span class="keyword">call </span><a class="code hl_function" href="namespaceassim__model__mod.html#aaaf9136986343075c66fc81616b24c43">end_assim_model</a>()</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  end_model call&#39;</span>)</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span> </div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span><span class="comment">! deallocate qceff_table_data structures</span></div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span><span class="keyword">call </span><a class="code hl_function" href="namespacealgorithm__info__mod.html#aceea3ca8de97dd02da91db543102682a">end_algorithm_info_mod</a>()</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span> </div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before ensemble and obs memory cleanup&#39;</span>)</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span><span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#af5913d365d22029f1cb212eabb965833">end_ensemble_manager</a>(state_ens_handle)</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span> </div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span><span class="comment">! Free up the obs sequence</span></div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span><span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a04453c924b6c433af2d05c3260432f5a">destroy_obs_sequence</a>(seq)</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After  ensemble and obs memory cleanup&#39;</span>)</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span> </div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span><span class="keyword">call     </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Filter done&#39;</span>)</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(<span class="stringliteral">&#39;Filter done&#39;</span>)</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span><span class="keywordflow">if</span>(<a class="code hl_function" href="namespacempi__utilities__mod.html#ae08b6543f55b372bd6addea0eb1e04a0">my_task_id</a>() == 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>   <span class="keyword">write</span>(<a class="code hl_variable" href="namespaceutilities__mod.html#a7f7028c1f8fd499c0964b9955a7c0149">logfileunit</a>,*)<span class="stringliteral">&#39;FINISHED filter.&#39;</span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>   <span class="keyword">write</span>(<a class="code hl_variable" href="namespaceutilities__mod.html#a7f7028c1f8fd499c0964b9955a7c0149">logfileunit</a>,*)</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span> </div>
</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#abfe5d4c835d0046ed1e49f24094a01ff">filter_main</a></div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span> </div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span><span class="comment">!-----------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span><span class="comment">!&gt; This generates the copy meta data for the diagnostic files.</span></div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span><span class="comment">!&gt; And also creates the state space diagnostic file.</span></div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span><span class="comment">!&gt; Note for the state space diagnostic files the order of copies</span></div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span><span class="comment">!&gt; in the diagnostic file is different from the order of copies</span></div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span><span class="comment">!&gt; in the ensemble handle.</span></div>
<div class="foldopen" id="foldopen01173" data-start="" data-end="">
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a18dfcddac920a8f061dabcb6bb209896"> 1173</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a18dfcddac920a8f061dabcb6bb209896">filter_generate_copy_meta_data</a>(seq, in_obs_copy, &amp;</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>   prior_obs_mean_index, posterior_obs_mean_index, &amp;</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>   prior_obs_spread_index, posterior_obs_spread_index, &amp;</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>   do_post)</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span> </div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>),     <span class="keywordtype">intent(inout)</span> :: seq</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span><span class="keywordtype">integer</span>,                     <span class="keywordtype">intent(in)</span>    :: in_obs_copy</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span><span class="keywordtype">integer</span>,                     <span class="keywordtype">intent(out)</span>   :: prior_obs_mean_index</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span><span class="keywordtype">integer</span>,                     <span class="keywordtype">intent(out)</span>   :: posterior_obs_mean_index</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span><span class="keywordtype">integer</span>,                     <span class="keywordtype">intent(out)</span>   :: prior_obs_spread_index</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span><span class="keywordtype">integer</span>,                     <span class="keywordtype">intent(out)</span>   :: posterior_obs_spread_index</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span><span class="keywordtype">logical</span>,                     <span class="keywordtype">intent(in)</span>    :: do_post</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span> </div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span><span class="comment">! Figures out the strings describing the output copies for the three output files.</span></div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span><span class="comment">! THese are the prior and posterior state output files and the observation sequence</span></div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span><span class="comment">! output file which contains both prior and posterior data.</span></div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span> </div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span><span class="keywordtype">character(len=metadatalength)</span> :: prior_meta_data, posterior_meta_data</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span><span class="keywordtype">integer</span> :: i, num_obs_copies</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span> </div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span><span class="comment">! only PE0 (here task 0) will allocate space for the obs_seq.final</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span><span class="comment">!</span></div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span><span class="comment">! all other tasks should NOT allocate all this space.</span></div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span><span class="comment">! instead, set the copy numbers to an illegal value</span></div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span><span class="comment">! so we&#39;ll trap if they&#39;re used, and return early.</span></div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespacempi__utilities__mod.html#ae08b6543f55b372bd6addea0eb1e04a0">my_task_id</a>() /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>   prior_obs_mean_index  = -1</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>   posterior_obs_mean_index = -1</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>   prior_obs_spread_index  = -1</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>   posterior_obs_spread_index = -1</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>   <span class="keywordflow">return</span></div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>  </div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span><span class="comment">! Set the metadata for the observations.</span></div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span> </div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span><span class="comment">! Set up obs ensemble mean</span></div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>num_obs_copies = in_obs_copy</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span> </div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>num_obs_copies = num_obs_copies + 1</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>prior_meta_data = <span class="stringliteral">&#39;prior ensemble mean&#39;</span></div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span><span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d6f7b7025c6c9d400bdaa4a9d15013e">set_copy_meta_data</a>(seq, num_obs_copies, prior_meta_data)</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>prior_obs_mean_index = num_obs_copies</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span> </div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span><span class="keywordflow">if</span> (do_post) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>   num_obs_copies = num_obs_copies + 1</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>   posterior_meta_data = <span class="stringliteral">&#39;posterior ensemble mean&#39;</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d6f7b7025c6c9d400bdaa4a9d15013e">set_copy_meta_data</a>(seq, num_obs_copies, posterior_meta_data)</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>   posterior_obs_mean_index = num_obs_copies</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span> </div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span><span class="comment">! Set up obs ensemble spread</span></div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>num_obs_copies = num_obs_copies + 1</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>prior_meta_data = <span class="stringliteral">&#39;prior ensemble spread&#39;</span></div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span><span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d6f7b7025c6c9d400bdaa4a9d15013e">set_copy_meta_data</a>(seq, num_obs_copies, prior_meta_data)</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>prior_obs_spread_index = num_obs_copies</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span> </div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span><span class="keywordflow">if</span> (do_post) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>   num_obs_copies = num_obs_copies + 1</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>   posterior_meta_data = <span class="stringliteral">&#39;posterior ensemble spread&#39;</span></div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d6f7b7025c6c9d400bdaa4a9d15013e">set_copy_meta_data</a>(seq, num_obs_copies, posterior_meta_data)</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>   posterior_obs_spread_index = num_obs_copies</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span> </div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span><span class="comment">! Make sure there are not too many copies requested - </span></div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span><span class="comment">! proposed: make this magic number set in 1 place with an accessor</span></div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span><span class="comment">! routine so all parts of the code agree on max values.</span></div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span><span class="keywordflow">if</span>(<a class="code hl_variable" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">num_output_obs_members</a> &gt; 10000) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>   <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, *)<span class="stringliteral">&#39;output metadata in filter needs obs ensemble size &lt; 10000, not &#39;</span>,&amp;</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>                      <a class="code hl_variable" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">num_output_obs_members</a></div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;filter_generate_copy_meta_data&#39;</span>,<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>,<a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span> </div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span><span class="comment">! Set up obs ensemble members as requested</span></div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span><span class="keywordflow">do</span> i = 1, <a class="code hl_variable" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">num_output_obs_members</a></div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>   num_obs_copies = num_obs_copies + 1</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>   <span class="keyword">write</span>(prior_meta_data, <span class="stringliteral">&#39;(a21, 1x, i6)&#39;</span>) <span class="stringliteral">&#39;prior ensemble member&#39;</span>, i</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d6f7b7025c6c9d400bdaa4a9d15013e">set_copy_meta_data</a>(seq, num_obs_copies, prior_meta_data)</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>   <span class="keywordflow">if</span> (do_post) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>      num_obs_copies = num_obs_copies + 1</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>      <span class="keyword">write</span>(posterior_meta_data, <span class="stringliteral">&#39;(a25, 1x, i6)&#39;</span>) <span class="stringliteral">&#39;posterior ensemble member&#39;</span>, i</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d6f7b7025c6c9d400bdaa4a9d15013e">set_copy_meta_data</a>(seq, num_obs_copies, posterior_meta_data)</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span><span class="keywordflow">end do</span></div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span> </div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span> </div>
</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a18dfcddac920a8f061dabcb6bb209896">filter_generate_copy_meta_data</a></div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span> </div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span> </div>
<div class="foldopen" id="foldopen01262" data-start="" data-end="">
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ab2c376d8c98d53a47939ed391ced0654"> 1262</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ab2c376d8c98d53a47939ed391ced0654">filter_initialize_modules_used</a>()</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span> </div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;Before filter_initialize_module_used call&#39;</span>)</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span> </div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span><span class="comment">! Initialize the obs sequence module</span></div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span><span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#af0206e62734fbd29cd26a3487e7a8997">static_init_obs_sequence</a>()</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span> </div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span><span class="comment">! Initialize the model class data now that obs_sequence is all set up</span></div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span><span class="keyword">call </span><a class="code hl_function" href="namespaceassim__model__mod.html#a85453749da1f84414285aa89f143bfc6">static_init_assim_model</a>()</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span><span class="keyword">call </span><a class="code hl_function" href="group__state__vector__io__mod.html#gaa022725c0fb4622a7ee3cc13eb92a2aa">state_vector_io_init</a>()</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span><span class="keyword">call </span><a class="code hl_function" href="namespacequality__control__mod.html#a342c54d59c3177cff4f0a1b7c963728c">initialize_qc</a>()</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span> </div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span><span class="comment">! Initialize algorothm_info_mod and read in QCF table data</span></div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span><span class="keyword">call </span><a class="code hl_function" href="namespacealgorithm__info__mod.html#ac3aa86f6c6131c861fe87798b65ebf4b">init_algorithm_info_mod</a>()</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span> </div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(<span class="stringliteral">&#39;After filter_initialize_module_used call&#39;</span>)</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span> </div>
</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ab2c376d8c98d53a47939ed391ced0654">filter_initialize_modules_used</a></div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span> </div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span> </div>
<div class="foldopen" id="foldopen01283" data-start="" data-end="">
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a0ff0be69ea73156970fbb804687c8a60"> 1283</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a0ff0be69ea73156970fbb804687c8a60">filter_setup_obs_sequence</a>(seq, in_obs_copy, obs_val_index, &amp;</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>   input_qc_index, DART_qc_index, do_post)</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span> </div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>), <span class="keywordtype">intent(inout)</span> :: seq</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(out)</span>   :: in_obs_copy, obs_val_index</div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(out)</span>   :: input_qc_index, DART_qc_index</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span><span class="keywordtype">logical</span>,                 <span class="keywordtype">intent(in)</span>    :: do_post</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span> </div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span><span class="keywordtype">character(len=metadatalength)</span> :: no_qc_meta_data = <span class="stringliteral">&#39;No incoming data QC&#39;</span></div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span><span class="keywordtype">character(len=metadatalength)</span> :: dqc_meta_data   = <span class="stringliteral">&#39;DART quality control&#39;</span></div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span><span class="keywordtype">character(len=129)</span> :: obs_seq_read_format</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span><span class="keywordtype">integer</span> :: obs_seq_file_id, copies_num_inc, qc_num_inc</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span><span class="keywordtype">integer</span> :: tnum_copies, tnum_qc, tnum_obs, tmax_num_obs</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span><span class="keywordtype">integer</span> :: my_task, io_task</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span><span class="keywordtype">logical</span> :: pre_I_format</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span> </div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span><span class="comment">! Input file can have one qc field, none, or more.  note that read_obs_seq_header</span></div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span><span class="comment">! does NOT return the actual metadata values, which would be helpful in trying</span></div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span><span class="comment">! to decide if we need to add copies or qcs.</span></div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span><span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a75c8a2e004f5e060234b1ce4e776356c">read_obs_seq_header</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a5931e52ebd8d067e36ce011e28b6f8c9">obs_sequence_in_name</a>, tnum_copies, tnum_qc, tnum_obs, tmax_num_obs, &amp;</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>   obs_seq_file_id, obs_seq_read_format, pre_i_format, close_the_file = .true.)</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span> </div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span><span class="comment">! return the original number of copies in the obs_seq file</span></div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span><span class="comment">! before we add any copies for diagnostics.</span></div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>in_obs_copy = tnum_copies</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span> </div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span><span class="comment">! FIXME: this should be called from inside obs_space_diagnostics the first</span></div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span><span class="comment">! time that routine is called, so it has an ensemble handle to query for </span></div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span><span class="comment">! exactly which task is pe0 (or use a different pe number).  here we </span></div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span><span class="comment">! have to assume task 0 == pe 0 which is currently true but someday</span></div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span><span class="comment">! we would like to be able to change.</span></div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>io_task = 0</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>my_task = <a class="code hl_function" href="namespacempi__utilities__mod.html#ae08b6543f55b372bd6addea0eb1e04a0">my_task_id</a>()</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span> </div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span><span class="comment">! only the task writing the obs_seq.final file needs space for the</span></div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span><span class="comment">! additional copies/qcs.  for large numbers of individual members</span></div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span><span class="comment">! in the final file this takes quite a bit of memory. </span></div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span> </div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span><span class="keywordflow">if</span> (my_task == io_task) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>   <span class="comment">! Determine the number of output obs space fields</span></div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>   <span class="keywordflow">if</span> (do_post) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>      <span class="comment">! 4 is for prior/posterior mean and spread, plus</span></div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>      <span class="comment">! prior/posterior values for all requested members</span></div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>      copies_num_inc = 4 + (2 * <a class="code hl_variable" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">num_output_obs_members</a>)</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>      <span class="comment">! 2 is for prior mean and spread, plus</span></div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>      <span class="comment">! prior values for all requested members</span></div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>      copies_num_inc = 2 + (1 * <a class="code hl_variable" href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">num_output_obs_members</a>)</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>   copies_num_inc = 0</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span> </div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span><span class="comment">! if there are less than 2 incoming qc fields, we will need</span></div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span><span class="comment">! to make at least 2 (one for the dummy data qc and one for</span></div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span><span class="comment">! the dart qc) on task 0.  other tasks just need 1 for incoming qc.</span></div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span><span class="keywordflow">if</span> (tnum_qc &lt; 2) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>   <span class="keywordflow">if</span> (my_task == io_task) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>      qc_num_inc = 2 - tnum_qc</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>      qc_num_inc = 1 - tnum_qc</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>   qc_num_inc = 0</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span> </div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span><span class="comment">! Read in with enough space for diagnostic output values and add&#39;l qc field(s)</span></div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span><span class="comment">! ONLY ADD SPACE ON TASK 0.  everyone else just read in the original obs_seq file.</span></div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span><span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a65bd44dd192cbaa173c1a6abb5e900e2">read_obs_seq</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a5931e52ebd8d067e36ce011e28b6f8c9">obs_sequence_in_name</a>, copies_num_inc, qc_num_inc, 0, seq)</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span> </div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span><span class="comment">! check to be sure that we have an incoming qc field.  if not, look for</span></div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span><span class="comment">! a blank qc field</span></div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>input_qc_index = <a class="code hl_function" href="namespacefilter__mod.html#a015eadf785bd049f7206906db314cb39">get_obs_qc_index</a>(seq)</div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span><span class="keywordflow">if</span> (input_qc_index &lt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>   input_qc_index = <a class="code hl_function" href="namespacefilter__mod.html#a8e2ebccfd942a3b044aa43c9b7e82a70">get_blank_qc_index</a>(seq)</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>   <span class="keywordflow">if</span> (input_qc_index &lt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>      <span class="comment">! Need 1 new qc field for dummy incoming qc</span></div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a84db51e90a66b42eb04d2fcb29e6d616">add_qc</a>(seq, 1)</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>      input_qc_index = <a class="code hl_function" href="namespacefilter__mod.html#a8e2ebccfd942a3b044aa43c9b7e82a70">get_blank_qc_index</a>(seq)</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>      <span class="keywordflow">if</span> (input_qc_index &lt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>         <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;filter_setup_obs_sequence&#39;</span>, &amp;</div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>           <span class="stringliteral">&#39;error adding blank qc field to sequence; should not happen&#39;</span>, <a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>   <span class="comment">! Since we are constructing a dummy QC, label it as such</span></div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#aaf29a2edd6656bc1159b6e0b81d017bb">set_qc_meta_data</a>(seq, input_qc_index, no_qc_meta_data)</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span> </div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span><span class="comment">! check to be sure we either find an existing dart qc field and</span></div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span><span class="comment">! reuse it, or we add a new one. only on task 0.</span></div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>dart_qc_index = <a class="code hl_function" href="namespacefilter__mod.html#a585dca55b5debccfa928f3ebcf204f33">get_obs_dartqc_index</a>(seq)</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span><span class="keywordflow">if</span> (dart_qc_index &lt; 0 .and. my_task == io_task) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>   dart_qc_index = <a class="code hl_function" href="namespacefilter__mod.html#a8e2ebccfd942a3b044aa43c9b7e82a70">get_blank_qc_index</a>(seq)</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>   <span class="keywordflow">if</span> (dart_qc_index &lt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>      <span class="comment">! Need 1 new qc field for the DART quality control</span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a84db51e90a66b42eb04d2fcb29e6d616">add_qc</a>(seq, 1)</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>      dart_qc_index = <a class="code hl_function" href="namespacefilter__mod.html#a8e2ebccfd942a3b044aa43c9b7e82a70">get_blank_qc_index</a>(seq)</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>      <span class="keywordflow">if</span> (dart_qc_index &lt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>         <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;filter_setup_obs_sequence&#39;</span>, &amp;</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>           <span class="stringliteral">&#39;error adding blank qc field to sequence; should not happen&#39;</span>, <a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#aaf29a2edd6656bc1159b6e0b81d017bb">set_qc_meta_data</a>(seq, dart_qc_index, dqc_meta_data)</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span> </div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span><span class="comment">! Determine which copy has actual obs value and return it.</span></div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>obs_val_index = <a class="code hl_function" href="namespacefilter__mod.html#a45d8882093c501baf81dab4bbfaecd47">get_obs_copy_index</a>(seq)</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span> </div>
</div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a0ff0be69ea73156970fbb804687c8a60">filter_setup_obs_sequence</a></div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span> </div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span> </div>
<div class="foldopen" id="foldopen01395" data-start="" data-end="">
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a45d8882093c501baf81dab4bbfaecd47"> 1395</a></span><span class="keyword">function </span><a class="code hl_function" href="namespacefilter__mod.html#a45d8882093c501baf81dab4bbfaecd47">get_obs_copy_index</a>(seq)</div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span> </div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>), <span class="keywordtype">intent(in)</span> :: seq</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span><span class="keywordtype">integer</span>                             :: <a class="code hl_function" href="namespacefilter__mod.html#a45d8882093c501baf81dab4bbfaecd47">get_obs_copy_index</a></div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span> </div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span><span class="keywordtype">integer</span> :: i</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span> </div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span><span class="comment">! Determine which copy in sequence has actual obs</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span> </div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span><span class="keywordflow">do</span> i = 1, <a class="code hl_function" href="namespaceobs__sequence__mod.html#afdc0061940a4415db77188d81429ac97">get_num_copies</a>(seq)</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>   <a class="code hl_function" href="namespacefilter__mod.html#a45d8882093c501baf81dab4bbfaecd47">get_obs_copy_index</a> = i</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>   <span class="comment">! Need to look for &#39;observation&#39;</span></div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>   <span class="keywordflow">if</span>(index(<a class="code hl_function" href="namespaceobs__sequence__mod.html#a3373f7292e3704ca5ac594e939f0523f">get_copy_meta_data</a>(seq, i), <span class="stringliteral">&#39;observation&#39;</span>) &gt; 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span><span class="keywordflow">end do</span></div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span><span class="comment">! Falling of end means &#39;observations&#39; not found; die</span></div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span><span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;get_obs_copy_index&#39;</span>, &amp;</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>   <span class="stringliteral">&#39;Did not find observation copy with metadata &quot;observation&quot;&#39;</span>, <a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span> </div>
</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span><span class="keyword">end function </span><a class="code hl_function" href="namespacefilter__mod.html#a45d8882093c501baf81dab4bbfaecd47">get_obs_copy_index</a></div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span> </div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span> </div>
<div class="foldopen" id="foldopen01417" data-start="" data-end="">
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ae2547988fa5bca92f49db99a8c35b884"> 1417</a></span><span class="keyword">function </span><a class="code hl_function" href="namespacefilter__mod.html#ae2547988fa5bca92f49db99a8c35b884">get_obs_prior_index</a>(seq)</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span> </div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>), <span class="keywordtype">intent(in)</span> :: seq</div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span><span class="keywordtype">integer</span>                             :: <a class="code hl_function" href="namespacefilter__mod.html#ae2547988fa5bca92f49db99a8c35b884">get_obs_prior_index</a></div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span> </div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span><span class="keywordtype">integer</span> :: i</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span> </div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span><span class="comment">! Determine which copy in sequence has prior mean, if any.</span></div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span> </div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span><span class="keywordflow">do</span> i = 1, <a class="code hl_function" href="namespaceobs__sequence__mod.html#afdc0061940a4415db77188d81429ac97">get_num_copies</a>(seq)</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>   <a class="code hl_function" href="namespacefilter__mod.html#ae2547988fa5bca92f49db99a8c35b884">get_obs_prior_index</a> = i</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>   <span class="comment">! Need to look for &#39;prior mean&#39;</span></div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>   <span class="keywordflow">if</span>(index(<a class="code hl_function" href="namespaceobs__sequence__mod.html#a3373f7292e3704ca5ac594e939f0523f">get_copy_meta_data</a>(seq, i), <span class="stringliteral">&#39;prior ensemble mean&#39;</span>) &gt; 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span><span class="keywordflow">end do</span></div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span><span class="comment">! Falling of end means &#39;prior mean&#39; not found; not fatal!</span></div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span> </div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span><a class="code hl_function" href="namespacefilter__mod.html#ae2547988fa5bca92f49db99a8c35b884">get_obs_prior_index</a> = -1</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span> </div>
</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span><span class="keyword">end function </span><a class="code hl_function" href="namespacefilter__mod.html#ae2547988fa5bca92f49db99a8c35b884">get_obs_prior_index</a></div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span> </div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span> </div>
<div class="foldopen" id="foldopen01439" data-start="" data-end="">
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a015eadf785bd049f7206906db314cb39"> 1439</a></span><span class="keyword">function </span><a class="code hl_function" href="namespacefilter__mod.html#a015eadf785bd049f7206906db314cb39">get_obs_qc_index</a>(seq)</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span> </div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>), <span class="keywordtype">intent(in)</span> :: seq</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span><span class="keywordtype">integer</span>                             :: <a class="code hl_function" href="namespacefilter__mod.html#a015eadf785bd049f7206906db314cb39">get_obs_qc_index</a></div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span> </div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span><span class="keywordtype">integer</span> :: i</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span> </div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span><span class="comment">! Determine which qc, if any, has the incoming obs qc</span></div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span><span class="comment">! this is tricky because we have never specified what string</span></div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span><span class="comment">! the metadata has to have.  look for &#39;qc&#39; or &#39;QC&#39; and the</span></div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span><span class="comment">! first metadata that matches (much like &#39;observation&#39; above)</span></div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span><span class="comment">! is the winner.</span></div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span> </div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span><span class="keywordflow">do</span> i = 1, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a251405e9c2065d7a5bdfb9d50617eb5a">get_num_qc</a>(seq)</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>   <a class="code hl_function" href="namespacefilter__mod.html#a015eadf785bd049f7206906db314cb39">get_obs_qc_index</a> = i</div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span> </div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>   <span class="comment">! Need to avoid &#39;QC metadata not initialized&#39;</span></div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>   <span class="keywordflow">if</span>(index(<a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d0eb7fd4d5bf9d607023de100ac8a94">get_qc_meta_data</a>(seq, i), <span class="stringliteral">&#39;QC metadata not initialized&#39;</span>) &gt; 0) cycle</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span> </div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>   <span class="comment">! Need to look for &#39;QC&#39; or &#39;qc&#39;</span></div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>   <span class="keywordflow">if</span>(index(<a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d0eb7fd4d5bf9d607023de100ac8a94">get_qc_meta_data</a>(seq, i), <span class="stringliteral">&#39;QC&#39;</span>) &gt; 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>   <span class="keywordflow">if</span>(index(<a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d0eb7fd4d5bf9d607023de100ac8a94">get_qc_meta_data</a>(seq, i), <span class="stringliteral">&#39;qc&#39;</span>) &gt; 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>   <span class="keywordflow">if</span>(index(<a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d0eb7fd4d5bf9d607023de100ac8a94">get_qc_meta_data</a>(seq, i), <span class="stringliteral">&#39;Quality Control&#39;</span>) &gt; 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>   <span class="keywordflow">if</span>(index(<a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d0eb7fd4d5bf9d607023de100ac8a94">get_qc_meta_data</a>(seq, i), <span class="stringliteral">&#39;QUALITY CONTROL&#39;</span>) &gt; 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span><span class="keywordflow">end do</span></div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span><span class="comment">! Falling off end means &#39;QC&#39; string not found; not fatal!</span></div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span> </div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span><a class="code hl_function" href="namespacefilter__mod.html#a015eadf785bd049f7206906db314cb39">get_obs_qc_index</a> = -1</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span> </div>
</div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span><span class="keyword">end function </span><a class="code hl_function" href="namespacefilter__mod.html#a015eadf785bd049f7206906db314cb39">get_obs_qc_index</a></div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span> </div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span> </div>
<div class="foldopen" id="foldopen01472" data-start="" data-end="">
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a585dca55b5debccfa928f3ebcf204f33"> 1472</a></span><span class="keyword">function </span><a class="code hl_function" href="namespacefilter__mod.html#a585dca55b5debccfa928f3ebcf204f33">get_obs_dartqc_index</a>(seq)</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span> </div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>), <span class="keywordtype">intent(in)</span> :: seq</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span><span class="keywordtype">integer</span>                             :: <a class="code hl_function" href="namespacefilter__mod.html#a585dca55b5debccfa928f3ebcf204f33">get_obs_dartqc_index</a></div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span> </div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span><span class="keywordtype">integer</span> :: i</div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span> </div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span><span class="comment">! Determine which qc, if any, has the DART qc</span></div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span> </div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span><span class="keywordflow">do</span> i = 1, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a251405e9c2065d7a5bdfb9d50617eb5a">get_num_qc</a>(seq)</div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>   <a class="code hl_function" href="namespacefilter__mod.html#a585dca55b5debccfa928f3ebcf204f33">get_obs_dartqc_index</a> = i</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>   <span class="comment">! Need to look for &#39;DART quality control&#39;</span></div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>   <span class="keywordflow">if</span>(index(<a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d0eb7fd4d5bf9d607023de100ac8a94">get_qc_meta_data</a>(seq, i), <span class="stringliteral">&#39;DART quality control&#39;</span>) &gt; 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span><span class="keywordflow">end do</span></div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span><span class="comment">! Falling off end means &#39;DART quality control&#39; not found; not fatal!</span></div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span> </div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span><a class="code hl_function" href="namespacefilter__mod.html#a585dca55b5debccfa928f3ebcf204f33">get_obs_dartqc_index</a> = -1</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span> </div>
</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span><span class="keyword">end function </span><a class="code hl_function" href="namespacefilter__mod.html#a585dca55b5debccfa928f3ebcf204f33">get_obs_dartqc_index</a></div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span> </div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span> </div>
<div class="foldopen" id="foldopen01494" data-start="" data-end="">
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a8e2ebccfd942a3b044aa43c9b7e82a70"> 1494</a></span><span class="keyword">function </span><a class="code hl_function" href="namespacefilter__mod.html#a8e2ebccfd942a3b044aa43c9b7e82a70">get_blank_qc_index</a>(seq)</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span> </div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>), <span class="keywordtype">intent(in)</span> :: seq</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span><span class="keywordtype">integer</span>                             :: <a class="code hl_function" href="namespacefilter__mod.html#a8e2ebccfd942a3b044aa43c9b7e82a70">get_blank_qc_index</a></div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span> </div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span><span class="keywordtype">integer</span> :: i</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span> </div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span><span class="comment">! Determine which qc, if any, is blank</span></div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span> </div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span><span class="keywordflow">do</span> i = 1, <a class="code hl_function" href="namespaceobs__sequence__mod.html#a251405e9c2065d7a5bdfb9d50617eb5a">get_num_qc</a>(seq)</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>   <a class="code hl_function" href="namespacefilter__mod.html#a8e2ebccfd942a3b044aa43c9b7e82a70">get_blank_qc_index</a> = i</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>   <span class="comment">! Need to look for &#39;QC metadata not initialized&#39;</span></div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>   <span class="keywordflow">if</span>(index(<a class="code hl_function" href="namespaceobs__sequence__mod.html#a2d0eb7fd4d5bf9d607023de100ac8a94">get_qc_meta_data</a>(seq, i), <span class="stringliteral">&#39;QC metadata not initialized&#39;</span>) &gt; 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span><span class="keywordflow">end do</span></div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span><span class="comment">! Falling off end means unused slot not found; not fatal!</span></div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span> </div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span><a class="code hl_function" href="namespacefilter__mod.html#a8e2ebccfd942a3b044aa43c9b7e82a70">get_blank_qc_index</a> = -1</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span> </div>
</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span><span class="keyword">end function </span><a class="code hl_function" href="namespacefilter__mod.html#a8e2ebccfd942a3b044aa43c9b7e82a70">get_blank_qc_index</a></div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span> </div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span> </div>
<div class="foldopen" id="foldopen01516" data-start="" data-end="">
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a7e5549afa9086b05dd99a6a7369473cf"> 1516</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a7e5549afa9086b05dd99a6a7369473cf">filter_set_initial_time</a>(days, seconds, dart_time, read_time_from_file)</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span> </div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span><span class="keywordtype">integer</span>,         <span class="keywordtype">intent(in)</span>  :: days, seconds</div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structtime__manager__mod_1_1time__type.html">time_type</a>), <span class="keywordtype">intent(out)</span> :: dart_time</div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span><span class="keywordtype">logical</span>,         <span class="keywordtype">intent(out)</span> :: read_time_from_file</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span> </div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span><span class="keywordflow">if</span>(days &gt;= 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>   dart_time = <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>(seconds, days)</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>   read_time_from_file = .false.</div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>   dart_time = <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>(0, 0)</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>   read_time_from_file = .true.</div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span> </div>
</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a7e5549afa9086b05dd99a6a7369473cf">filter_set_initial_time</a></div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span> </div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span> </div>
<div class="foldopen" id="foldopen01534" data-start="" data-end="">
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aac69510af5cd47b53ce1c782db673a7b"> 1534</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#aac69510af5cd47b53ce1c782db673a7b">filter_set_window_time</a>(dart_time)</div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span> </div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structtime__manager__mod_1_1time__type.html">time_type</a>), <span class="keywordtype">intent(out)</span> :: dart_time</div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span> </div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span> </div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span><span class="keywordflow">if</span>(<a class="code hl_variable" href="namespacefilter__mod.html#a6021be572f1393433e386c5c7072e176">obs_window_days</a> &gt;= 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>   dart_time = <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a46f9eeb3cd59c99cc97dc9f23bbc9c6c">obs_window_seconds</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a6021be572f1393433e386c5c7072e176">obs_window_days</a>)</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>   dart_time = <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>(0, 0)</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span> </div>
</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#aac69510af5cd47b53ce1c782db673a7b">filter_set_window_time</a></div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span> </div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span> </div>
<div class="foldopen" id="foldopen01549" data-start="" data-end="">
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a8fd1b250445c2c0f3787fb29ac42070d"> 1549</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a8fd1b250445c2c0f3787fb29ac42070d">filter_ensemble_inflate</a>(ens_handle, inflate_copy, inflate, ENS_MEAN_COPY, &amp;</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>                                   SPARE_PRIOR_SPREAD, ENS_SD_COPY)</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span> </div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>),         <span class="keywordtype">intent(inout)</span> :: ens_handle</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span><span class="keywordtype">integer</span>,                     <span class="keywordtype">intent(in)</span>    :: inflate_copy, ENS_MEAN_COPY</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structadaptive__inflate__mod_1_1adaptive__inflate__type.html">adaptive_inflate_type</a>), <span class="keywordtype">intent(inout)</span> :: inflate</div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span><span class="keywordtype">integer</span>, <span class="keywordtype">optional</span>,           <span class="keywordtype">intent(in)</span>    :: SPARE_PRIOR_SPREAD, ENS_SD_COPY</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span> </div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span><span class="keywordtype">integer</span> :: j, group, grp_bot, grp_top, grp_size</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structlocation__mod_1_1location__type.html">location_type</a>) :: my_state_loc</div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span><span class="keywordtype">integer</span> :: my_state_kind</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structdistribution__params__mod_1_1distribution__params__type.html">distribution_params_type</a>) :: dist_params</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span><span class="keywordtype">real</span>(r8) :: probit_ens(ens_size), probit_ens_mean</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span><span class="keywordtype">logical</span>  :: bounded_below, bounded_above</div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span><span class="keywordtype">real</span>(r8) :: lower_bound,   upper_bound</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span><span class="keywordtype">integer</span>  :: dist_type</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span> </div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span><span class="comment">! Inflate each group separately;  Divide ensemble into num_groups groups</span></div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span>grp_size = ens_size / <a class="code hl_variable" href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">num_groups</a></div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span> </div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span><span class="keywordflow">do</span> group = 1, <a class="code hl_variable" href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">num_groups</a></div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>   grp_bot = (group - 1) * grp_size + 1</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>   grp_top = grp_bot + grp_size - 1</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>   <span class="comment">! Compute the mean for this group</span></div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a0fabb5d192d3b09305b5e5e25f3cc39f">compute_copy_mean</a>(ens_handle, grp_bot, grp_top, ens_mean_copy)</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span> </div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>   <span class="keywordflow">if</span> ( <a class="code hl_function" href="group__adaptive__inflate.html#gaaa80278515e32002fc8dfa1a431482af">do_rtps_inflate</a>(inflate)) <span class="keywordflow">then</span> </div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>      <span class="keywordflow">if</span> ( <span class="keyword">present</span>(spare_prior_spread) .and. <span class="keyword">present</span>(ens_sd_copy)) <span class="keywordflow">then</span> </div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>         <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, *) <span class="stringliteral">&#39; doing RTPS inflation&#39;</span></div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>         <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>,<span class="stringliteral">&#39;filter_ensemble_inflate:&#39;</span>,<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>,<a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span> </div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>         <span class="comment">!Reset the RTPS factor to the given input.nml value</span></div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>         ens_handle%copies(inflate_copy, 1:ens_handle%my_num_vars) = <a class="code hl_variable" href="namespacefilter__mod.html#ab755c9150a3ba240b43f8930123d861a">inf_initial</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>)</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span> </div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>         <span class="keywordflow">do</span> j = 1, ens_handle%my_num_vars</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>            <span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#ga85001cecec972148adcec6c7ef31e1e5">inflate_ens</a>(inflate, ens_handle%copies(grp_bot:grp_top, j), &amp;</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>               ens_handle%copies(ens_mean_copy, j), ens_handle%copies(inflate_copy, j), 0.0_r8, &amp;</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>               ens_handle%copies(spare_prior_spread, j), ens_handle%copies(ens_sd_copy, j)) </div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span><span class="keywordflow">         end do</span> </div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>      <span class="keywordflow">else</span> </div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>         <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>, *) <span class="stringliteral">&#39;internal error: missing arguments for RTPS inflation, should not happen&#39;</span></div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>         <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;filter_ensemble_inflate&#39;</span>,<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>,<a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span><span class="keywordflow">      endif</span> </div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>   <span class="keywordflow">else</span> </div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span> </div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>      <span class="comment">! This is an initial test of doing inflation in probit space</span></div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>      <span class="comment">! Note that this appears to work with adaptive inflation, but more research would be good</span></div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>      <span class="comment">! Probably also shouldn&#39;t be used with groups for now although it is coded to do so</span></div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>      <span class="keywordflow">do</span> j = 1, ens_handle%my_num_vars</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>         <span class="keyword">call </span>get_state_meta_data(ens_handle%my_vars(j), my_state_loc, my_state_kind)    </div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span> </div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>         <span class="comment">! Need to specify what kind of prior to use for each</span></div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>         <span class="keyword">call </span><a class="code hl_function" href="namespacealgorithm__info__mod.html#a3d99ad78a28fe88d7430ed7a308c5d05">probit_dist_info</a>(my_state_kind, .true., .true., dist_type, &amp;</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>            bounded_below, bounded_above, lower_bound, upper_bound)</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span> </div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>         <span class="keyword">call </span><a class="code hl_function" href="namespaceprobit__transform__mod.html#a3877b6f0aac0e1b3ea4162d37353e08a">transform_to_probit</a>(grp_size, ens_handle%copies(grp_bot:grp_top, j), &amp;</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>            dist_type, dist_params, probit_ens(1:grp_size), .false., &amp;</div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>               bounded_below, bounded_above, lower_bound, upper_bound)</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span> </div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>         <span class="comment">! Compute the ensemble mean in transformed space</span></div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>         probit_ens_mean = sum(probit_ens(1:grp_size)) / grp_size</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>         <span class="comment">! Inflate in probit space</span></div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>         <span class="keyword">call </span><a class="code hl_function" href="group__adaptive__inflate.html#ga85001cecec972148adcec6c7ef31e1e5">inflate_ens</a>(inflate, probit_ens(1:grp_size), probit_ens_mean, &amp;</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>            ens_handle%copies(inflate_copy, j))</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>         <span class="comment">! Transform back from probit space</span></div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>         <span class="keyword">call </span><a class="code hl_function" href="namespaceprobit__transform__mod.html#a75a14657fa6d3bd74786f41d48c1ebf7">transform_from_probit</a>(grp_size, probit_ens(1:grp_size), &amp;</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>            dist_params, ens_handle%copies(grp_bot:grp_top, j))</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span><span class="keywordflow">      end do</span></div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span><span class="keywordflow">end do</span></div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span> </div>
</div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a8fd1b250445c2c0f3787fb29ac42070d">filter_ensemble_inflate</a></div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span> </div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span> </div>
<div class="foldopen" id="foldopen01624" data-start="" data-end="">
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#adf56dc433ec988bba9ea76465912e7fe"> 1624</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#adf56dc433ec988bba9ea76465912e7fe">obs_space_diagnostics</a>(obs_fwd_op_ens_handle, qc_ens_handle, ens_size, &amp;</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>   seq, keys, prior_post, num_output_members, members_index, &amp;</div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>   obs_val_index, OBS_KEY_COPY, &amp;</div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span>   ens_mean_index, ens_spread_index, num_obs_in_set, &amp;</div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>   OBS_MEAN_START, OBS_VAR_START, OBS_GLOBAL_QC_COPY, OBS_VAL_COPY, &amp;</div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>   OBS_ERR_VAR_COPY, DART_qc_index, do_post)</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span> </div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span><span class="comment">! Do observation space diagnostics on the set of obs corresponding to keys</span></div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span> </div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>),     <span class="keywordtype">intent(inout)</span> :: obs_fwd_op_ens_handle, qc_ens_handle</div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: ens_size</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: num_obs_in_set</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: keys(num_obs_in_set), prior_post</div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: num_output_members, members_index</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: obs_val_index</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: OBS_KEY_COPY</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: ens_mean_index, ens_spread_index</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>), <span class="keywordtype">intent(inout)</span> :: seq</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: OBS_MEAN_START, OBS_VAR_START</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: OBS_GLOBAL_QC_COPY, OBS_VAL_COPY</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: OBS_ERR_VAR_COPY, DART_qc_index</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span><span class="keywordtype">logical</span>,                 <span class="keywordtype">intent(in)</span>    :: do_post</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span> </div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span><span class="keywordtype">integer</span>               :: j, k, ens_offset, copy_factor</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span><span class="keywordtype">integer</span>               :: ivalue, io_task, my_task</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span><span class="keywordtype">real</span>(r8), <span class="keywordtype">allocatable</span> :: obs_temp(:)</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span><span class="keywordtype">real</span>(r8)              :: rvalue(1)</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span> </div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span><span class="comment">! Do verbose forward operator output if requested</span></div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span><span class="keywordflow">if</span>(<a class="code hl_variable" href="namespacefilter__mod.html#a4baff862c93f0257ec0da92bcd70d122">output_forward_op_errors</a>) <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#af9da208130303c28f02f238d499069e2">verbose_forward_op_output</a>(qc_ens_handle, prior_post, ens_size, keys)</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span> </div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span><span class="comment">! this is a query routine to return which task has </span></div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span><span class="comment">! logical processing element 0 in this ensemble.</span></div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>io_task = <a class="code hl_function" href="namespaceensemble__manager__mod.html#acd680bca47a44ef5b88a7beff4843816">map_pe_to_task</a>(obs_fwd_op_ens_handle, 0)</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>my_task = <a class="code hl_function" href="namespacempi__utilities__mod.html#ae08b6543f55b372bd6addea0eb1e04a0">my_task_id</a>()</div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span> </div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span><span class="comment">! single value per member if no posterior, else 2</span></div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span><span class="keywordflow">if</span> (do_post) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>   copy_factor = 2</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>   copy_factor = 1</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span> </div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span><span class="comment">! Make var complete for get_copy() calls below.</span></div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span><span class="comment">! Optimize: Could we use a gather instead of a transpose and get copy?</span></div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span><span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#ad77490836a39d93bafc07d1130b15d03">all_copies_to_all_vars</a>(obs_fwd_op_ens_handle)</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span> </div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span><span class="comment">! allocate temp space for sending data only on the task that will</span></div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span><span class="comment">! write the obs_seq.final file</span></div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span><span class="keywordflow">if</span> (my_task == io_task) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>   <span class="keyword">allocate</span>(obs_temp(num_obs_in_set))</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span><span class="keywordflow">else</span> <span class="comment">! TJH: this change became necessary when using Intel 19.0.5 ...</span></div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>   <span class="keyword">allocate</span>(obs_temp(1))</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span> </div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span><span class="comment">! Update the ensemble mean</span></div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span><span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#afeab8324b47d0683e6156f466d78ae63">get_copy</a>(io_task, obs_fwd_op_ens_handle, obs_mean_start, obs_temp)</div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span><span class="keywordflow">if</span>(my_task == io_task) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>   <span class="keywordflow">do</span> j = 1, obs_fwd_op_ens_handle%num_vars</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>      rvalue(1) = obs_temp(j)</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a2a3abc0b65b16b2ab4c6f3f6f494bedf">replace_obs_values</a>(seq, keys(j), rvalue, ens_mean_index)</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span><span class="keywordflow">     end do</span></div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span><span class="keywordflow">  endif</span></div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span> </div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span><span class="comment">! Update the ensemble spread</span></div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span><span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#afeab8324b47d0683e6156f466d78ae63">get_copy</a>(io_task, obs_fwd_op_ens_handle, obs_var_start, obs_temp)</div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span><span class="keywordflow">if</span>(my_task == io_task) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span>   <span class="keywordflow">do</span> j = 1, obs_fwd_op_ens_handle%num_vars</div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>      <span class="keywordflow">if</span> (obs_temp(j) /= <a class="code hl_variable" href="namespacetypes__mod.html#a487646d1dd17cda0f0920a943edfb077">missing_r8</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>         rvalue(1) = sqrt(obs_temp(j))</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>         rvalue(1) = obs_temp(j)</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a2a3abc0b65b16b2ab4c6f3f6f494bedf">replace_obs_values</a>(seq, keys(j), rvalue, ens_spread_index)</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span><span class="keywordflow">   end do</span></div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span> </div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span><span class="comment">! Update any requested ensemble members</span></div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>ens_offset = members_index + 2*copy_factor</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span><span class="keywordflow">do</span> k = 1, num_output_members</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#afeab8324b47d0683e6156f466d78ae63">get_copy</a>(io_task, obs_fwd_op_ens_handle, k, obs_temp)</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>   <span class="keywordflow">if</span>(my_task == io_task) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>      ivalue = ens_offset + copy_factor * (k - 1)</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>      <span class="keywordflow">do</span> j = 1, obs_fwd_op_ens_handle%num_vars</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>         rvalue(1) = obs_temp(j)</div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>         <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a2a3abc0b65b16b2ab4c6f3f6f494bedf">replace_obs_values</a>(seq, keys(j), rvalue, ivalue)</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span><span class="keywordflow">      end do</span></div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span><span class="keywordflow">end do</span></div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span> </div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span><span class="comment">! Update the qc global value</span></div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span><span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#afeab8324b47d0683e6156f466d78ae63">get_copy</a>(io_task, obs_fwd_op_ens_handle, obs_global_qc_copy, obs_temp)</div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span><span class="keywordflow">if</span>(my_task == io_task) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>   <span class="keywordflow">do</span> j = 1, obs_fwd_op_ens_handle%num_vars</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>      rvalue(1) = obs_temp(j)</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#af23b49f36e14be5744be1d6046c29299">replace_qc</a>(seq, keys(j), rvalue, dart_qc_index)</div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span><span class="keywordflow">   end do</span></div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span> </div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span><span class="keyword">deallocate</span>(obs_temp)</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span> </div>
</div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#adf56dc433ec988bba9ea76465912e7fe">obs_space_diagnostics</a></div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span> </div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span> </div>
<div class="foldopen" id="foldopen01729" data-start="" data-end="">
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a0a62226d734bdac0c4382ccb5b40cb32"> 1729</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a0a62226d734bdac0c4382ccb5b40cb32">obs_space_sync_qcs</a>(obs_fwd_op_ens_handle,  &amp;</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>   seq, keys, num_obs_in_set, OBS_GLOBAL_QC_COPY, DART_qc_index)</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span> </div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span> </div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>),     <span class="keywordtype">intent(inout)</span> :: obs_fwd_op_ens_handle</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: num_obs_in_set</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: keys(num_obs_in_set)</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>), <span class="keywordtype">intent(inout)</span> :: seq</div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: OBS_GLOBAL_QC_COPY</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span><span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span>    :: DART_qc_index</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span> </div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span><span class="keywordtype">integer</span>               :: j</div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span><span class="keywordtype">integer</span>               :: io_task, my_task</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span><span class="keywordtype">real</span>(r8), <span class="keywordtype">allocatable</span> :: obs_temp(:)</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span><span class="keywordtype">real</span>(r8)              :: rvalue(1)</div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span> </div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span><span class="comment">! this is a query routine to return which task has </span></div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span><span class="comment">! logical processing element 0 in this ensemble.</span></div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>io_task = <a class="code hl_function" href="namespaceensemble__manager__mod.html#acd680bca47a44ef5b88a7beff4843816">map_pe_to_task</a>(obs_fwd_op_ens_handle, 0)</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>my_task = <a class="code hl_function" href="namespacempi__utilities__mod.html#ae08b6543f55b372bd6addea0eb1e04a0">my_task_id</a>()</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span> </div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span><span class="comment">! create temp space for QC values</span></div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span><span class="keywordflow">if</span> (my_task == io_task) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span>   <span class="keyword">allocate</span>(obs_temp(num_obs_in_set))</div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span><span class="keywordflow">else</span> </div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>   <span class="keyword">allocate</span>(obs_temp(1))</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span> </div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span><span class="comment">! Optimize: Could we use a gather instead of a transpose and get copy?</span></div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span><span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#ad77490836a39d93bafc07d1130b15d03">all_copies_to_all_vars</a>(obs_fwd_op_ens_handle)</div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span> </div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span><span class="comment">! Update the qc global value</span></div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span><span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#afeab8324b47d0683e6156f466d78ae63">get_copy</a>(io_task, obs_fwd_op_ens_handle, obs_global_qc_copy, obs_temp)</div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span><span class="keywordflow">if</span>(my_task == io_task) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>   <span class="keywordflow">do</span> j = 1, obs_fwd_op_ens_handle%num_vars</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>      rvalue(1) = obs_temp(j)</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#af23b49f36e14be5744be1d6046c29299">replace_qc</a>(seq, keys(j), rvalue, dart_qc_index)</div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span><span class="keywordflow">   end do</span></div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span> </div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span><span class="keyword">deallocate</span>(obs_temp)</div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span> </div>
</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a0a62226d734bdac0c4382ccb5b40cb32">obs_space_sync_qcs</a></div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span> </div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span> </div>
<div class="foldopen" id="foldopen01775" data-start="" data-end="">
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a29d20310501029db7a1c0444e07498c8"> 1775</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a29d20310501029db7a1c0444e07498c8">filter_sync_keys_time</a>(ens_handle, key_bounds, num_obs_in_set, time1, time2)</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span> </div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span><span class="keywordtype">integer</span>,             <span class="keywordtype">intent(inout)</span>  :: key_bounds(2), num_obs_in_set</div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structtime__manager__mod_1_1time__type.html">time_type</a>),     <span class="keywordtype">intent(inout)</span>  :: time1, time2</div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>), <span class="keywordtype">intent(inout)</span>     :: ens_handle</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span> </div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span><span class="comment">! Have owner of copy 1 broadcast these values to all other tasks.</span></div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span><span class="comment">! Only tasks which contain copies have this info; doing it this way</span></div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span><span class="comment">! allows ntasks &gt; nens to work.</span></div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span> </div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span><span class="keywordtype">real</span>(<a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>) :: rkey_bounds(2), rnum_obs_in_set(1)</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span><span class="keywordtype">real</span>(<a class="code hl_variable" href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">r8</a>) :: rtime(4)</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span><span class="keywordtype">integer</span>  :: days, secs</div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span><span class="keywordtype">integer</span>  :: copy1_owner, owner_index</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span> </div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span><span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a77071efdef7cc8ea113667122f8a86ef">get_copy_owner_index</a>(ens_handle, 1, copy1_owner, owner_index)</div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span> </div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span><span class="keywordflow">if</span>( ens_handle%my_pe == copy1_owner) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span>   rkey_bounds = key_bounds</div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>   rnum_obs_in_set(1) = num_obs_in_set</div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacetime__manager__mod.html#a579c796316d18ecb716c5face232cb8c">get_time</a>(time1, secs, days)</div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span>   rtime(1) = secs</div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span>   rtime(2) = days</div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacetime__manager__mod.html#a579c796316d18ecb716c5face232cb8c">get_time</a>(time2, secs, days)</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span>   rtime(3) = secs</div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>   rtime(4) = days</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacempi__utilities__mod.html#a5d695a71f9877df21d7ff2a39dba9821">broadcast_send</a>(<a class="code hl_function" href="namespaceensemble__manager__mod.html#acd680bca47a44ef5b88a7beff4843816">map_pe_to_task</a>(ens_handle, copy1_owner), rkey_bounds, rnum_obs_in_set, rtime)</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacempi__utilities__mod.html#abf5f213db52aac32b7f0bdf774d1a1d9">broadcast_recv</a>(<a class="code hl_function" href="namespaceensemble__manager__mod.html#acd680bca47a44ef5b88a7beff4843816">map_pe_to_task</a>(ens_handle, copy1_owner), rkey_bounds, rnum_obs_in_set, rtime)</div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>   key_bounds =     nint(rkey_bounds)</div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>   num_obs_in_set = nint(rnum_obs_in_set(1))</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>   time1 = <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>(nint(rtime(1)), nint(rtime(2)))</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>   time2 = <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>(nint(rtime(3)), nint(rtime(4)))</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span> </div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span><span class="comment">! Every task gets the current time (necessary for the forward operator)</span></div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>ens_handle%current_time = time1</div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span> </div>
</div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a29d20310501029db7a1c0444e07498c8">filter_sync_keys_time</a></div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span> </div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span><span class="comment">! Only copy 1 on task zero has the correct time after reading</span></div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span><span class="comment">! when you read one instance using filter_read_restart.</span></div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span><span class="comment">! perturb_from_single_instance = .true.</span></div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span><span class="comment">! This routine makes the times consistent across the ensemble. </span></div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span><span class="comment">! Any task that owns one or more state vectors needs the time for</span></div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span><span class="comment">! the move ahead call.</span><span class="comment"></span></div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span><span class="comment">!&gt; @todo This is broadcasting the time to all tasks, not</span></div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span><span class="comment">!&gt; just the tasks that own copies.</span></div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span> </div>
<div class="foldopen" id="foldopen01825" data-start="" data-end="">
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ac167793e46b9ae30bc56975ce777cae4"> 1825</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ac167793e46b9ae30bc56975ce777cae4">broadcast_time_across_copy_owners</a>(ens_handle, ens_time)</div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span> </div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>), <span class="keywordtype">intent(inout)</span> :: ens_handle</div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structtime__manager__mod_1_1time__type.html">time_type</a>),     <span class="keywordtype">intent(in)</span>    :: ens_time</div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span> </div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span><span class="keywordtype">real</span>(r8) :: rtime(2)</div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span><span class="keywordtype">integer</span>  :: days, secs</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span><span class="keywordtype">integer</span>  :: copy1_owner, owner_index</div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structtime__manager__mod_1_1time__type.html">time_type</a>) :: time_from_copy1</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span> </div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span><span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a77071efdef7cc8ea113667122f8a86ef">get_copy_owner_index</a>(ens_handle, 1, copy1_owner, owner_index)</div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span> </div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span><span class="keywordflow">if</span>( ens_handle%my_pe == copy1_owner) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacetime__manager__mod.html#a579c796316d18ecb716c5face232cb8c">get_time</a>(ens_time, secs, days)</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span>   rtime(1) = secs</div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>   rtime(2) = days</div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacempi__utilities__mod.html#a5d695a71f9877df21d7ff2a39dba9821">broadcast_send</a>(<a class="code hl_function" href="namespaceensemble__manager__mod.html#acd680bca47a44ef5b88a7beff4843816">map_pe_to_task</a>(ens_handle, copy1_owner), rtime)</div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>   ens_handle%time(1:ens_handle%my_num_copies) = ens_time</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacempi__utilities__mod.html#abf5f213db52aac32b7f0bdf774d1a1d9">broadcast_recv</a>(<a class="code hl_function" href="namespaceensemble__manager__mod.html#acd680bca47a44ef5b88a7beff4843816">map_pe_to_task</a>(ens_handle, copy1_owner), rtime)</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>   time_from_copy1 = <a class="code hl_function" href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">set_time</a>(nint(rtime(1)), nint(rtime(2)))</div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span>   <span class="keywordflow">if</span> (ens_handle%my_num_copies &gt; 0) ens_handle%time(1:ens_handle%my_num_copies) = time_from_copy1</div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span> </div>
</div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ac167793e46b9ae30bc56975ce777cae4">broadcast_time_across_copy_owners</a></div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span> </div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span> </div>
<div class="foldopen" id="foldopen01853" data-start="" data-end="">
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a27e9b289aac5155c54ec925951569906"> 1853</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a27e9b289aac5155c54ec925951569906">set_trace</a>(trace_execution, output_timestamps, silence)</div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span> </div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span><span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: trace_execution</div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span><span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: output_timestamps</div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span><span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: silence</div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span> </div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span><span class="comment">! Set whether other modules trace execution with messages</span></div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span><span class="comment">! and whether they output timestamps to trace overall performance</span></div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span> </div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span><span class="comment">! defaults</span></div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span><a class="code hl_variable" href="namespacefilter__mod.html#a6d1b20f110ea472a3a31fbb956e42e0e">trace_level</a>     = 0</div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span><a class="code hl_variable" href="namespacefilter__mod.html#a6151f2410c1f3bd1431eb143ec1a606a">timestamp_level</a> = 0</div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span> </div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span><span class="comment">! selectively turn stuff back on</span></div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span><span class="keywordflow">if</span> (trace_execution)   <a class="code hl_variable" href="namespacefilter__mod.html#a6d1b20f110ea472a3a31fbb956e42e0e">trace_level</a>     = 1</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span><span class="keywordflow">if</span> (output_timestamps) <a class="code hl_variable" href="namespacefilter__mod.html#a6151f2410c1f3bd1431eb143ec1a606a">timestamp_level</a> = 1</div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span> </div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span><span class="comment">! turn as much off as possible</span></div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span><span class="keywordflow">if</span> (silence) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a6d1b20f110ea472a3a31fbb956e42e0e">trace_level</a>     = -1</div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a6151f2410c1f3bd1431eb143ec1a606a">timestamp_level</a> = -1</div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span> </div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span><span class="keyword">call </span><a class="code hl_function" href="namespaceobs__model__mod.html#a5ba75c3d4925959b387beafb52538b89">set_obs_model_trace</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a6d1b20f110ea472a3a31fbb956e42e0e">trace_level</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a6151f2410c1f3bd1431eb143ec1a606a">timestamp_level</a>)</div>
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"> 1877</span><span class="keyword">call </span><a class="code hl_function" href="group__assim__tools.html#gae6a5cb9fd7c12f32393a170017220a72">set_assim_tools_trace</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a6d1b20f110ea472a3a31fbb956e42e0e">trace_level</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a6151f2410c1f3bd1431eb143ec1a606a">timestamp_level</a>)</div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span> </div>
</div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a27e9b289aac5155c54ec925951569906">set_trace</a></div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span> </div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span> </div>
<div class="foldopen" id="foldopen01883" data-start="" data-end="">
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759"> 1883</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a>(msg, label, threshold)</div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span> </div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span><span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>           :: msg</div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span><span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: label</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span><span class="keywordtype">integer</span>,          <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: threshold</div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span> </div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span><span class="comment">! Write message to stdout and log file.</span></div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span><span class="keywordtype">integer</span> :: t</div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span> </div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span>t = 0</div>
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"> 1893</span><span class="keywordflow">if</span> (<span class="keyword">present</span>(threshold)) t = threshold</div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span> </div>
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"> 1895</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a6d1b20f110ea472a3a31fbb956e42e0e">trace_level</a> &lt;= t) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span> </div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span><span class="keywordflow">if</span> (.not. <a class="code hl_function" href="namespaceutilities__mod.html#ae5919d9aaedac3ac4128d1d68ed05769">do_output</a>()) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span> </div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span><span class="keywordflow">if</span> (<span class="keyword">present</span>(label)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>,trim(label),trim(msg))</div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>,<span class="stringliteral">&#39; filter trace:&#39;</span>,trim(msg))</div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span> </div>
</div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">trace_message</a></div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span> </div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span> </div>
<div class="foldopen" id="foldopen01909" data-start="" data-end="">
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1"> 1909</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a>(msg, sync)</div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"> 1910</span> </div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span><span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: msg</div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span><span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: sync</div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span> </div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span><span class="comment">! Write current time and message to stdout and log file.</span></div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span><span class="comment">! if sync is present and true, sync mpi jobs before printing time.</span></div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span> </div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a6151f2410c1f3bd1431eb143ec1a606a">timestamp_level</a> &lt;= 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span> </div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span><span class="keywordflow">if</span> (<span class="keyword">present</span>(sync)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span>  <span class="keywordflow">if</span> (sync) <span class="keyword">call </span><a class="code hl_function" href="namespacempi__utilities__mod.html#a19228477ddb48773bf4fb3858c997d82">task_sync</a>()</div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span> </div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceutilities__mod.html#ae5919d9aaedac3ac4128d1d68ed05769">do_output</a>()) <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#ad297e7b3a121a9c280417846a9198ac9">timestamp</a>(<span class="stringliteral">&#39; &#39;</span>//trim(msg), pos=<span class="stringliteral">&#39;brief&#39;</span>)</div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span> </div>
</div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">timestamp_message</a></div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span> </div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span><span class="comment">!-------------------------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span><span class="comment">!&gt;  call progress(string, T_BEFORE, P_TIME, label, threshold, sync)  ! trace plus timestamp</span></div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span> </div>
<div class="foldopen" id="foldopen01931" data-start="" data-end="">
<div class="line"><a id="l01931" name="l01931"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a7d0e49b8aa9528930458f716b6904f0b"> 1931</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a7d0e49b8aa9528930458f716b6904f0b">progress</a>(msg, when, dotime, label, threshold, sync)  <span class="comment">! trace plus timestamp</span></div>
<div class="line"><a id="l01932" name="l01932"></a><span class="lineno"> 1932</span> </div>
<div class="line"><a id="l01933" name="l01933"></a><span class="lineno"> 1933</span><span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>           :: msg</div>
<div class="line"><a id="l01934" name="l01934"></a><span class="lineno"> 1934</span><span class="keywordtype">integer</span>,          <span class="keywordtype">intent(in)</span>           :: when</div>
<div class="line"><a id="l01935" name="l01935"></a><span class="lineno"> 1935</span><span class="keywordtype">logical</span>,          <span class="keywordtype">intent(in)</span>           :: dotime</div>
<div class="line"><a id="l01936" name="l01936"></a><span class="lineno"> 1936</span><span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: label</div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span><span class="keywordtype">integer</span>,          <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: threshold</div>
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"> 1938</span><span class="keywordtype">logical</span>,          <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: sync</div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span> </div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span><span class="comment">! Write message to stdout and log file.</span></div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span><span class="comment">! optionally write timestamp.</span></div>
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"> 1942</span><span class="keywordtype">integer</span> :: t, lastchar</div>
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"> 1943</span><span class="keywordtype">character(len=40)</span> :: label_to_use</div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span> </div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span>t = 0</div>
<div class="line"><a id="l01946" name="l01946"></a><span class="lineno"> 1946</span><span class="keywordflow">if</span> (<span class="keyword">present</span>(threshold)) t = threshold</div>
<div class="line"><a id="l01947" name="l01947"></a><span class="lineno"> 1947</span> </div>
<div class="line"><a id="l01948" name="l01948"></a><span class="lineno"> 1948</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a6d1b20f110ea472a3a31fbb956e42e0e">trace_level</a> &lt;= t) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01949" name="l01949"></a><span class="lineno"> 1949</span> </div>
<div class="line"><a id="l01950" name="l01950"></a><span class="lineno"> 1950</span><span class="keywordflow">if</span> (.not. <a class="code hl_function" href="namespaceutilities__mod.html#ae5919d9aaedac3ac4128d1d68ed05769">do_output</a>()) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01951" name="l01951"></a><span class="lineno"> 1951</span> </div>
<div class="line"><a id="l01952" name="l01952"></a><span class="lineno"> 1952</span><span class="keywordflow">if</span> (<span class="keyword">present</span>(label)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span>   lastchar = min(len_trim(label), len(label_to_use))</div>
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"> 1954</span>   label_to_use = label(1:lastchar)</div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span>   label_to_use = <span class="stringliteral">&#39; filter_trace: &#39;</span></div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"> 1958</span> </div>
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"> 1959</span><span class="keywordflow">select case</span> (when)</div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span>  <span class="keywordflow">case</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a57fb40636aeb9aaa81403bb9a1706210">t_before</a>)</div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span>    <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>, trim(label_to_use)//<span class="stringliteral">&#39; Before &#39;</span>, trim(msg))</div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span>  <span class="keywordflow">case</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a3784b41754c7c894fc931b34344b4dc2">t_after</a>)</div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span>    <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>, trim(label_to_use)//<span class="stringliteral">&#39; After  &#39;</span>, trim(msg))</div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span><span class="keywordflow">  case default</span></div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span>    <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>, trim(label_to_use), trim(msg))</div>
<div class="line"><a id="l01966" name="l01966"></a><span class="lineno"> 1966</span><span class="keywordflow">end select</span></div>
<div class="line"><a id="l01967" name="l01967"></a><span class="lineno"> 1967</span> </div>
<div class="line"><a id="l01968" name="l01968"></a><span class="lineno"> 1968</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a6151f2410c1f3bd1431eb143ec1a606a">timestamp_level</a> &lt;= 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01969" name="l01969"></a><span class="lineno"> 1969</span> </div>
<div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span><span class="comment">! if sync is present and true, sync mpi jobs before printing time.</span></div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span><span class="keywordflow">if</span> (<span class="keyword">present</span>(sync)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span>  <span class="keywordflow">if</span> (sync) <span class="keyword">call </span><a class="code hl_function" href="namespacempi__utilities__mod.html#a19228477ddb48773bf4fb3858c997d82">task_sync</a>()</div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span> </div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceutilities__mod.html#ae5919d9aaedac3ac4128d1d68ed05769">do_output</a>()) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span>   <span class="keywordflow">select case</span> (when)</div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span>     <span class="keywordflow">case</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a57fb40636aeb9aaa81403bb9a1706210">t_before</a>)</div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#ad297e7b3a121a9c280417846a9198ac9">timestamp</a>(<span class="stringliteral">&#39; Before &#39;</span>//trim(msg), pos=<span class="stringliteral">&#39;brief&#39;</span>)</div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span>     <span class="keywordflow">case</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a3784b41754c7c894fc931b34344b4dc2">t_after</a>)</div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#ad297e7b3a121a9c280417846a9198ac9">timestamp</a>(<span class="stringliteral">&#39; After  &#39;</span>//trim(msg), pos=<span class="stringliteral">&#39;brief&#39;</span>)</div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span><span class="keywordflow">     case default</span></div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#ad297e7b3a121a9c280417846a9198ac9">timestamp</a>(<span class="stringliteral">&#39; &#39;</span>//trim(msg), pos=<span class="stringliteral">&#39;brief&#39;</span>)</div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span><span class="keywordflow">   end select</span></div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span> </div>
</div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a7d0e49b8aa9528930458f716b6904f0b">progress</a></div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span> </div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span> </div>
<div class="foldopen" id="foldopen01990" data-start="" data-end="">
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a7e4cd481d9e540ad14c261eaa668cbab"> 1990</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a7e4cd481d9e540ad14c261eaa668cbab">print_ens_time</a>(ens_handle, msg)</div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span> </div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>), <span class="keywordtype">intent(in)</span> :: ens_handle</div>
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"> 1993</span><span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: msg</div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span> </div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span><span class="comment">! Write message to stdout and log file.</span></div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structtime__manager__mod_1_1time__type.html">time_type</a>) :: mtime</div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span> </div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a6d1b20f110ea472a3a31fbb956e42e0e">trace_level</a> &lt;= 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span> </div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceutilities__mod.html#ae5919d9aaedac3ac4128d1d68ed05769">do_output</a>()) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceensemble__manager__mod.html#a2974e8f65e2455080e426fb9ae228c13">get_my_num_copies</a>(ens_handle) &lt; 1) <span class="keywordflow">return</span></div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a1500b736b8e9992f705b2c5af3870172">get_ensemble_time</a>(ens_handle, 1, mtime)</div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacetime__manager__mod.html#a4f3d8b893f84f06cc655708c58098435">print_time</a>(mtime, <span class="stringliteral">&#39; filter trace: &#39;</span>//msg, <a class="code hl_variable" href="namespaceutilities__mod.html#a7f7028c1f8fd499c0964b9955a7c0149">logfileunit</a>)</div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacetime__manager__mod.html#a4f3d8b893f84f06cc655708c58098435">print_time</a>(mtime, <span class="stringliteral">&#39; filter trace: &#39;</span>//msg)</div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span> </div>
</div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a7e4cd481d9e540ad14c261eaa668cbab">print_ens_time</a></div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span> </div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span><span class="comment">!-------------------------------------------------------------------------</span></div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span> </div>
<div class="foldopen" id="foldopen02011" data-start="" data-end="">
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ab25b55818d4f6cd0b91c8a17365c4736"> 2011</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ab25b55818d4f6cd0b91c8a17365c4736">print_obs_time</a>(seq, key, msg)</div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span> </div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_type</a>), <span class="keywordtype">intent(in)</span> :: seq</div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span><span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: key</div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span><span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: msg</div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span> </div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span><span class="comment">! Write time of an observation to stdout and log file.</span></div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__sequence__mod_1_1obs__type.html">obs_type</a>) :: obs</div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structobs__def__mod_1_1obs__def__type.html">obs_def_type</a>) :: obs_def</div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structtime__manager__mod_1_1time__type.html">time_type</a>) :: mtime</div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span> </div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a6d1b20f110ea472a3a31fbb956e42e0e">trace_level</a> &lt;= 0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span> </div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceutilities__mod.html#ae5919d9aaedac3ac4128d1d68ed05769">do_output</a>()) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a0397f5139207309fc5807b9b3b69f1de">init_obs</a>(obs, 0, 0)</div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a8126596a8e537768e04be706daec4254">get_obs_from_key</a>(seq, key, obs)</div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#ae884000e024da5fcb714a50e3e07235e">get_obs_def</a>(obs, obs_def)</div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span>   mtime = <a class="code hl_function" href="namespaceobs__def__mod.html#abe1a0f69f359ce770251b6e896e4f708">get_obs_def_time</a>(obs_def)</div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacetime__manager__mod.html#a4f3d8b893f84f06cc655708c58098435">print_time</a>(mtime, <span class="stringliteral">&#39; filter trace: &#39;</span>//msg, <a class="code hl_variable" href="namespaceutilities__mod.html#a7f7028c1f8fd499c0964b9955a7c0149">logfileunit</a>)</div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacetime__manager__mod.html#a4f3d8b893f84f06cc655708c58098435">print_time</a>(mtime, <span class="stringliteral">&#39; filter trace: &#39;</span>//msg)</div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceobs__sequence__mod.html#a31c6f2a944a254a1a8d5c817d2c69cc5">destroy_obs</a>(obs)</div>
<div class="line"><a id="l02032" name="l02032"></a><span class="lineno"> 2032</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span> </div>
</div>
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"> 2034</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ab25b55818d4f6cd0b91c8a17365c4736">print_obs_time</a></div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span> </div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span><span class="comment">!-------------------------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span><span class="comment">!&gt; write out failed forward operators</span></div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span><span class="comment">!&gt; This was part of obs_space_diagnostics</span></div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span> </div>
<div class="foldopen" id="foldopen02040" data-start="" data-end="">
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#af9da208130303c28f02f238d499069e2"> 2040</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#af9da208130303c28f02f238d499069e2">verbose_forward_op_output</a>(qc_ens_handle, prior_post, ens_size, keys)</div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span> </div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>), <span class="keywordtype">intent(inout)</span> :: qc_ens_handle</div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span><span class="keywordtype">integer</span>,             <span class="keywordtype">intent(in)</span>    :: prior_post</div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span><span class="keywordtype">integer</span>,             <span class="keywordtype">intent(in)</span>    :: ens_size</div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span><span class="keywordtype">integer</span>,             <span class="keywordtype">intent(in)</span>    :: keys(:) <span class="comment">! I think this is still var size</span></div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span> </div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span><span class="keywordtype">character(len=12)</span> :: task</div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span><span class="keywordtype">integer</span> :: j, i</div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span><span class="keywordtype">integer</span> :: forward_unit</div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span> </div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span><span class="keyword">write</span>(task, <span class="stringliteral">&#39;(i6.6)&#39;</span>) <a class="code hl_function" href="namespacempi__utilities__mod.html#ae08b6543f55b372bd6addea0eb1e04a0">my_task_id</a>()</div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span> </div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span><span class="comment">! all tasks open file?</span></div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span><span class="keywordflow">if</span>(prior_post == <a class="code hl_variable" href="namespacefilter__mod.html#ab8cdd1126d0e8c7b386f1a31be904877">prior_diag</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>   forward_unit = <a class="code hl_function" href="namespaceutilities__mod.html#a77ad7301456803b1c560cd7c75a37549">open_file</a>(<span class="stringliteral">&#39;prior_forward_ope_errors&#39;</span> // task, <span class="stringliteral">&#39;formatted&#39;</span>, <span class="stringliteral">&#39;append&#39;</span>)</div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span>   forward_unit = <a class="code hl_function" href="namespaceutilities__mod.html#a77ad7301456803b1c560cd7c75a37549">open_file</a>(<span class="stringliteral">&#39;post_forward_ope_errors&#39;</span> // task, <span class="stringliteral">&#39;formatted&#39;</span>, <span class="stringliteral">&#39;append&#39;</span>)</div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span> </div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span><span class="comment">! qc_ens_handle is a real representing an integer; values /= 0 get written out</span></div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span><span class="keywordflow">do</span> i = 1, ens_size</div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span>   <span class="keywordflow">do</span> j = 1, qc_ens_handle%my_num_vars</div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span>      <span class="keywordflow">if</span>(nint(qc_ens_handle%copies(i, j)) /= 0) <span class="keyword">write</span>(forward_unit, *) i, j, keys(qc_ens_handle%my_vars(j)), nint(qc_ens_handle%copies(i, j))</div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span><span class="keywordflow">   end do</span></div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span><span class="keywordflow">end do</span></div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span> </div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span><span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#aaa23ed1a0469bb9addcd0de6c52645b8">close_file</a>(forward_unit)</div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span> </div>
</div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#af9da208130303c28f02f238d499069e2">verbose_forward_op_output</a></div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span> </div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span><span class="comment">!------------------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span><span class="comment">!&gt; Produces an ensemble by copying my_vars of the 1st ensemble member</span></div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span><span class="comment">!&gt; and then perturbing the copies array.</span></div>
<div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span><span class="comment">!&gt; Mimicks the behaviour of pert_model_state:</span></div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"> 2075</span><span class="comment">!&gt; pert_model_copies is called:</span></div>
<div class="line"><a id="l02076" name="l02076"></a><span class="lineno"> 2076</span><span class="comment">!&gt;   if no model perturb is provided, perturb_copies_task_bitwise is called.</span></div>
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span><span class="comment">!&gt; Note: Not enforcing a model_mod to produce a</span></div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span><span class="comment">!&gt; pert_model_copies that is bitwise across any number of</span></div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span><span class="comment">!&gt; tasks, although there is enough information in the</span></div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span><span class="comment">!&gt; ens_handle to do this.</span></div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span><span class="comment">!&gt;</span></div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span><span class="comment">!&gt; Some models allow missing_r8 in the state vector.  If missing_r8 is</span></div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span><span class="comment">!&gt; allowed the locations of missing_r8s are stored before the perturb,</span></div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span><span class="comment">!&gt; then the missing_r8s are put back in after the perturb.</span></div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span> </div>
<div class="foldopen" id="foldopen02086" data-start="" data-end="">
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a9ee31f0112a3cd495806db9af6204aa4"> 2086</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a9ee31f0112a3cd495806db9af6204aa4">create_ensemble_from_single_file</a>(ens_handle)</div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span> </div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>), <span class="keywordtype">intent(inout)</span> :: ens_handle</div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span> </div>
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"> 2090</span><span class="keywordtype">integer</span>               :: i</div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span><span class="keywordtype">logical</span>               :: interf_provided <span class="comment">! model does the perturbing</span></div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span><span class="keywordtype">logical</span>, <span class="keywordtype">allocatable</span>  :: miss_me(:)</div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span><span class="keywordtype">integer</span>               :: partial_state_on_my_task <span class="comment">! the number of elements ON THIS TASK</span></div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span> </div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span><span class="comment">! Copy from ensemble member 1 to the other copies</span></div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span><span class="keywordflow">do</span> i = 1, ens_handle%my_num_vars</div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span>   ens_handle%copies(2:<a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, i) = ens_handle%copies(1, i)  <span class="comment">! How slow is this?</span></div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span><span class="keywordflow">enddo</span></div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span> </div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span><span class="comment">! If the state allows missing values, we have to record their locations</span></div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span><span class="comment">! and restore them in all the new perturbed copies.</span></div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span> </div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceoptions__mod.html#a536448bfef7c5c838d79e714ca7bbb6a">get_missing_ok_status</a>()) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span>   partial_state_on_my_task = <span class="keyword">size</span>(ens_handle%copies,2)</div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span>   <span class="keyword">allocate</span>(miss_me(partial_state_on_my_task))</div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span>   miss_me = .false.</div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span>   <span class="keywordflow">where</span>(ens_handle%copies(1, :) == <a class="code hl_variable" href="namespacetypes__mod.html#a487646d1dd17cda0f0920a943edfb077">missing_r8</a>) miss_me = .true.</div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span> </div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span><span class="keyword">call </span>pert_model_copies(ens_handle, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac57764243591fe7c29cffbee0d7882d5">perturbation_amplitude</a>, interf_provided)</div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span><span class="keywordflow">if</span> (.not. interf_provided) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#acea21f1c63d14bee04ce8f04631a3c58">perturb_copies_task_bitwise</a>(ens_handle)</div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span> </div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span><span class="comment">! Restore the missing_r8</span></div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span><span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceoptions__mod.html#a536448bfef7c5c838d79e714ca7bbb6a">get_missing_ok_status</a>()) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span>   <span class="keywordflow">do</span> i = 1, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a></div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span>      <span class="keywordflow">where</span>(miss_me) ens_handle%copies(i, :) = <a class="code hl_variable" href="namespacetypes__mod.html#a487646d1dd17cda0f0920a943edfb077">missing_r8</a></div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span><span class="keywordflow">   enddo</span></div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span>   <span class="keyword">deallocate</span>(miss_me)</div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span> </div>
</div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a9ee31f0112a3cd495806db9af6204aa4">create_ensemble_from_single_file</a></div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span> </div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span> </div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span><span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span><span class="comment">! Perturb the copies array in a way that is bitwise reproducible</span></div>
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"> 2128</span><span class="comment">! no matter how many task you run on.</span></div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span> </div>
<div class="foldopen" id="foldopen02130" data-start="" data-end="">
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#acea21f1c63d14bee04ce8f04631a3c58"> 2130</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#acea21f1c63d14bee04ce8f04631a3c58">perturb_copies_task_bitwise</a>(ens_handle)</div>
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"> 2131</span> </div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"> 2132</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>), <span class="keywordtype">intent(inout)</span> :: ens_handle</div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span> </div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span><span class="keywordtype">integer</span>               :: i, j <span class="comment">! loop variables</span></div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structrandom__seq__mod_1_1random__seq__type.html">random_seq_type</a>) :: r(ens_size)</div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span><span class="keywordtype">real</span>(r8)              :: random_array(ens_size) <span class="comment">! array of random numbers</span></div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span><span class="keywordtype">integer</span>               :: local_index</div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span> </div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span><span class="comment">! Need ens_size random number sequences.</span></div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span><span class="keywordflow">do</span> i = 1, ens_size</div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacerandom__seq__mod.html#a89f70b37eedada36ce65245a8c2f84e6">init_random_seq</a>(r(i), i)</div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span><span class="keywordflow">enddo</span></div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span> </div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span>local_index = 1 <span class="comment">! same across the ensemble</span></div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span> </div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span><span class="comment">! Only one task is going to update per i.  This will not scale at all.</span></div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span><span class="keywordflow">do</span> i = 1, ens_handle%num_vars</div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span> </div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span>   <span class="keywordflow">do</span> j = 1, ens_size</div>
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"> 2150</span>     <span class="comment">! Can use %copies here because the random number</span></div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"> 2151</span>     <span class="comment">! is only relevant to the task than owns element i.</span></div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span>     random_array(j)  =  <a class="code hl_function" href="namespacerandom__seq__mod.html#a70e7d279fc09edf6033d21e78dc41a3c">random_gaussian</a>(r(j), ens_handle%copies(j, local_index), <a class="code hl_variable" href="namespacefilter__mod.html#ac57764243591fe7c29cffbee0d7882d5">perturbation_amplitude</a>)</div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span><span class="keywordflow">   enddo</span></div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span> </div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span>   <span class="keywordflow">if</span> (ens_handle%my_vars(local_index) == i) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span>      ens_handle%copies(1:ens_size, local_index) = random_array(:)</div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span>      local_index = local_index + 1 <span class="comment">! task is ready for the next random number</span></div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span>      local_index = min(local_index, ens_handle%my_num_vars)</div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span> </div>
<div class="line"><a id="l02161" name="l02161"></a><span class="lineno"> 2161</span><span class="keywordflow">enddo</span></div>
<div class="line"><a id="l02162" name="l02162"></a><span class="lineno"> 2162</span> </div>
</div>
<div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#acea21f1c63d14bee04ce8f04631a3c58">perturb_copies_task_bitwise</a></div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span> </div>
<div class="line"><a id="l02165" name="l02165"></a><span class="lineno"> 2165</span><span class="comment">!------------------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span><span class="comment">!&gt; Set the time on any extra copies that a pe owns</span></div>
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"> 2167</span><span class="comment">!&gt; Could we just set the time on all copies?</span></div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span> </div>
<div class="foldopen" id="foldopen02169" data-start="" data-end="">
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a448fd1d40ad4dc01e18b1035f72373f9"> 2169</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a448fd1d40ad4dc01e18b1035f72373f9">set_time_on_extra_copies</a>(ens_handle)</div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span> </div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>), <span class="keywordtype">intent(inout)</span> :: ens_handle</div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span> </div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span><span class="keywordtype">integer</span> :: copy_num, owner, owners_index</div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span><span class="keywordtype">integer</span> :: ens_size</div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span> </div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span>ens_size = ens_handle%num_copies - ens_handle%num_extras</div>
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"> 2177</span> </div>
<div class="line"><a id="l02178" name="l02178"></a><span class="lineno"> 2178</span><span class="keywordflow">do</span> copy_num = ens_size + 1, ens_handle%num_copies</div>
<div class="line"><a id="l02179" name="l02179"></a><span class="lineno"> 2179</span>   <span class="comment">! Set time for a given copy of an ensemble</span></div>
<div class="line"><a id="l02180" name="l02180"></a><span class="lineno"> 2180</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a77071efdef7cc8ea113667122f8a86ef">get_copy_owner_index</a>(ens_handle, copy_num, owner, owners_index)</div>
<div class="line"><a id="l02181" name="l02181"></a><span class="lineno"> 2181</span>   <span class="keywordflow">if</span>(ens_handle%my_pe == owner) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02182" name="l02182"></a><span class="lineno"> 2182</span>      <span class="keyword">call </span><a class="code hl_function" href="namespaceensemble__manager__mod.html#a6dba0cf88e6588f7c50b999e0242871b">set_ensemble_time</a>(ens_handle, owners_index, ens_handle%current_time)</div>
<div class="line"><a id="l02183" name="l02183"></a><span class="lineno"> 2183</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02184" name="l02184"></a><span class="lineno"> 2184</span><span class="keywordflow">enddo</span></div>
<div class="line"><a id="l02185" name="l02185"></a><span class="lineno"> 2185</span> </div>
</div>
<div class="line"><a id="l02186" name="l02186"></a><span class="lineno"> 2186</span><span class="keyword">end subroutine  </span><a class="code hl_function" href="namespacefilter__mod.html#a448fd1d40ad4dc01e18b1035f72373f9">set_time_on_extra_copies</a></div>
<div class="line"><a id="l02187" name="l02187"></a><span class="lineno"> 2187</span> </div>
<div class="line"><a id="l02188" name="l02188"></a><span class="lineno"> 2188</span> </div>
<div class="line"><a id="l02189" name="l02189"></a><span class="lineno"> 2189</span><span class="comment">!------------------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02190" name="l02190"></a><span class="lineno"> 2190</span><span class="comment">!&gt; Copy the current mean, sd, inf_mean, inf_sd to spare copies</span></div>
<div class="line"><a id="l02191" name="l02191"></a><span class="lineno"> 2191</span><span class="comment">!&gt; Assuming that if the spare copy is there you should fill it</span></div>
<div class="line"><a id="l02192" name="l02192"></a><span class="lineno"> 2192</span> </div>
<div class="foldopen" id="foldopen02193" data-start="" data-end="">
<div class="line"><a id="l02193" name="l02193"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a6cab091fff584d16a815ee1cae95cfc1"> 2193</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a6cab091fff584d16a815ee1cae95cfc1">store_input</a>(ens_handle, prior_inflate, post_inflate)</div>
<div class="line"><a id="l02194" name="l02194"></a><span class="lineno"> 2194</span> </div>
<div class="line"><a id="l02195" name="l02195"></a><span class="lineno"> 2195</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>),         <span class="keywordtype">intent(inout)</span> :: ens_handle</div>
<div class="line"><a id="l02196" name="l02196"></a><span class="lineno"> 2196</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structadaptive__inflate__mod_1_1adaptive__inflate__type.html">adaptive_inflate_type</a>), <span class="keywordtype">intent(in)</span>    :: prior_inflate</div>
<div class="line"><a id="l02197" name="l02197"></a><span class="lineno"> 2197</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structadaptive__inflate__mod_1_1adaptive__inflate__type.html">adaptive_inflate_type</a>), <span class="keywordtype">intent(in)</span>    :: post_inflate</div>
<div class="line"><a id="l02198" name="l02198"></a><span class="lineno"> 2198</span> </div>
<div class="line"><a id="l02199" name="l02199"></a><span class="lineno"> 2199</span><span class="keywordflow">if</span>( <a class="code hl_variable" href="namespacefilter__mod.html#a34bfafb5e98fec24b32f651f7996a59f">output_mean</a> ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02200" name="l02200"></a><span class="lineno"> 2200</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">ens_mean</a>)) ) &amp;</div>
<div class="line"><a id="l02201" name="l02201"></a><span class="lineno"> 2201</span>      ens_handle%copies(   <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">ens_mean</a>), :) = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, :)</div>
<div class="line"><a id="l02202" name="l02202"></a><span class="lineno"> 2202</span> </div>
<div class="line"><a id="l02203" name="l02203"></a><span class="lineno"> 2203</span>   <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#ga6b7b01c13f591ca5aaa2450cb0c18d2e">mean_from_restart</a>( prior_inflate) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02204" name="l02204"></a><span class="lineno"> 2204</span>     <span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a>)) ) &amp;</div>
<div class="line"><a id="l02205" name="l02205"></a><span class="lineno"> 2205</span>        ens_handle%copies(   <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a>), :) = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, :)</div>
<div class="line"><a id="l02206" name="l02206"></a><span class="lineno"> 2206</span><span class="keywordflow">   endif</span> </div>
<div class="line"><a id="l02207" name="l02207"></a><span class="lineno"> 2207</span> </div>
<div class="line"><a id="l02208" name="l02208"></a><span class="lineno"> 2208</span>   <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#ga6b7b01c13f591ca5aaa2450cb0c18d2e">mean_from_restart</a>(post_inflate) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02209" name="l02209"></a><span class="lineno"> 2209</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>)) ) &amp;</div>
<div class="line"><a id="l02210" name="l02210"></a><span class="lineno"> 2210</span>         ens_handle%copies(   <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>), :) = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, :)</div>
<div class="line"><a id="l02211" name="l02211"></a><span class="lineno"> 2211</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02212" name="l02212"></a><span class="lineno"> 2212</span>   </div>
<div class="line"><a id="l02213" name="l02213"></a><span class="lineno"> 2213</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02214" name="l02214"></a><span class="lineno"> 2214</span> </div>
<div class="line"><a id="l02215" name="l02215"></a><span class="lineno"> 2215</span><span class="keywordflow">if</span>( <a class="code hl_variable" href="namespacefilter__mod.html#a6a0afbade119eb0c73644e49b86b9fb8">output_sd</a> ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02216" name="l02216"></a><span class="lineno"> 2216</span> </div>
<div class="line"><a id="l02217" name="l02217"></a><span class="lineno"> 2217</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">ens_sd</a>)) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02218" name="l02218"></a><span class="lineno"> 2218</span>      ens_handle%copies(   <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">ens_sd</a>), :) = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>, :)</div>
<div class="line"><a id="l02219" name="l02219"></a><span class="lineno"> 2219</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02220" name="l02220"></a><span class="lineno"> 2220</span> </div>
<div class="line"><a id="l02221" name="l02221"></a><span class="lineno"> 2221</span>   <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#gae3900d28b408cedd58072e5b5d9515a7">sd_from_restart</a>(prior_inflate) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02222" name="l02222"></a><span class="lineno"> 2222</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>)) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02223" name="l02223"></a><span class="lineno"> 2223</span>         ens_handle%copies(   <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>), :) = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a>, :)</div>
<div class="line"><a id="l02224" name="l02224"></a><span class="lineno"> 2224</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l02225" name="l02225"></a><span class="lineno"> 2225</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02226" name="l02226"></a><span class="lineno"> 2226</span> </div>
<div class="line"><a id="l02227" name="l02227"></a><span class="lineno"> 2227</span>   <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#gae3900d28b408cedd58072e5b5d9515a7">sd_from_restart</a>(post_inflate) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02228" name="l02228"></a><span class="lineno"> 2228</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>)) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02229" name="l02229"></a><span class="lineno"> 2229</span>         ens_handle%copies(   <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>), :)  = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a>, :)</div>
<div class="line"><a id="l02230" name="l02230"></a><span class="lineno"> 2230</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l02231" name="l02231"></a><span class="lineno"> 2231</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02232" name="l02232"></a><span class="lineno"> 2232</span> </div>
<div class="line"><a id="l02233" name="l02233"></a><span class="lineno"> 2233</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02234" name="l02234"></a><span class="lineno"> 2234</span> </div>
</div>
<div class="line"><a id="l02235" name="l02235"></a><span class="lineno"> 2235</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a6cab091fff584d16a815ee1cae95cfc1">store_input</a></div>
<div class="line"><a id="l02236" name="l02236"></a><span class="lineno"> 2236</span> </div>
<div class="line"><a id="l02237" name="l02237"></a><span class="lineno"> 2237</span> </div>
<div class="line"><a id="l02238" name="l02238"></a><span class="lineno"> 2238</span><span class="comment">!------------------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02239" name="l02239"></a><span class="lineno"> 2239</span><span class="comment">!&gt; Copy the current mean, sd, inf_mean, inf_sd to spare copies</span></div>
<div class="line"><a id="l02240" name="l02240"></a><span class="lineno"> 2240</span><span class="comment">!&gt; Assuming that if the spare copy is there you should fill it</span></div>
<div class="line"><a id="l02241" name="l02241"></a><span class="lineno"> 2241</span> </div>
<div class="foldopen" id="foldopen02242" data-start="" data-end="">
<div class="line"><a id="l02242" name="l02242"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ae4df205a40c5271f63f40b15a355a8ca"> 2242</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ae4df205a40c5271f63f40b15a355a8ca">store_copies</a>(ens_handle, STAGE_COPIES)</div>
<div class="line"><a id="l02243" name="l02243"></a><span class="lineno"> 2243</span> </div>
<div class="line"><a id="l02244" name="l02244"></a><span class="lineno"> 2244</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>), <span class="keywordtype">intent(inout)</span> :: ens_handle</div>
<div class="line"><a id="l02245" name="l02245"></a><span class="lineno"> 2245</span><span class="keywordtype">integer</span>,             <span class="keywordtype">intent(inout)</span> :: STAGE_COPIES(NUM_SCOPIES)</div>
<div class="line"><a id="l02246" name="l02246"></a><span class="lineno"> 2246</span> </div>
<div class="line"><a id="l02247" name="l02247"></a><span class="lineno"> 2247</span><span class="keywordtype">integer</span> :: i, offset</div>
<div class="line"><a id="l02248" name="l02248"></a><span class="lineno"> 2248</span> </div>
<div class="line"><a id="l02249" name="l02249"></a><span class="lineno"> 2249</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">ens_mean</a>)) ) &amp;</div>
<div class="line"><a id="l02250" name="l02250"></a><span class="lineno"> 2250</span>   ens_handle%copies(   stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">ens_mean</a>), :)      = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, :)</div>
<div class="line"><a id="l02251" name="l02251"></a><span class="lineno"> 2251</span> </div>
<div class="line"><a id="l02252" name="l02252"></a><span class="lineno"> 2252</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">ens_sd</a>)) ) &amp;</div>
<div class="line"><a id="l02253" name="l02253"></a><span class="lineno"> 2253</span>   ens_handle%copies(   stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">ens_sd</a>), :)        = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>, :)</div>
<div class="line"><a id="l02254" name="l02254"></a><span class="lineno"> 2254</span> </div>
<div class="line"><a id="l02255" name="l02255"></a><span class="lineno"> 2255</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a>)) ) &amp;</div>
<div class="line"><a id="l02256" name="l02256"></a><span class="lineno"> 2256</span>   ens_handle%copies(   stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a>), :) = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, :)</div>
<div class="line"><a id="l02257" name="l02257"></a><span class="lineno"> 2257</span> </div>
<div class="line"><a id="l02258" name="l02258"></a><span class="lineno"> 2258</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>)) ) &amp;</div>
<div class="line"><a id="l02259" name="l02259"></a><span class="lineno"> 2259</span>   ens_handle%copies(   stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>), :)   = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a>, :)</div>
<div class="line"><a id="l02260" name="l02260"></a><span class="lineno"> 2260</span> </div>
<div class="line"><a id="l02261" name="l02261"></a><span class="lineno"> 2261</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>)) ) &amp;</div>
<div class="line"><a id="l02262" name="l02262"></a><span class="lineno"> 2262</span>   ens_handle%copies(   stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>), :)  = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, :)</div>
<div class="line"><a id="l02263" name="l02263"></a><span class="lineno"> 2263</span> </div>
<div class="line"><a id="l02264" name="l02264"></a><span class="lineno"> 2264</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>( stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>)) ) &amp;</div>
<div class="line"><a id="l02265" name="l02265"></a><span class="lineno"> 2265</span>   ens_handle%copies(   stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>), :)    = ens_handle%copies(<a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a>, :)</div>
<div class="line"><a id="l02266" name="l02266"></a><span class="lineno"> 2266</span>     </div>
<div class="line"><a id="l02267" name="l02267"></a><span class="lineno"> 2267</span><span class="keywordflow">do</span> i = 1, <a class="code hl_variable" href="namespacefilter__mod.html#a2e635d221f9df63c2e45a0404c77b542">num_output_state_members</a></div>
<div class="line"><a id="l02268" name="l02268"></a><span class="lineno"> 2268</span>   offset = stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">mem_start</a>) + i - 1</div>
<div class="line"><a id="l02269" name="l02269"></a><span class="lineno"> 2269</span>   <span class="keywordflow">if</span> ( <a class="code hl_function" href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">query_copy_present</a>(offset) ) ens_handle%copies(offset, :) = ens_handle%copies(i, :)</div>
<div class="line"><a id="l02270" name="l02270"></a><span class="lineno"> 2270</span><span class="keywordflow">enddo</span></div>
<div class="line"><a id="l02271" name="l02271"></a><span class="lineno"> 2271</span> </div>
</div>
<div class="line"><a id="l02272" name="l02272"></a><span class="lineno"> 2272</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ae4df205a40c5271f63f40b15a355a8ca">store_copies</a></div>
<div class="line"><a id="l02273" name="l02273"></a><span class="lineno"> 2273</span> </div>
<div class="line"><a id="l02274" name="l02274"></a><span class="lineno"> 2274</span> </div>
<div class="line"><a id="l02275" name="l02275"></a><span class="lineno"> 2275</span><span class="comment">!------------------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02276" name="l02276"></a><span class="lineno"> 2276</span><span class="comment">!&gt; Count the number of copies to be allocated for the ensemble manager</span></div>
<div class="line"><a id="l02277" name="l02277"></a><span class="lineno"> 2277</span> </div>
<div class="foldopen" id="foldopen02278" data-start="" data-end="">
<div class="line"><a id="l02278" name="l02278"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#aade0710f5022a2552c756dfc026fed63"> 2278</a></span><span class="keyword">function </span><a class="code hl_function" href="namespacefilter__mod.html#aade0710f5022a2552c756dfc026fed63">count_state_ens_copies</a>(ens_size, post_inflate, prior_inflate) <span class="keyword">result</span>(num_copies)</div>
<div class="line"><a id="l02279" name="l02279"></a><span class="lineno"> 2279</span> </div>
<div class="line"><a id="l02280" name="l02280"></a><span class="lineno"> 2280</span><span class="keywordtype">integer</span>,                     <span class="keywordtype">intent(in)</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a></div>
<div class="line"><a id="l02281" name="l02281"></a><span class="lineno"> 2281</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structadaptive__inflate__mod_1_1adaptive__inflate__type.html">adaptive_inflate_type</a>), <span class="keywordtype">intent(in)</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a></div>
<div class="line"><a id="l02282" name="l02282"></a><span class="lineno"> 2282</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structadaptive__inflate__mod_1_1adaptive__inflate__type.html">adaptive_inflate_type</a>), <span class="keywordtype">intent(in)</span> :: <a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a></div>
<div class="line"><a id="l02283" name="l02283"></a><span class="lineno"> 2283</span><span class="keywordtype">integer</span> :: num_copies</div>
<div class="line"><a id="l02284" name="l02284"></a><span class="lineno"> 2284</span> </div>
<div class="line"><a id="l02285" name="l02285"></a><span class="lineno"> 2285</span><span class="keywordtype">integer</span> :: cnum = 0</div>
<div class="line"><a id="l02286" name="l02286"></a><span class="lineno"> 2286</span> </div>
<div class="line"><a id="l02287" name="l02287"></a><span class="lineno"> 2287</span><span class="comment">! Filter Ensemble Members</span></div>
<div class="line"><a id="l02288" name="l02288"></a><span class="lineno"> 2288</span><span class="comment">!   ENS_MEM_XXXX</span></div>
<div class="line"><a id="l02289" name="l02289"></a><span class="lineno"> 2289</span><a class="code hl_variable" href="namespacefilter__mod.html#aa81a00c06bd9825573e5ae0b45676655">ens_mem_start</a> = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02290" name="l02290"></a><span class="lineno"> 2290</span><a class="code hl_variable" href="namespacefilter__mod.html#af75dd9a652c6247d3ed145ce5e67abdc">ens_mem_end</a>   = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>)</div>
<div class="line"><a id="l02291" name="l02291"></a><span class="lineno"> 2291</span> </div>
<div class="line"><a id="l02292" name="l02292"></a><span class="lineno"> 2292</span><span class="comment">! Filter Extra Copies For Assimilation</span></div>
<div class="line"><a id="l02293" name="l02293"></a><span class="lineno"> 2293</span><span class="comment">!    ENS_MEAN_COPY    </span></div>
<div class="line"><a id="l02294" name="l02294"></a><span class="lineno"> 2294</span><span class="comment">!    ENS_SD_COPY      </span></div>
<div class="line"><a id="l02295" name="l02295"></a><span class="lineno"> 2295</span><span class="comment">!    PRIOR_INF_COPY   </span></div>
<div class="line"><a id="l02296" name="l02296"></a><span class="lineno"> 2296</span><span class="comment">!    PRIOR_INF_SD_COPY</span></div>
<div class="line"><a id="l02297" name="l02297"></a><span class="lineno"> 2297</span><span class="comment">!    POST_INF_COPY    </span></div>
<div class="line"><a id="l02298" name="l02298"></a><span class="lineno"> 2298</span><span class="comment">!    POST_INF_SD_COPY </span></div>
<div class="line"><a id="l02299" name="l02299"></a><span class="lineno"> 2299</span> </div>
<div class="line"><a id="l02300" name="l02300"></a><span class="lineno"> 2300</span><a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>     = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02301" name="l02301"></a><span class="lineno"> 2301</span><a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>       = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02302" name="l02302"></a><span class="lineno"> 2302</span><a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>    = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02303" name="l02303"></a><span class="lineno"> 2303</span><a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a> = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02304" name="l02304"></a><span class="lineno"> 2304</span><a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>     = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02305" name="l02305"></a><span class="lineno"> 2305</span><a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a>  = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02306" name="l02306"></a><span class="lineno"> 2306</span> </div>
<div class="line"><a id="l02307" name="l02307"></a><span class="lineno"> 2307</span><span class="comment">! If there are no diagnostic files, we will need to store the</span></div>
<div class="line"><a id="l02308" name="l02308"></a><span class="lineno"> 2308</span><span class="comment">! copies that would have gone in Prior_Diag.nc and Posterior_Diag.nc</span></div>
<div class="line"><a id="l02309" name="l02309"></a><span class="lineno"> 2309</span><span class="comment">! in spare copies in the ensemble.</span></div>
<div class="line"><a id="l02310" name="l02310"></a><span class="lineno"> 2310</span> </div>
<div class="line"><a id="l02311" name="l02311"></a><span class="lineno"> 2311</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">write_all_stages_at_end</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02312" name="l02312"></a><span class="lineno"> 2312</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;input&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02313" name="l02313"></a><span class="lineno"> 2313</span>      <span class="comment">! Option to Output Input Mean and SD</span></div>
<div class="line"><a id="l02314" name="l02314"></a><span class="lineno"> 2314</span>      <span class="comment">!   INPUT_MEAN</span></div>
<div class="line"><a id="l02315" name="l02315"></a><span class="lineno"> 2315</span>      <span class="comment">!   INPUT_SD  </span></div>
<div class="line"><a id="l02316" name="l02316"></a><span class="lineno"> 2316</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a34bfafb5e98fec24b32f651f7996a59f">output_mean</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02317" name="l02317"></a><span class="lineno"> 2317</span>         <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">ens_mean</a>) = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02318" name="l02318"></a><span class="lineno"> 2318</span>         <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#ga6b7b01c13f591ca5aaa2450cb0c18d2e">mean_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02319" name="l02319"></a><span class="lineno"> 2319</span>            <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a>) = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span><span class="keywordflow">         endif</span></div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span>         <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#ga6b7b01c13f591ca5aaa2450cb0c18d2e">mean_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span>            <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>)  = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span><span class="keywordflow">         endif</span></div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span> </div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a6a0afbade119eb0c73644e49b86b9fb8">output_sd</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"> 2327</span>         <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">ens_sd</a>) = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span>         <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#gae3900d28b408cedd58072e5b5d9515a7">sd_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span>            <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>) = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span><span class="keywordflow">         endif</span></div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span>         <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#gae3900d28b408cedd58072e5b5d9515a7">sd_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span>            <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>)  = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span><span class="keywordflow">         endif</span></div>
<div class="line"><a id="l02334" name="l02334"></a><span class="lineno"> 2334</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l02335" name="l02335"></a><span class="lineno"> 2335</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02336" name="l02336"></a><span class="lineno"> 2336</span> </div>
<div class="line"><a id="l02337" name="l02337"></a><span class="lineno"> 2337</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;forecast&#39;</span>)) &amp;</div>
<div class="line"><a id="l02338" name="l02338"></a><span class="lineno"> 2338</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a628081f6059e815cc6fc76703393cfbd">set_copies</a>( cnum, <a class="code hl_variable" href="namespacefilter__mod.html#a1d29faddb7d7f0f640f15c6a9e39b38b">forecast_copies</a>)</div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span> </div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;preassim&#39;</span>)) &amp;</div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a628081f6059e815cc6fc76703393cfbd">set_copies</a>( cnum, <a class="code hl_variable" href="namespacefilter__mod.html#aa78ffea5f7c1c36719ee2c6497cfeb06">preassim_copies</a>)</div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span> </div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;postassim&#39;</span>)) &amp;</div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a628081f6059e815cc6fc76703393cfbd">set_copies</a>( cnum, <a class="code hl_variable" href="namespacefilter__mod.html#ab7d4c1aa67478d6c8aec44eb82d0c7e7">postassim_copies</a>)</div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span> </div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;analysis&#39;</span>)) &amp;</div>
<div class="line"><a id="l02347" name="l02347"></a><span class="lineno"> 2347</span>      <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a628081f6059e815cc6fc76703393cfbd">set_copies</a>( cnum, <a class="code hl_variable" href="namespacefilter__mod.html#a38ed5812756013876b9a3fb4319d1ec5">analysis_copies</a>)</div>
<div class="line"><a id="l02348" name="l02348"></a><span class="lineno"> 2348</span> </div>
<div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span> </div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span>   <span class="comment">! Write everything in stages</span></div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span>   <span class="comment">! Option to Output Input Mean and SD</span></div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span>   <span class="comment">!   INPUT_MEAN</span></div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"> 2354</span>   <span class="comment">!   INPUT_SD  </span></div>
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"> 2355</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a34bfafb5e98fec24b32f651f7996a59f">output_mean</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"> 2356</span>      <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">ens_mean</a>) = <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a></div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span>      <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a>     .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#ga6b7b01c13f591ca5aaa2450cb0c18d2e">mean_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span>         <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a>) = <a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a></div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span>      <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#ga6b7b01c13f591ca5aaa2450cb0c18d2e">mean_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02361" name="l02361"></a><span class="lineno"> 2361</span>         <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>)  = <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a></div>
<div class="line"><a id="l02362" name="l02362"></a><span class="lineno"> 2362</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span> </div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a6a0afbade119eb0c73644e49b86b9fb8">output_sd</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"> 2366</span>      <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">ens_sd</a>) = <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a></div>
<div class="line"><a id="l02367" name="l02367"></a><span class="lineno"> 2367</span>      <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a>     .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#gae3900d28b408cedd58072e5b5d9515a7">sd_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02368" name="l02368"></a><span class="lineno"> 2368</span>         <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>) = <a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a></div>
<div class="line"><a id="l02369" name="l02369"></a><span class="lineno"> 2369</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l02370" name="l02370"></a><span class="lineno"> 2370</span>      <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#gae3900d28b408cedd58072e5b5d9515a7">sd_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02371" name="l02371"></a><span class="lineno"> 2371</span>         <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>(<a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>)  = <a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a></div>
<div class="line"><a id="l02372" name="l02372"></a><span class="lineno"> 2372</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l02373" name="l02373"></a><span class="lineno"> 2373</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02374" name="l02374"></a><span class="lineno"> 2374</span>  </div>
<div class="line"><a id="l02375" name="l02375"></a><span class="lineno"> 2375</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a1d29faddb7d7f0f640f15c6a9e39b38b">forecast_copies</a>   = (/ <a class="code hl_variable" href="namespacefilter__mod.html#aa81a00c06bd9825573e5ae0b45676655">ens_mem_start</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af75dd9a652c6247d3ed145ce5e67abdc">ens_mem_end</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>, &amp;</div>
<div class="line"><a id="l02376" name="l02376"></a><span class="lineno"> 2376</span>                          <a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a> /)</div>
<div class="line"><a id="l02377" name="l02377"></a><span class="lineno"> 2377</span> </div>
<div class="line"><a id="l02378" name="l02378"></a><span class="lineno"> 2378</span>   <a class="code hl_variable" href="namespacefilter__mod.html#aa78ffea5f7c1c36719ee2c6497cfeb06">preassim_copies</a>   = (/ <a class="code hl_variable" href="namespacefilter__mod.html#aa81a00c06bd9825573e5ae0b45676655">ens_mem_start</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af75dd9a652c6247d3ed145ce5e67abdc">ens_mem_end</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>, &amp;</div>
<div class="line"><a id="l02379" name="l02379"></a><span class="lineno"> 2379</span>                          <a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a> /)</div>
<div class="line"><a id="l02380" name="l02380"></a><span class="lineno"> 2380</span> </div>
<div class="line"><a id="l02381" name="l02381"></a><span class="lineno"> 2381</span>   <a class="code hl_variable" href="namespacefilter__mod.html#ab7d4c1aa67478d6c8aec44eb82d0c7e7">postassim_copies</a>  = (/ <a class="code hl_variable" href="namespacefilter__mod.html#aa81a00c06bd9825573e5ae0b45676655">ens_mem_start</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af75dd9a652c6247d3ed145ce5e67abdc">ens_mem_end</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>, &amp;</div>
<div class="line"><a id="l02382" name="l02382"></a><span class="lineno"> 2382</span>                         <a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a> /)</div>
<div class="line"><a id="l02383" name="l02383"></a><span class="lineno"> 2383</span> </div>
<div class="line"><a id="l02384" name="l02384"></a><span class="lineno"> 2384</span>   <a class="code hl_variable" href="namespacefilter__mod.html#a38ed5812756013876b9a3fb4319d1ec5">analysis_copies</a>   = (/ <a class="code hl_variable" href="namespacefilter__mod.html#aa81a00c06bd9825573e5ae0b45676655">ens_mem_start</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af75dd9a652c6247d3ed145ce5e67abdc">ens_mem_end</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>, &amp;</div>
<div class="line"><a id="l02385" name="l02385"></a><span class="lineno"> 2385</span>                          <a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a> /)</div>
<div class="line"><a id="l02386" name="l02386"></a><span class="lineno"> 2386</span>  </div>
<div class="line"><a id="l02387" name="l02387"></a><span class="lineno"> 2387</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02388" name="l02388"></a><span class="lineno"> 2388</span> </div>
<div class="line"><a id="l02389" name="l02389"></a><span class="lineno"> 2389</span><a class="code hl_variable" href="namespacefilter__mod.html#a61eec52627cc461c7ba4797880958ce5">current_copies</a>    = (/ <a class="code hl_variable" href="namespacefilter__mod.html#aa81a00c06bd9825573e5ae0b45676655">ens_mem_start</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af75dd9a652c6247d3ed145ce5e67abdc">ens_mem_end</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">ens_mean_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">ens_sd_copy</a>, &amp;</div>
<div class="line"><a id="l02390" name="l02390"></a><span class="lineno"> 2390</span>                       <a class="code hl_variable" href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">prior_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">prior_inf_sd_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">post_inf_copy</a>, <a class="code hl_variable" href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">post_inf_sd_copy</a> /)</div>
<div class="line"><a id="l02391" name="l02391"></a><span class="lineno"> 2391</span> </div>
<div class="line"><a id="l02392" name="l02392"></a><span class="lineno"> 2392</span><span class="comment">! If Whitaker/Hamill (2012) relaxation-to-prior-spread (rpts) inflation</span></div>
<div class="line"><a id="l02393" name="l02393"></a><span class="lineno"> 2393</span><span class="comment">! then we need an extra copy to hold (save) the prior ensemble spread</span></div>
<div class="line"><a id="l02394" name="l02394"></a><span class="lineno"> 2394</span><span class="comment">! ENS_SD_COPY will be overwritten with the posterior spread before</span></div>
<div class="line"><a id="l02395" name="l02395"></a><span class="lineno"> 2395</span><span class="comment">! applying the inflation algorithm; must save the prior ensemble spread in a different copy</span></div>
<div class="line"><a id="l02396" name="l02396"></a><span class="lineno"> 2396</span><span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a1a06628fdb3e51bc068347aad285730a">inf_flavor</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>) == <a class="code hl_variable" href="group__adaptive__inflate.html#ga0d3e082200dc5636420dacddccdd35a2">relaxation_to_prior_spread</a> ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02397" name="l02397"></a><span class="lineno"> 2397</span>   <a class="code hl_variable" href="namespacefilter__mod.html#aaf1e25fd8591ef5235d72965ec31be1a">spare_prior_spread</a> = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02398" name="l02398"></a><span class="lineno"> 2398</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02399" name="l02399"></a><span class="lineno"> 2399</span> </div>
<div class="line"><a id="l02400" name="l02400"></a><span class="lineno"> 2400</span>num_copies = cnum</div>
<div class="line"><a id="l02401" name="l02401"></a><span class="lineno"> 2401</span> </div>
</div>
<div class="line"><a id="l02402" name="l02402"></a><span class="lineno"> 2402</span><span class="keyword">end function </span><a class="code hl_function" href="namespacefilter__mod.html#aade0710f5022a2552c756dfc026fed63">count_state_ens_copies</a></div>
<div class="line"><a id="l02403" name="l02403"></a><span class="lineno"> 2403</span> </div>
<div class="line"><a id="l02404" name="l02404"></a><span class="lineno"> 2404</span> </div>
<div class="line"><a id="l02405" name="l02405"></a><span class="lineno"> 2405</span><span class="comment">!------------------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02406" name="l02406"></a><span class="lineno"> 2406</span><span class="comment">!&gt; Set file name information.  For members restarts can be read from</span></div>
<div class="line"><a id="l02407" name="l02407"></a><span class="lineno"> 2407</span><span class="comment">!&gt; an input_state_file_list or constructed using a stage name and</span></div>
<div class="line"><a id="l02408" name="l02408"></a><span class="lineno"> 2408</span><span class="comment">!&gt; num_ens.  The file_info handle knows whether or not there is an</span></div>
<div class="line"><a id="l02409" name="l02409"></a><span class="lineno"> 2409</span><span class="comment">!&gt; associated input_state_file_list. If no list is provided member</span></div>
<div class="line"><a id="l02410" name="l02410"></a><span class="lineno"> 2410</span><span class="comment">!&gt; filenames are written as :</span></div>
<div class="line"><a id="l02411" name="l02411"></a><span class="lineno"> 2411</span><span class="comment">!&gt;    stage_member_####.nc (ex. preassim_member_0001.nc)</span></div>
<div class="line"><a id="l02412" name="l02412"></a><span class="lineno"> 2412</span><span class="comment">!&gt; extra copies are stored as :</span></div>
<div class="line"><a id="l02413" name="l02413"></a><span class="lineno"> 2413</span><span class="comment">!&gt;    stage_basename.nc (ex. preassim_mean.nc)</span></div>
<div class="line"><a id="l02414" name="l02414"></a><span class="lineno"> 2414</span> </div>
<div class="foldopen" id="foldopen02415" data-start="" data-end="">
<div class="line"><a id="l02415" name="l02415"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ad673ddbd207f8a0f2c2f29d95b717a78"> 2415</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ad673ddbd207f8a0f2c2f29d95b717a78">set_filename_info</a>(file_info, stage, num_ens, STAGE_COPIES) </div>
<div class="line"><a id="l02416" name="l02416"></a><span class="lineno"> 2416</span> </div>
<div class="line"><a id="l02417" name="l02417"></a><span class="lineno"> 2417</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>), <span class="keywordtype">intent(inout)</span> :: file_info</div>
<div class="line"><a id="l02418" name="l02418"></a><span class="lineno"> 2418</span><span class="keywordtype">character(len=*)</span>,     <span class="keywordtype">intent(in)</span>    :: stage</div>
<div class="line"><a id="l02419" name="l02419"></a><span class="lineno"> 2419</span><span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>    :: num_ens</div>
<div class="line"><a id="l02420" name="l02420"></a><span class="lineno"> 2420</span><span class="keywordtype">integer</span>,              <span class="keywordtype">intent(inout)</span> :: STAGE_COPIES(NUM_SCOPIES)</div>
<div class="line"><a id="l02421" name="l02421"></a><span class="lineno"> 2421</span> </div>
<div class="line"><a id="l02422" name="l02422"></a><span class="lineno"> 2422</span><span class="keyword">call </span><a class="code hl_function" href="group__io__filenames__mod.html#ga70cbfa7f0895d3a51ed17ebc7fea96fa">set_member_file_metadata</a>(file_info, num_ens, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">mem_start</a>))</div>
<div class="line"><a id="l02423" name="l02423"></a><span class="lineno"> 2423</span> </div>
<div class="line"><a id="l02424" name="l02424"></a><span class="lineno"> 2424</span> </div>
<div class="line"><a id="l02425" name="l02425"></a><span class="lineno"> 2425</span>stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ac97d329291d9ed859f969a8cf2ac8c99">mem_end</a>) = stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">mem_start</a>) + num_ens - 1</div>
<div class="line"><a id="l02426" name="l02426"></a><span class="lineno"> 2426</span> </div>
<div class="line"><a id="l02427" name="l02427"></a><span class="lineno"> 2427</span><span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__file__metadata.html">set_file_metadata</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">ens_mean</a>),      stage, <span class="stringliteral">&#39;mean&#39;</span>,          <span class="stringliteral">&#39;ensemble mean&#39;</span>)</div>
<div class="line"><a id="l02428" name="l02428"></a><span class="lineno"> 2428</span><span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__file__metadata.html">set_file_metadata</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">ens_sd</a>),        stage, <span class="stringliteral">&#39;sd&#39;</span>,            <span class="stringliteral">&#39;ensemble sd&#39;</span>)</div>
<div class="line"><a id="l02429" name="l02429"></a><span class="lineno"> 2429</span><span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__file__metadata.html">set_file_metadata</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a>), stage, <span class="stringliteral">&#39;priorinf_mean&#39;</span>, <span class="stringliteral">&#39;prior inflation mean&#39;</span>)</div>
<div class="line"><a id="l02430" name="l02430"></a><span class="lineno"> 2430</span><span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__file__metadata.html">set_file_metadata</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>),   stage, <span class="stringliteral">&#39;priorinf_sd&#39;</span>,   <span class="stringliteral">&#39;prior inflation sd&#39;</span>)</div>
<div class="line"><a id="l02431" name="l02431"></a><span class="lineno"> 2431</span><span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__file__metadata.html">set_file_metadata</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>),  stage, <span class="stringliteral">&#39;postinf_mean&#39;</span>,  <span class="stringliteral">&#39;posterior inflation mean&#39;</span>)</div>
<div class="line"><a id="l02432" name="l02432"></a><span class="lineno"> 2432</span><span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__file__metadata.html">set_file_metadata</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>),    stage, <span class="stringliteral">&#39;postinf_sd&#39;</span>,    <span class="stringliteral">&#39;posterior inflation sd&#39;</span>)</div>
<div class="line"><a id="l02433" name="l02433"></a><span class="lineno"> 2433</span> </div>
</div>
<div class="line"><a id="l02434" name="l02434"></a><span class="lineno"> 2434</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ad673ddbd207f8a0f2c2f29d95b717a78">set_filename_info</a></div>
<div class="line"><a id="l02435" name="l02435"></a><span class="lineno"> 2435</span> </div>
<div class="line"><a id="l02436" name="l02436"></a><span class="lineno"> 2436</span><span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a id="l02437" name="l02437"></a><span class="lineno"> 2437</span> </div>
<div class="foldopen" id="foldopen02438" data-start="" data-end="">
<div class="line"><a id="l02438" name="l02438"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a9b1d65085fce43bd275a8fe91bc0725e"> 2438</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a9b1d65085fce43bd275a8fe91bc0725e">set_input_file_info</a>( file_info, num_ens, STAGE_COPIES )</div>
<div class="line"><a id="l02439" name="l02439"></a><span class="lineno"> 2439</span> </div>
<div class="line"><a id="l02440" name="l02440"></a><span class="lineno"> 2440</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>), <span class="keywordtype">intent(inout)</span> :: file_info</div>
<div class="line"><a id="l02441" name="l02441"></a><span class="lineno"> 2441</span><span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>    :: num_ens</div>
<div class="line"><a id="l02442" name="l02442"></a><span class="lineno"> 2442</span><span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>    :: STAGE_COPIES(NUM_SCOPIES)</div>
<div class="line"><a id="l02443" name="l02443"></a><span class="lineno"> 2443</span> </div>
<div class="line"><a id="l02444" name="l02444"></a><span class="lineno"> 2444</span><span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#ab21ff1ee87b3f7e9bfab3fed249624b1">perturb_from_single_instance</a> ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02445" name="l02445"></a><span class="lineno"> 2445</span>   <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">mem_start</a>), <a class="code hl_variable" href="group__io__filenames__mod.html#gaae140d2c2c3279b00cf73e97268b14e9">read_copy</a>)<span class="comment"></span></div>
<div class="line"><a id="l02446" name="l02446"></a><span class="lineno"> 2446</span><span class="comment">   !&gt;@todo know whether we are perturbing or not</span></div>
<div class="line"><a id="l02447" name="l02447"></a><span class="lineno"> 2447</span>   <span class="comment">!#! call set_perturb_members(file_info, MEM_START, num_ens)</span></div>
<div class="line"><a id="l02448" name="l02448"></a><span class="lineno"> 2448</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l02449" name="l02449"></a><span class="lineno"> 2449</span>   <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">mem_start</a>), stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">mem_start</a>)+num_ens-1, <a class="code hl_variable" href="group__io__filenames__mod.html#gaae140d2c2c3279b00cf73e97268b14e9">read_copy</a>)</div>
<div class="line"><a id="l02450" name="l02450"></a><span class="lineno"> 2450</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02451" name="l02451"></a><span class="lineno"> 2451</span> </div>
<div class="line"><a id="l02452" name="l02452"></a><span class="lineno"> 2452</span><span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a> ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02453" name="l02453"></a><span class="lineno"> 2453</span>   <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#aa52472d92f849fc0b5de5a57806ed8ad">inf_initial_from_restart</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>)    ) &amp;</div>
<div class="line"><a id="l02454" name="l02454"></a><span class="lineno"> 2454</span>      <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a>), <a class="code hl_variable" href="group__io__filenames__mod.html#gaae140d2c2c3279b00cf73e97268b14e9">read_copy</a>, inherit_units=.false.)</div>
<div class="line"><a id="l02455" name="l02455"></a><span class="lineno"> 2455</span>   <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#acc88936518a51aed421d731d3c628402">inf_sd_initial_from_restart</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">prior_inf</a>) ) &amp;</div>
<div class="line"><a id="l02456" name="l02456"></a><span class="lineno"> 2456</span>      <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>),   <a class="code hl_variable" href="group__io__filenames__mod.html#gaae140d2c2c3279b00cf73e97268b14e9">read_copy</a>, inherit_units=.false.)</div>
<div class="line"><a id="l02457" name="l02457"></a><span class="lineno"> 2457</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02458" name="l02458"></a><span class="lineno"> 2458</span> </div>
<div class="line"><a id="l02459" name="l02459"></a><span class="lineno"> 2459</span><span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02460" name="l02460"></a><span class="lineno"> 2460</span>   <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#aa52472d92f849fc0b5de5a57806ed8ad">inf_initial_from_restart</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>)    ) &amp;</div>
<div class="line"><a id="l02461" name="l02461"></a><span class="lineno"> 2461</span>      <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>),  <a class="code hl_variable" href="group__io__filenames__mod.html#gaae140d2c2c3279b00cf73e97268b14e9">read_copy</a>, inherit_units=.false.)</div>
<div class="line"><a id="l02462" name="l02462"></a><span class="lineno"> 2462</span>   <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#acc88936518a51aed421d731d3c628402">inf_sd_initial_from_restart</a>(<a class="code hl_variable" href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">posterior_inf</a>) ) &amp;</div>
<div class="line"><a id="l02463" name="l02463"></a><span class="lineno"> 2463</span>      <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>),    <a class="code hl_variable" href="group__io__filenames__mod.html#gaae140d2c2c3279b00cf73e97268b14e9">read_copy</a>, inherit_units=.false.)</div>
<div class="line"><a id="l02464" name="l02464"></a><span class="lineno"> 2464</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02465" name="l02465"></a><span class="lineno"> 2465</span> </div>
<div class="line"><a id="l02466" name="l02466"></a><span class="lineno"> 2466</span><span class="comment">! This is for single file augmented state mean and sd if requested</span></div>
<div class="line"><a id="l02467" name="l02467"></a><span class="lineno"> 2467</span><span class="keywordflow">if</span>(<a class="code hl_variable" href="namespacefilter__mod.html#a72faee5fd84c3e52b6191c8f0043693f">single_file_in</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02468" name="l02468"></a><span class="lineno"> 2468</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a34bfafb5e98fec24b32f651f7996a59f">output_mean</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02469" name="l02469"></a><span class="lineno"> 2469</span>     <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info,    stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">ens_mean</a>),  <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, inherit_units=.true.)</div>
<div class="line"><a id="l02470" name="l02470"></a><span class="lineno"> 2470</span> </div>
<div class="line"><a id="l02471" name="l02471"></a><span class="lineno"> 2471</span>      <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#ga6b7b01c13f591ca5aaa2450cb0c18d2e">mean_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>) ) &amp;</div>
<div class="line"><a id="l02472" name="l02472"></a><span class="lineno"> 2472</span>        <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a>), <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, inherit_units=.false.)</div>
<div class="line"><a id="l02473" name="l02473"></a><span class="lineno"> 2473</span> </div>
<div class="line"><a id="l02474" name="l02474"></a><span class="lineno"> 2474</span>      <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#ga6b7b01c13f591ca5aaa2450cb0c18d2e">mean_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>) ) &amp;</div>
<div class="line"><a id="l02475" name="l02475"></a><span class="lineno"> 2475</span>        <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>),  <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, inherit_units=.false.)</div>
<div class="line"><a id="l02476" name="l02476"></a><span class="lineno"> 2476</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02477" name="l02477"></a><span class="lineno"> 2477</span>   </div>
<div class="line"><a id="l02478" name="l02478"></a><span class="lineno"> 2478</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a6a0afbade119eb0c73644e49b86b9fb8">output_sd</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02479" name="l02479"></a><span class="lineno"> 2479</span>     <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">ens_sd</a>),    <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, inherit_units=.true.)</div>
<div class="line"><a id="l02480" name="l02480"></a><span class="lineno"> 2480</span> </div>
<div class="line"><a id="l02481" name="l02481"></a><span class="lineno"> 2481</span>      <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#gae3900d28b408cedd58072e5b5d9515a7">sd_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">prior_inflate</a>) ) &amp;</div>
<div class="line"><a id="l02482" name="l02482"></a><span class="lineno"> 2482</span>        <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>), <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, inherit_units=.false.)</div>
<div class="line"><a id="l02483" name="l02483"></a><span class="lineno"> 2483</span> </div>
<div class="line"><a id="l02484" name="l02484"></a><span class="lineno"> 2484</span>      <span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> .and. .not. <a class="code hl_function" href="group__adaptive__inflate.html#gae3900d28b408cedd58072e5b5d9515a7">sd_from_restart</a>(<a class="code hl_variable" href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">post_inflate</a>) ) &amp;</div>
<div class="line"><a id="l02485" name="l02485"></a><span class="lineno"> 2485</span>        <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>),  <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, inherit_units=.false.)</div>
<div class="line"><a id="l02486" name="l02486"></a><span class="lineno"> 2486</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02487" name="l02487"></a><span class="lineno"> 2487</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02488" name="l02488"></a><span class="lineno"> 2488</span> </div>
</div>
<div class="line"><a id="l02489" name="l02489"></a><span class="lineno"> 2489</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a9b1d65085fce43bd275a8fe91bc0725e">set_input_file_info</a></div>
<div class="line"><a id="l02490" name="l02490"></a><span class="lineno"> 2490</span> </div>
<div class="line"><a id="l02491" name="l02491"></a><span class="lineno"> 2491</span><span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a id="l02492" name="l02492"></a><span class="lineno"> 2492</span> </div>
<div class="foldopen" id="foldopen02493" data-start="" data-end="">
<div class="line"><a id="l02493" name="l02493"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a5fcd2a1cd08db2f0df8bb60b53a9f54b"> 2493</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a5fcd2a1cd08db2f0df8bb60b53a9f54b">set_output_file_info</a>( file_info, num_ens, STAGE_COPIES, do_clamping, force_copy)</div>
<div class="line"><a id="l02494" name="l02494"></a><span class="lineno"> 2494</span> </div>
<div class="line"><a id="l02495" name="l02495"></a><span class="lineno"> 2495</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>), <span class="keywordtype">intent(inout)</span> :: file_info</div>
<div class="line"><a id="l02496" name="l02496"></a><span class="lineno"> 2496</span><span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>    :: num_ens</div>
<div class="line"><a id="l02497" name="l02497"></a><span class="lineno"> 2497</span><span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>    :: STAGE_COPIES(NUM_SCOPIES)</div>
<div class="line"><a id="l02498" name="l02498"></a><span class="lineno"> 2498</span><span class="keywordtype">logical</span>,              <span class="keywordtype">intent(in)</span>    :: do_clamping</div>
<div class="line"><a id="l02499" name="l02499"></a><span class="lineno"> 2499</span><span class="keywordtype">logical</span>,              <span class="keywordtype">intent(in)</span>    :: force_copy</div>
<div class="line"><a id="l02500" name="l02500"></a><span class="lineno"> 2500</span><span class="comment"></span> </div>
<div class="line"><a id="l02501" name="l02501"></a><span class="lineno"> 2501</span><span class="comment">!&gt;@todo revisit if we should be clamping mean copy for file_info_output</span></div>
<div class="line"><a id="l02502" name="l02502"></a><span class="lineno"> 2502</span><span class="keywordflow">if</span> ( num_ens &gt; 0 .and. <a class="code hl_variable" href="namespacefilter__mod.html#a8f715cc2fb31b5b14a58f9bd06cf86f3">output_members</a> ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02503" name="l02503"></a><span class="lineno"> 2503</span>   <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">mem_start</a>), stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">mem_start</a>)+num_ens-1, <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, &amp;</div>
<div class="line"><a id="l02504" name="l02504"></a><span class="lineno"> 2504</span>                         num_output_ens=num_ens, clamp_vars=do_clamping, &amp;</div>
<div class="line"><a id="l02505" name="l02505"></a><span class="lineno"> 2505</span>                         <a class="code hl_function" href="group__io__filenames__mod.html#ga931e77da21e002703282c7662cb77f47">force_copy_back</a>=force_copy)</div>
<div class="line"><a id="l02506" name="l02506"></a><span class="lineno"> 2506</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02507" name="l02507"></a><span class="lineno"> 2507</span> </div>
<div class="line"><a id="l02508" name="l02508"></a><span class="lineno"> 2508</span><span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a34bfafb5e98fec24b32f651f7996a59f">output_mean</a> )          &amp;</div>
<div class="line"><a id="l02509" name="l02509"></a><span class="lineno"> 2509</span>   <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">ens_mean</a>),       <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, &amp;</div>
<div class="line"><a id="l02510" name="l02510"></a><span class="lineno"> 2510</span>                         inherit_units=.true., clamp_vars=do_clamping, <a class="code hl_function" href="group__io__filenames__mod.html#ga931e77da21e002703282c7662cb77f47">force_copy_back</a>=force_copy)</div>
<div class="line"><a id="l02511" name="l02511"></a><span class="lineno"> 2511</span><span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a6a0afbade119eb0c73644e49b86b9fb8">output_sd</a> )            &amp;</div>
<div class="line"><a id="l02512" name="l02512"></a><span class="lineno"> 2512</span>   <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">ens_sd</a>),         <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, &amp;</div>
<div class="line"><a id="l02513" name="l02513"></a><span class="lineno"> 2513</span>                         inherit_units=.true., <a class="code hl_function" href="group__io__filenames__mod.html#ga931e77da21e002703282c7662cb77f47">force_copy_back</a>=force_copy)</div>
<div class="line"><a id="l02514" name="l02514"></a><span class="lineno"> 2514</span><span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a> )     &amp;</div>
<div class="line"><a id="l02515" name="l02515"></a><span class="lineno"> 2515</span>   <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a>),  <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, &amp;</div>
<div class="line"><a id="l02516" name="l02516"></a><span class="lineno"> 2516</span>                         inherit_units=.false., <a class="code hl_function" href="group__io__filenames__mod.html#ga931e77da21e002703282c7662cb77f47">force_copy_back</a>=force_copy)</div>
<div class="line"><a id="l02517" name="l02517"></a><span class="lineno"> 2517</span><span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a> )     &amp;</div>
<div class="line"><a id="l02518" name="l02518"></a><span class="lineno"> 2518</span>   <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>),    <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, &amp;</div>
<div class="line"><a id="l02519" name="l02519"></a><span class="lineno"> 2519</span>                         inherit_units=.false., <a class="code hl_function" href="group__io__filenames__mod.html#ga931e77da21e002703282c7662cb77f47">force_copy_back</a>=force_copy)</div>
<div class="line"><a id="l02520" name="l02520"></a><span class="lineno"> 2520</span><span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> ) &amp;</div>
<div class="line"><a id="l02521" name="l02521"></a><span class="lineno"> 2521</span>   <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>),   <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, &amp;</div>
<div class="line"><a id="l02522" name="l02522"></a><span class="lineno"> 2522</span>                         inherit_units=.false., <a class="code hl_function" href="group__io__filenames__mod.html#ga931e77da21e002703282c7662cb77f47">force_copy_back</a>=force_copy)</div>
<div class="line"><a id="l02523" name="l02523"></a><span class="lineno"> 2523</span><span class="keywordflow">if</span> ( <a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a> ) &amp;</div>
<div class="line"><a id="l02524" name="l02524"></a><span class="lineno"> 2524</span>   <span class="keyword">call </span><a class="code hl_interface" href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">set_io_copy_flag</a>(file_info, stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>),     <a class="code hl_variable" href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">write_copy</a>, &amp;</div>
<div class="line"><a id="l02525" name="l02525"></a><span class="lineno"> 2525</span>                         inherit_units=.false., <a class="code hl_function" href="group__io__filenames__mod.html#ga931e77da21e002703282c7662cb77f47">force_copy_back</a>=force_copy)</div>
<div class="line"><a id="l02526" name="l02526"></a><span class="lineno"> 2526</span> </div>
</div>
<div class="line"><a id="l02527" name="l02527"></a><span class="lineno"> 2527</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a5fcd2a1cd08db2f0df8bb60b53a9f54b">set_output_file_info</a></div>
<div class="line"><a id="l02528" name="l02528"></a><span class="lineno"> 2528</span> </div>
<div class="line"><a id="l02529" name="l02529"></a><span class="lineno"> 2529</span><span class="comment">!-----------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02530" name="l02530"></a><span class="lineno"> 2530</span><span class="comment">!&gt; checks the user input and informs the IO modules which files to write.</span></div>
<div class="line"><a id="l02531" name="l02531"></a><span class="lineno"> 2531</span> </div>
<div class="line"><a id="l02532" name="l02532"></a><span class="lineno"> 2532</span> </div>
<div class="foldopen" id="foldopen02533" data-start="" data-end="">
<div class="line"><a id="l02533" name="l02533"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a01bd6b2eba904d41a35c868fd2ec1c13"> 2533</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a01bd6b2eba904d41a35c868fd2ec1c13">parse_stages_to_write</a>(stages)</div>
<div class="line"><a id="l02534" name="l02534"></a><span class="lineno"> 2534</span> </div>
<div class="line"><a id="l02535" name="l02535"></a><span class="lineno"> 2535</span><span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: stages(:)</div>
<div class="line"><a id="l02536" name="l02536"></a><span class="lineno"> 2536</span> </div>
<div class="line"><a id="l02537" name="l02537"></a><span class="lineno"> 2537</span><span class="keywordtype">integer</span> :: nstages, i</div>
<div class="line"><a id="l02538" name="l02538"></a><span class="lineno"> 2538</span><span class="keywordtype">character (len=32)</span> :: my_stage</div>
<div class="line"><a id="l02539" name="l02539"></a><span class="lineno"> 2539</span> </div>
<div class="line"><a id="l02540" name="l02540"></a><span class="lineno"> 2540</span>nstages = <span class="keyword">size</span>(stages,1)</div>
<div class="line"><a id="l02541" name="l02541"></a><span class="lineno"> 2541</span> </div>
<div class="line"><a id="l02542" name="l02542"></a><span class="lineno"> 2542</span><span class="keywordflow">do</span> i = 1, nstages</div>
<div class="line"><a id="l02543" name="l02543"></a><span class="lineno"> 2543</span>   my_stage = stages(i)</div>
<div class="line"><a id="l02544" name="l02544"></a><span class="lineno"> 2544</span>   <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a3cd818255d7f98765915ab676582b413">to_upper</a>(my_stage)</div>
<div class="line"><a id="l02545" name="l02545"></a><span class="lineno"> 2545</span>   <span class="keywordflow">if</span> (trim(my_stage) /= trim(<span class="stringliteral">&#39;NULL&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02546" name="l02546"></a><span class="lineno"> 2546</span>   <span class="keywordflow">SELECT CASE</span> (my_stage)</div>
<div class="line"><a id="l02547" name="l02547"></a><span class="lineno"> 2547</span>      <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;INPUT&#39;</span>, <span class="stringliteral">&#39;FORECAST&#39;</span>, <span class="stringliteral">&#39;PREASSIM&#39;</span>, <span class="stringliteral">&#39;POSTASSIM&#39;</span>, <span class="stringliteral">&#39;ANALYSIS&#39;</span>, <span class="stringliteral">&#39;OUTPUT&#39;</span>)</div>
<div class="line"><a id="l02548" name="l02548"></a><span class="lineno"> 2548</span>         <span class="keyword">call </span><a class="code hl_function" href="group__state__vector__io__mod.html#gaa80af78515963bcd545f18c9349e8c87">set_stage_to_write</a>(stages(i),.true.)</div>
<div class="line"><a id="l02549" name="l02549"></a><span class="lineno"> 2549</span>         <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>,*)<span class="stringliteral">&quot;filter will write stage : &quot;</span>//trim(stages(i))</div>
<div class="line"><a id="l02550" name="l02550"></a><span class="lineno"> 2550</span>         <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">e_msg</a>,<span class="stringliteral">&#39;parse_stages_to_write:&#39;</span>,<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>,<a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>)</div>
<div class="line"><a id="l02551" name="l02551"></a><span class="lineno"> 2551</span><span class="keywordflow">      CASE DEFAULT</span></div>
<div class="line"><a id="l02552" name="l02552"></a><span class="lineno"> 2552</span>         <span class="keyword">write</span>(<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>,*)<span class="stringliteral">&quot;unknown stage : &quot;</span>//trim(stages(i))</div>
<div class="line"><a id="l02553" name="l02553"></a><span class="lineno"> 2553</span>         <span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">error_handler</a>(<a class="code hl_variable" href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">e_err</a>,<span class="stringliteral">&#39;parse_stages_to_write:&#39;</span>,<a class="code hl_variable" href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">msgstring</a>,<a class="code hl_variable" href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">source</a>, &amp;</div>
<div class="line"><a id="l02554" name="l02554"></a><span class="lineno"> 2554</span>                           text2=<span class="stringliteral">&quot;currently supported stages include :&quot;</span>,&amp;</div>
<div class="line"><a id="l02555" name="l02555"></a><span class="lineno"> 2555</span>                           text3=<span class="stringliteral">&quot;input, forecast, preassim, postassim, analysis, output&quot;</span>)</div>
<div class="line"><a id="l02556" name="l02556"></a><span class="lineno"> 2556</span><span class="keywordflow">   END SELECT</span></div>
<div class="line"><a id="l02557" name="l02557"></a><span class="lineno"> 2557</span> </div>
<div class="line"><a id="l02558" name="l02558"></a><span class="lineno"> 2558</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02559" name="l02559"></a><span class="lineno"> 2559</span><span class="keywordflow">enddo</span></div>
<div class="line"><a id="l02560" name="l02560"></a><span class="lineno"> 2560</span> </div>
</div>
<div class="line"><a id="l02561" name="l02561"></a><span class="lineno"> 2561</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a01bd6b2eba904d41a35c868fd2ec1c13">parse_stages_to_write</a></div>
<div class="line"><a id="l02562" name="l02562"></a><span class="lineno"> 2562</span> </div>
<div class="line"><a id="l02563" name="l02563"></a><span class="lineno"> 2563</span><span class="comment">!-----------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02564" name="l02564"></a><span class="lineno"> 2564</span><span class="comment">!&gt; checks the user input and informs the IO modules which files to write.</span></div>
<div class="line"><a id="l02565" name="l02565"></a><span class="lineno"> 2565</span> </div>
<div class="line"><a id="l02566" name="l02566"></a><span class="lineno"> 2566</span> </div>
<div class="foldopen" id="foldopen02567" data-start="" data-end="">
<div class="line"><a id="l02567" name="l02567"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4"> 2567</a></span><span class="keyword">function </span><a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum, ncopies)</div>
<div class="line"><a id="l02568" name="l02568"></a><span class="lineno"> 2568</span><span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span>        :: cnum</div>
<div class="line"><a id="l02569" name="l02569"></a><span class="lineno"> 2569</span><span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: ncopies</div>
<div class="line"><a id="l02570" name="l02570"></a><span class="lineno"> 2570</span><span class="keywordtype">integer</span> :: <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a></div>
<div class="line"><a id="l02571" name="l02571"></a><span class="lineno"> 2571</span> </div>
<div class="line"><a id="l02572" name="l02572"></a><span class="lineno"> 2572</span><span class="keywordflow">if</span> (<span class="keyword">present</span>(ncopies)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02573" name="l02573"></a><span class="lineno"> 2573</span>   <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a> = cnum + ncopies - 1</div>
<div class="line"><a id="l02574" name="l02574"></a><span class="lineno"> 2574</span><span class="keywordflow">else</span></div>
<div class="line"><a id="l02575" name="l02575"></a><span class="lineno"> 2575</span>   <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a> = cnum + 1</div>
<div class="line"><a id="l02576" name="l02576"></a><span class="lineno"> 2576</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02577" name="l02577"></a><span class="lineno"> 2577</span> </div>
<div class="line"><a id="l02578" name="l02578"></a><span class="lineno"> 2578</span>cnum = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a></div>
<div class="line"><a id="l02579" name="l02579"></a><span class="lineno"> 2579</span> </div>
</div>
<div class="line"><a id="l02580" name="l02580"></a><span class="lineno"> 2580</span><span class="keyword">end function </span><a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a></div>
<div class="line"><a id="l02581" name="l02581"></a><span class="lineno"> 2581</span> </div>
<div class="line"><a id="l02582" name="l02582"></a><span class="lineno"> 2582</span><span class="comment">!-----------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02583" name="l02583"></a><span class="lineno"> 2583</span><span class="comment">!&gt; initialize file names and which copies should be read and or written</span></div>
<div class="line"><a id="l02584" name="l02584"></a><span class="lineno"> 2584</span> </div>
<div class="line"><a id="l02585" name="l02585"></a><span class="lineno"> 2585</span> </div>
<div class="foldopen" id="foldopen02586" data-start="" data-end="">
<div class="line"><a id="l02586" name="l02586"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#ae9eaef91b58f18b6b913aee9aa0ea912"> 2586</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ae9eaef91b58f18b6b913aee9aa0ea912">initialize_file_information</a>(ncopies, &amp;</div>
<div class="line"><a id="l02587" name="l02587"></a><span class="lineno"> 2587</span>                                       file_info_input,     file_info_mean_sd, &amp;</div>
<div class="line"><a id="l02588" name="l02588"></a><span class="lineno"> 2588</span>                                       file_info_forecast,  file_info_preassim, &amp;</div>
<div class="line"><a id="l02589" name="l02589"></a><span class="lineno"> 2589</span>                                       file_info_postassim, file_info_analysis, &amp;</div>
<div class="line"><a id="l02590" name="l02590"></a><span class="lineno"> 2590</span>                                       file_info_output)</div>
<div class="line"><a id="l02591" name="l02591"></a><span class="lineno"> 2591</span> </div>
<div class="line"><a id="l02592" name="l02592"></a><span class="lineno"> 2592</span><span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>  :: ncopies</div>
<div class="line"><a id="l02593" name="l02593"></a><span class="lineno"> 2593</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>), <span class="keywordtype">intent(out)</span> :: file_info_input</div>
<div class="line"><a id="l02594" name="l02594"></a><span class="lineno"> 2594</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>), <span class="keywordtype">intent(out)</span> :: file_info_mean_sd</div>
<div class="line"><a id="l02595" name="l02595"></a><span class="lineno"> 2595</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>), <span class="keywordtype">intent(out)</span> :: file_info_forecast</div>
<div class="line"><a id="l02596" name="l02596"></a><span class="lineno"> 2596</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>), <span class="keywordtype">intent(out)</span> :: file_info_preassim</div>
<div class="line"><a id="l02597" name="l02597"></a><span class="lineno"> 2597</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>), <span class="keywordtype">intent(out)</span> :: file_info_postassim</div>
<div class="line"><a id="l02598" name="l02598"></a><span class="lineno"> 2598</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>), <span class="keywordtype">intent(out)</span> :: file_info_analysis</div>
<div class="line"><a id="l02599" name="l02599"></a><span class="lineno"> 2599</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structio__filenames__mod_1_1file__info__type.html">file_info_type</a>), <span class="keywordtype">intent(out)</span> :: file_info_output</div>
<div class="line"><a id="l02600" name="l02600"></a><span class="lineno"> 2600</span> </div>
<div class="line"><a id="l02601" name="l02601"></a><span class="lineno"> 2601</span><span class="keywordtype">integer</span> :: noutput_members, ninput_files, noutput_files, ndomains</div>
<div class="line"><a id="l02602" name="l02602"></a><span class="lineno"> 2602</span><span class="keywordtype">character(len=256)</span>, <span class="keywordtype">allocatable</span> :: file_array_input(:,:), file_array_output(:,:)</div>
<div class="line"><a id="l02603" name="l02603"></a><span class="lineno"> 2603</span> </div>
<div class="line"><a id="l02604" name="l02604"></a><span class="lineno"> 2604</span><span class="comment">! local variable to shorten the name for function input</span></div>
<div class="line"><a id="l02605" name="l02605"></a><span class="lineno"> 2605</span>noutput_members = <a class="code hl_variable" href="namespacefilter__mod.html#a2e635d221f9df63c2e45a0404c77b542">num_output_state_members</a> </div>
<div class="line"><a id="l02606" name="l02606"></a><span class="lineno"> 2606</span>ndomains        = <a class="code hl_function" href="group__state__structure__mod.html#gad2bdf8059dbbe43bc0a3a3d3c875a0bb">get_num_domains</a>()</div>
<div class="line"><a id="l02607" name="l02607"></a><span class="lineno"> 2607</span>noutput_files   = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a> <span class="comment">! number of incomming ensemble members</span></div>
<div class="line"><a id="l02608" name="l02608"></a><span class="lineno"> 2608</span>ninput_files    = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a> <span class="comment">! number of incomming ensemble members</span></div>
<div class="line"><a id="l02609" name="l02609"></a><span class="lineno"> 2609</span> </div>
<div class="line"><a id="l02610" name="l02610"></a><span class="lineno"> 2610</span><span class="comment">! Assign the correct number of input and output files.</span></div>
<div class="line"><a id="l02611" name="l02611"></a><span class="lineno"> 2611</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a72faee5fd84c3e52b6191c8f0043693f">single_file_in</a> .or. <a class="code hl_variable" href="namespacefilter__mod.html#ab21ff1ee87b3f7e9bfab3fed249624b1">perturb_from_single_instance</a>)  ninput_files = 1</div>
<div class="line"><a id="l02612" name="l02612"></a><span class="lineno"> 2612</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a>)                                  noutput_files = 1</div>
<div class="line"><a id="l02613" name="l02613"></a><span class="lineno"> 2613</span> </div>
<div class="line"><a id="l02614" name="l02614"></a><span class="lineno"> 2614</span><span class="comment">! Given either a vector of in/output_state_files or a text file containing</span></div>
<div class="line"><a id="l02615" name="l02615"></a><span class="lineno"> 2615</span><span class="comment">! a list of files, return a vector of files containing the filenames.</span></div>
<div class="line"><a id="l02616" name="l02616"></a><span class="lineno"> 2616</span><span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#aeafbbb638346cc6ff201d3d9db2ee25b">set_multiple_filename_lists</a>(<a class="code hl_variable" href="namespacefilter__mod.html#ab751fbc6a9ea198bae7c0f7a23c3f340">input_state_files</a>(:), &amp;</div>
<div class="line"><a id="l02617" name="l02617"></a><span class="lineno"> 2617</span>                                 <a class="code hl_variable" href="namespacefilter__mod.html#a8576eaefc8bad0b49d7c893588bde7f9">input_state_file_list</a>(:), &amp;</div>
<div class="line"><a id="l02618" name="l02618"></a><span class="lineno"> 2618</span>                                 ndomains, &amp;</div>
<div class="line"><a id="l02619" name="l02619"></a><span class="lineno"> 2619</span>                                 ninput_files,     &amp;</div>
<div class="line"><a id="l02620" name="l02620"></a><span class="lineno"> 2620</span>                                 <span class="stringliteral">&#39;filter&#39;</span>,<span class="stringliteral">&#39;input_state_files&#39;</span>,<span class="stringliteral">&#39;input_state_file_list&#39;</span>)</div>
<div class="line"><a id="l02621" name="l02621"></a><span class="lineno"> 2621</span><span class="keyword">call </span><a class="code hl_function" href="namespaceutilities__mod.html#aeafbbb638346cc6ff201d3d9db2ee25b">set_multiple_filename_lists</a>(<a class="code hl_variable" href="namespacefilter__mod.html#a782a1d98e3e47c18d480c4397af79f93">output_state_files</a>(:), &amp;</div>
<div class="line"><a id="l02622" name="l02622"></a><span class="lineno"> 2622</span>                                 <a class="code hl_variable" href="namespacefilter__mod.html#a317b51268d909d4934f51b732df4531c">output_state_file_list</a>(:), &amp;</div>
<div class="line"><a id="l02623" name="l02623"></a><span class="lineno"> 2623</span>                                 ndomains, &amp;</div>
<div class="line"><a id="l02624" name="l02624"></a><span class="lineno"> 2624</span>                                 noutput_files, &amp;</div>
<div class="line"><a id="l02625" name="l02625"></a><span class="lineno"> 2625</span>                                 <span class="stringliteral">&#39;filter&#39;</span>,<span class="stringliteral">&#39;output_state_files&#39;</span>,<span class="stringliteral">&#39;output_state_file_list&#39;</span>)</div>
<div class="line"><a id="l02626" name="l02626"></a><span class="lineno"> 2626</span> </div>
<div class="line"><a id="l02627" name="l02627"></a><span class="lineno"> 2627</span><span class="comment">! Allocate space for file arrays.  contains a matrix of files (num_ens x num_domains)</span></div>
<div class="line"><a id="l02628" name="l02628"></a><span class="lineno"> 2628</span><span class="comment">! If perturbing from a single instance the number of input files does not have to</span></div>
<div class="line"><a id="l02629" name="l02629"></a><span class="lineno"> 2629</span><span class="comment">! be ens_size but rather a single file (or multiple files if more than one domain)</span></div>
<div class="line"><a id="l02630" name="l02630"></a><span class="lineno"> 2630</span><span class="keyword">allocate</span>(file_array_input(ninput_files, ndomains), file_array_output(noutput_files, ndomains))</div>
<div class="line"><a id="l02631" name="l02631"></a><span class="lineno"> 2631</span> </div>
<div class="line"><a id="l02632" name="l02632"></a><span class="lineno"> 2632</span>file_array_input  = reshape(<a class="code hl_variable" href="namespacefilter__mod.html#ab751fbc6a9ea198bae7c0f7a23c3f340">input_state_files</a>,  (/ninput_files,  ndomains/))</div>
<div class="line"><a id="l02633" name="l02633"></a><span class="lineno"> 2633</span>file_array_output = reshape(<a class="code hl_variable" href="namespacefilter__mod.html#a782a1d98e3e47c18d480c4397af79f93">output_state_files</a>, (/noutput_files, ndomains/))</div>
<div class="line"><a id="l02634" name="l02634"></a><span class="lineno"> 2634</span> </div>
<div class="line"><a id="l02635" name="l02635"></a><span class="lineno"> 2635</span> </div>
<div class="line"><a id="l02636" name="l02636"></a><span class="lineno"> 2636</span><span class="comment">! Allocate space for the filename handles</span></div>
<div class="line"><a id="l02637" name="l02637"></a><span class="lineno"> 2637</span><span class="keyword">call </span><a class="code hl_function" href="group__io__filenames__mod.html#ga29f2ee6ce9ec4ffb32c45586e7208e1c">io_filenames_init</a>(file_info_input,                       &amp; </div>
<div class="line"><a id="l02638" name="l02638"></a><span class="lineno"> 2638</span>                       ncopies       = ncopies,               &amp;</div>
<div class="line"><a id="l02639" name="l02639"></a><span class="lineno"> 2639</span>                       cycling       = <a class="code hl_variable" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">has_cycling</a>,           &amp;</div>
<div class="line"><a id="l02640" name="l02640"></a><span class="lineno"> 2640</span>                       single_file   = <a class="code hl_variable" href="namespacefilter__mod.html#a72faee5fd84c3e52b6191c8f0043693f">single_file_in</a>,        &amp;</div>
<div class="line"><a id="l02641" name="l02641"></a><span class="lineno"> 2641</span>                       restart_files = file_array_input,      &amp;</div>
<div class="line"><a id="l02642" name="l02642"></a><span class="lineno"> 2642</span>                       root_name     = <span class="stringliteral">&#39;input&#39;</span>)</div>
<div class="line"><a id="l02643" name="l02643"></a><span class="lineno"> 2643</span> </div>
<div class="line"><a id="l02644" name="l02644"></a><span class="lineno"> 2644</span><span class="comment">! Output Files (we construct the filenames)</span></div>
<div class="line"><a id="l02645" name="l02645"></a><span class="lineno"> 2645</span><span class="keyword">call </span><a class="code hl_function" href="group__io__filenames__mod.html#ga29f2ee6ce9ec4ffb32c45586e7208e1c">io_filenames_init</a>(file_info_mean_sd,   ncopies, <a class="code hl_variable" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">has_cycling</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a>, root_name=<span class="stringliteral">&#39;input&#39;</span>)</div>
<div class="line"><a id="l02646" name="l02646"></a><span class="lineno"> 2646</span><span class="keyword">call </span><a class="code hl_function" href="group__io__filenames__mod.html#ga29f2ee6ce9ec4ffb32c45586e7208e1c">io_filenames_init</a>(file_info_forecast,  ncopies, <a class="code hl_variable" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">has_cycling</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a>, root_name=<span class="stringliteral">&#39;forecast&#39;</span>)</div>
<div class="line"><a id="l02647" name="l02647"></a><span class="lineno"> 2647</span><span class="keyword">call </span><a class="code hl_function" href="group__io__filenames__mod.html#ga29f2ee6ce9ec4ffb32c45586e7208e1c">io_filenames_init</a>(file_info_preassim,  ncopies, <a class="code hl_variable" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">has_cycling</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a>, root_name=<span class="stringliteral">&#39;preassim&#39;</span>)</div>
<div class="line"><a id="l02648" name="l02648"></a><span class="lineno"> 2648</span><span class="keyword">call </span><a class="code hl_function" href="group__io__filenames__mod.html#ga29f2ee6ce9ec4ffb32c45586e7208e1c">io_filenames_init</a>(file_info_postassim, ncopies, <a class="code hl_variable" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">has_cycling</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a>, root_name=<span class="stringliteral">&#39;postassim&#39;</span>)</div>
<div class="line"><a id="l02649" name="l02649"></a><span class="lineno"> 2649</span><span class="keyword">call </span><a class="code hl_function" href="group__io__filenames__mod.html#ga29f2ee6ce9ec4ffb32c45586e7208e1c">io_filenames_init</a>(file_info_analysis,  ncopies, <a class="code hl_variable" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">has_cycling</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a>, root_name=<span class="stringliteral">&#39;analysis&#39;</span>)</div>
<div class="line"><a id="l02650" name="l02650"></a><span class="lineno"> 2650</span> </div>
<div class="line"><a id="l02651" name="l02651"></a><span class="lineno"> 2651</span><span class="comment">! Write restart from output_state_file_list if provided</span></div>
<div class="line"><a id="l02652" name="l02652"></a><span class="lineno"> 2652</span><span class="keyword">call </span><a class="code hl_function" href="group__io__filenames__mod.html#ga29f2ee6ce9ec4ffb32c45586e7208e1c">io_filenames_init</a>(file_info_output,                       &amp;</div>
<div class="line"><a id="l02653" name="l02653"></a><span class="lineno"> 2653</span>                       ncopies       = ncopies,                &amp;</div>
<div class="line"><a id="l02654" name="l02654"></a><span class="lineno"> 2654</span>                       cycling       = <a class="code hl_variable" href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">has_cycling</a>,            &amp;</div>
<div class="line"><a id="l02655" name="l02655"></a><span class="lineno"> 2655</span>                       single_file   = <a class="code hl_variable" href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">single_file_out</a>,        &amp;</div>
<div class="line"><a id="l02656" name="l02656"></a><span class="lineno"> 2656</span>                       restart_files = file_array_output,      &amp;</div>
<div class="line"><a id="l02657" name="l02657"></a><span class="lineno"> 2657</span>                       root_name     = <span class="stringliteral">&#39;output&#39;</span>,               &amp;</div>
<div class="line"><a id="l02658" name="l02658"></a><span class="lineno"> 2658</span>                       check_output_compatibility = .true.)</div>
<div class="line"><a id="l02659" name="l02659"></a><span class="lineno"> 2659</span> </div>
<div class="line"><a id="l02660" name="l02660"></a><span class="lineno"> 2660</span> </div>
<div class="line"><a id="l02661" name="l02661"></a><span class="lineno"> 2661</span><span class="comment">! Set filename metadata information</span></div>
<div class="line"><a id="l02662" name="l02662"></a><span class="lineno"> 2662</span><span class="comment">!   Input Files</span></div>
<div class="line"><a id="l02663" name="l02663"></a><span class="lineno"> 2663</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ad673ddbd207f8a0f2c2f29d95b717a78">set_filename_info</a>(file_info_input,       <span class="stringliteral">&#39;input&#39;</span>,     <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>,          <a class="code hl_variable" href="namespacefilter__mod.html#a61eec52627cc461c7ba4797880958ce5">current_copies</a> )</div>
<div class="line"><a id="l02664" name="l02664"></a><span class="lineno"> 2664</span> </div>
<div class="line"><a id="l02665" name="l02665"></a><span class="lineno"> 2665</span><span class="comment">!   Output Files</span></div>
<div class="line"><a id="l02666" name="l02666"></a><span class="lineno"> 2666</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;input&#39;</span>)) &amp;</div>
<div class="line"><a id="l02667" name="l02667"></a><span class="lineno"> 2667</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ad673ddbd207f8a0f2c2f29d95b717a78">set_filename_info</a>(file_info_mean_sd,  <span class="stringliteral">&#39;input&#39;</span>,     0,                   <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a> )</div>
<div class="line"><a id="l02668" name="l02668"></a><span class="lineno"> 2668</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;forecast&#39;</span>)) &amp;</div>
<div class="line"><a id="l02669" name="l02669"></a><span class="lineno"> 2669</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ad673ddbd207f8a0f2c2f29d95b717a78">set_filename_info</a>(file_info_forecast, <span class="stringliteral">&#39;forecast&#39;</span>,  noutput_members,  <a class="code hl_variable" href="namespacefilter__mod.html#a1d29faddb7d7f0f640f15c6a9e39b38b">forecast_copies</a> )</div>
<div class="line"><a id="l02670" name="l02670"></a><span class="lineno"> 2670</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;preassim&#39;</span>)) &amp;</div>
<div class="line"><a id="l02671" name="l02671"></a><span class="lineno"> 2671</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ad673ddbd207f8a0f2c2f29d95b717a78">set_filename_info</a>(file_info_preassim, <span class="stringliteral">&#39;preassim&#39;</span>,  noutput_members,  <a class="code hl_variable" href="namespacefilter__mod.html#aa78ffea5f7c1c36719ee2c6497cfeb06">preassim_copies</a> )</div>
<div class="line"><a id="l02672" name="l02672"></a><span class="lineno"> 2672</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;postassim&#39;</span>)) &amp;</div>
<div class="line"><a id="l02673" name="l02673"></a><span class="lineno"> 2673</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ad673ddbd207f8a0f2c2f29d95b717a78">set_filename_info</a>(file_info_postassim,<span class="stringliteral">&#39;postassim&#39;</span>, noutput_members, <a class="code hl_variable" href="namespacefilter__mod.html#ab7d4c1aa67478d6c8aec44eb82d0c7e7">postassim_copies</a> ) </div>
<div class="line"><a id="l02674" name="l02674"></a><span class="lineno"> 2674</span><span class="keywordflow">if</span> (<a class="code hl_function" href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">get_stage_to_write</a>(<span class="stringliteral">&#39;analysis&#39;</span>)) &amp;</div>
<div class="line"><a id="l02675" name="l02675"></a><span class="lineno"> 2675</span>   <span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ad673ddbd207f8a0f2c2f29d95b717a78">set_filename_info</a>(file_info_analysis, <span class="stringliteral">&#39;analysis&#39;</span>,  noutput_members,  <a class="code hl_variable" href="namespacefilter__mod.html#a38ed5812756013876b9a3fb4319d1ec5">analysis_copies</a> )</div>
<div class="line"><a id="l02676" name="l02676"></a><span class="lineno"> 2676</span> </div>
<div class="line"><a id="l02677" name="l02677"></a><span class="lineno"> 2677</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#ad673ddbd207f8a0f2c2f29d95b717a78">set_filename_info</a>(file_info_output,      <span class="stringliteral">&#39;output&#39;</span>,    <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>,          <a class="code hl_variable" href="namespacefilter__mod.html#a61eec52627cc461c7ba4797880958ce5">current_copies</a> )</div>
<div class="line"><a id="l02678" name="l02678"></a><span class="lineno"> 2678</span> </div>
<div class="line"><a id="l02679" name="l02679"></a><span class="lineno"> 2679</span><span class="comment">! Set file IO information</span></div>
<div class="line"><a id="l02680" name="l02680"></a><span class="lineno"> 2680</span><span class="comment">!   Input Files</span></div>
<div class="line"><a id="l02681" name="l02681"></a><span class="lineno"> 2681</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a9b1d65085fce43bd275a8fe91bc0725e">set_input_file_info</a>( file_info_input, <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>, <a class="code hl_variable" href="namespacefilter__mod.html#a61eec52627cc461c7ba4797880958ce5">current_copies</a> ) </div>
<div class="line"><a id="l02682" name="l02682"></a><span class="lineno"> 2682</span> </div>
<div class="line"><a id="l02683" name="l02683"></a><span class="lineno"> 2683</span><span class="comment">!   Output Files</span></div>
<div class="line"><a id="l02684" name="l02684"></a><span class="lineno"> 2684</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a5fcd2a1cd08db2f0df8bb60b53a9f54b">set_output_file_info</a>( file_info_mean_sd,           &amp; </div>
<div class="line"><a id="l02685" name="l02685"></a><span class="lineno"> 2685</span>                           num_ens      = 0,            &amp;</div>
<div class="line"><a id="l02686" name="l02686"></a><span class="lineno"> 2686</span>                           stage_copies = <a class="code hl_variable" href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">input_copies</a>, &amp;</div>
<div class="line"><a id="l02687" name="l02687"></a><span class="lineno"> 2687</span>                           do_clamping  = .false.,      &amp;</div>
<div class="line"><a id="l02688" name="l02688"></a><span class="lineno"> 2688</span>                           force_copy   = .true. )</div>
<div class="line"><a id="l02689" name="l02689"></a><span class="lineno"> 2689</span> </div>
<div class="line"><a id="l02690" name="l02690"></a><span class="lineno"> 2690</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a5fcd2a1cd08db2f0df8bb60b53a9f54b">set_output_file_info</a>( file_info_forecast,             &amp;</div>
<div class="line"><a id="l02691" name="l02691"></a><span class="lineno"> 2691</span>                           num_ens      = noutput_members, &amp;</div>
<div class="line"><a id="l02692" name="l02692"></a><span class="lineno"> 2692</span>                           stage_copies = <a class="code hl_variable" href="namespacefilter__mod.html#a1d29faddb7d7f0f640f15c6a9e39b38b">forecast_copies</a>, &amp;</div>
<div class="line"><a id="l02693" name="l02693"></a><span class="lineno"> 2693</span>                           do_clamping  = .false.,         &amp;</div>
<div class="line"><a id="l02694" name="l02694"></a><span class="lineno"> 2694</span>                           force_copy   = .true. )</div>
<div class="line"><a id="l02695" name="l02695"></a><span class="lineno"> 2695</span> </div>
<div class="line"><a id="l02696" name="l02696"></a><span class="lineno"> 2696</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a5fcd2a1cd08db2f0df8bb60b53a9f54b">set_output_file_info</a>( file_info_preassim,             &amp;</div>
<div class="line"><a id="l02697" name="l02697"></a><span class="lineno"> 2697</span>                           num_ens      = noutput_members, &amp;</div>
<div class="line"><a id="l02698" name="l02698"></a><span class="lineno"> 2698</span>                           stage_copies = <a class="code hl_variable" href="namespacefilter__mod.html#aa78ffea5f7c1c36719ee2c6497cfeb06">preassim_copies</a>, &amp; </div>
<div class="line"><a id="l02699" name="l02699"></a><span class="lineno"> 2699</span>                           do_clamping  = .false.,         &amp;</div>
<div class="line"><a id="l02700" name="l02700"></a><span class="lineno"> 2700</span>                           force_copy   = .true. )</div>
<div class="line"><a id="l02701" name="l02701"></a><span class="lineno"> 2701</span> </div>
<div class="line"><a id="l02702" name="l02702"></a><span class="lineno"> 2702</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a5fcd2a1cd08db2f0df8bb60b53a9f54b">set_output_file_info</a>( file_info_postassim,             &amp;</div>
<div class="line"><a id="l02703" name="l02703"></a><span class="lineno"> 2703</span>                           num_ens      = noutput_members,  &amp;</div>
<div class="line"><a id="l02704" name="l02704"></a><span class="lineno"> 2704</span>                           stage_copies = <a class="code hl_variable" href="namespacefilter__mod.html#ab7d4c1aa67478d6c8aec44eb82d0c7e7">postassim_copies</a>, &amp;</div>
<div class="line"><a id="l02705" name="l02705"></a><span class="lineno"> 2705</span>                           do_clamping  = .false.,          &amp;</div>
<div class="line"><a id="l02706" name="l02706"></a><span class="lineno"> 2706</span>                           force_copy   = .true. )</div>
<div class="line"><a id="l02707" name="l02707"></a><span class="lineno"> 2707</span> </div>
<div class="line"><a id="l02708" name="l02708"></a><span class="lineno"> 2708</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a5fcd2a1cd08db2f0df8bb60b53a9f54b">set_output_file_info</a>( file_info_analysis,             &amp;</div>
<div class="line"><a id="l02709" name="l02709"></a><span class="lineno"> 2709</span>                           num_ens      = noutput_members, &amp;</div>
<div class="line"><a id="l02710" name="l02710"></a><span class="lineno"> 2710</span>                           stage_copies = <a class="code hl_variable" href="namespacefilter__mod.html#a38ed5812756013876b9a3fb4319d1ec5">analysis_copies</a>, &amp;</div>
<div class="line"><a id="l02711" name="l02711"></a><span class="lineno"> 2711</span>                           do_clamping  = .false.,         &amp;</div>
<div class="line"><a id="l02712" name="l02712"></a><span class="lineno"> 2712</span>                           force_copy   = .true. )</div>
<div class="line"><a id="l02713" name="l02713"></a><span class="lineno"> 2713</span> </div>
<div class="line"><a id="l02714" name="l02714"></a><span class="lineno"> 2714</span><span class="keyword">call </span><a class="code hl_function" href="namespacefilter__mod.html#a5fcd2a1cd08db2f0df8bb60b53a9f54b">set_output_file_info</a>( file_info_output,              &amp;</div>
<div class="line"><a id="l02715" name="l02715"></a><span class="lineno"> 2715</span>                           num_ens      = <a class="code hl_variable" href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">ens_size</a>,       &amp;</div>
<div class="line"><a id="l02716" name="l02716"></a><span class="lineno"> 2716</span>                           stage_copies = <a class="code hl_variable" href="namespacefilter__mod.html#a61eec52627cc461c7ba4797880958ce5">current_copies</a>, &amp;</div>
<div class="line"><a id="l02717" name="l02717"></a><span class="lineno"> 2717</span>                           do_clamping  = .true.,         &amp;</div>
<div class="line"><a id="l02718" name="l02718"></a><span class="lineno"> 2718</span>                           force_copy   = .false. )</div>
<div class="line"><a id="l02719" name="l02719"></a><span class="lineno"> 2719</span> </div>
</div>
<div class="line"><a id="l02720" name="l02720"></a><span class="lineno"> 2720</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#ae9eaef91b58f18b6b913aee9aa0ea912">initialize_file_information</a></div>
<div class="line"><a id="l02721" name="l02721"></a><span class="lineno"> 2721</span> </div>
<div class="line"><a id="l02722" name="l02722"></a><span class="lineno"> 2722</span> </div>
<div class="line"><a id="l02723" name="l02723"></a><span class="lineno"> 2723</span><span class="comment">!-----------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02724" name="l02724"></a><span class="lineno"> 2724</span><span class="comment">!&gt; set copy numbers. this is for when writing all stages at end</span></div>
<div class="line"><a id="l02725" name="l02725"></a><span class="lineno"> 2725</span> </div>
<div class="foldopen" id="foldopen02726" data-start="" data-end="">
<div class="line"><a id="l02726" name="l02726"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a628081f6059e815cc6fc76703393cfbd"> 2726</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a628081f6059e815cc6fc76703393cfbd">set_copies</a>(cnum, STAGE_COPIES)</div>
<div class="line"><a id="l02727" name="l02727"></a><span class="lineno"> 2727</span><span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span> :: cnum</div>
<div class="line"><a id="l02728" name="l02728"></a><span class="lineno"> 2728</span><span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span> :: STAGE_COPIES(NUM_SCOPIES)</div>
<div class="line"><a id="l02729" name="l02729"></a><span class="lineno"> 2729</span> </div>
<div class="line"><a id="l02730" name="l02730"></a><span class="lineno"> 2730</span><span class="comment">! Option to Output Postassim Ensemble Members Before Posterior Inflation</span></div>
<div class="line"><a id="l02731" name="l02731"></a><span class="lineno"> 2731</span><span class="comment">!   MEM_START</span></div>
<div class="line"><a id="l02732" name="l02732"></a><span class="lineno"> 2732</span><span class="comment">!   MEM_END = MEM_START + num_output_state_members - 1</span></div>
<div class="line"><a id="l02733" name="l02733"></a><span class="lineno"> 2733</span>stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">mem_start</a>) = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02734" name="l02734"></a><span class="lineno"> 2734</span>stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ac97d329291d9ed859f969a8cf2ac8c99">mem_end</a>)   = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum, <a class="code hl_variable" href="namespacefilter__mod.html#a2e635d221f9df63c2e45a0404c77b542">num_output_state_members</a>)</div>
<div class="line"><a id="l02735" name="l02735"></a><span class="lineno"> 2735</span> </div>
<div class="line"><a id="l02736" name="l02736"></a><span class="lineno"> 2736</span><span class="comment">! Option to Output Input Mean and SD</span></div>
<div class="line"><a id="l02737" name="l02737"></a><span class="lineno"> 2737</span><span class="comment">!   MEAN</span></div>
<div class="line"><a id="l02738" name="l02738"></a><span class="lineno"> 2738</span><span class="comment">!   SD</span></div>
<div class="line"><a id="l02739" name="l02739"></a><span class="lineno"> 2739</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a34bfafb5e98fec24b32f651f7996a59f">output_mean</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02740" name="l02740"></a><span class="lineno"> 2740</span>   stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">ens_mean</a>) = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02741" name="l02741"></a><span class="lineno"> 2741</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02742" name="l02742"></a><span class="lineno"> 2742</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a6a0afbade119eb0c73644e49b86b9fb8">output_sd</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02743" name="l02743"></a><span class="lineno"> 2743</span>   stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">ens_sd</a>)   = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02744" name="l02744"></a><span class="lineno"> 2744</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02745" name="l02745"></a><span class="lineno"> 2745</span> </div>
<div class="line"><a id="l02746" name="l02746"></a><span class="lineno"> 2746</span><span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a98fbf532050fe3d2ac8674e4d7b0eaf7">output_inflation</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02747" name="l02747"></a><span class="lineno"> 2747</span>   <span class="comment">! Option to Output Infation with Damping</span></div>
<div class="line"><a id="l02748" name="l02748"></a><span class="lineno"> 2748</span>   <span class="comment">!    PRIORINF_MEAN</span></div>
<div class="line"><a id="l02749" name="l02749"></a><span class="lineno"> 2749</span>   <span class="comment">!    PRIORINF_SD</span></div>
<div class="line"><a id="l02750" name="l02750"></a><span class="lineno"> 2750</span>   <span class="comment">!    POSTINF_MEAN</span></div>
<div class="line"><a id="l02751" name="l02751"></a><span class="lineno"> 2751</span>   <span class="comment">!    POSTINF_SD</span></div>
<div class="line"><a id="l02752" name="l02752"></a><span class="lineno"> 2752</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">do_prior_inflate</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02753" name="l02753"></a><span class="lineno"> 2753</span>      stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">priorinf_mean</a>) = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02754" name="l02754"></a><span class="lineno"> 2754</span>      stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">priorinf_sd</a>)   = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02755" name="l02755"></a><span class="lineno"> 2755</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02756" name="l02756"></a><span class="lineno"> 2756</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">do_posterior_inflate</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02757" name="l02757"></a><span class="lineno"> 2757</span>      stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">postinf_mean</a>)  = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02758" name="l02758"></a><span class="lineno"> 2758</span>      stage_copies(<a class="code hl_variable" href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">postinf_sd</a>)    = <a class="code hl_function" href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">next_copy_number</a>(cnum)</div>
<div class="line"><a id="l02759" name="l02759"></a><span class="lineno"> 2759</span><span class="keywordflow">   endif</span></div>
<div class="line"><a id="l02760" name="l02760"></a><span class="lineno"> 2760</span><span class="keywordflow">endif</span></div>
<div class="line"><a id="l02761" name="l02761"></a><span class="lineno"> 2761</span> </div>
</div>
<div class="line"><a id="l02762" name="l02762"></a><span class="lineno"> 2762</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a628081f6059e815cc6fc76703393cfbd">set_copies</a></div>
<div class="line"><a id="l02763" name="l02763"></a><span class="lineno"> 2763</span> </div>
<div class="line"><a id="l02764" name="l02764"></a><span class="lineno"> 2764</span><span class="comment">!==================================================================</span></div>
<div class="line"><a id="l02765" name="l02765"></a><span class="lineno"> 2765</span><span class="comment">! TEST FUNCTIONS BELOW THIS POINT</span></div>
<div class="line"><a id="l02766" name="l02766"></a><span class="lineno"> 2766</span><span class="comment">!------------------------------------------------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l02767" name="l02767"></a><span class="lineno"> 2767</span><span class="comment">!&gt; dump out obs_copies to file</span></div>
<div class="foldopen" id="foldopen02768" data-start="" data-end="">
<div class="line"><a id="l02768" name="l02768"></a><span class="lineno"><a class="line" href="namespacefilter__mod.html#a65acc7e86af9a343955b2e8557a2d00e"> 2768</a></span><span class="keyword">subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a65acc7e86af9a343955b2e8557a2d00e">test_obs_copies</a>(obs_fwd_op_ens_handle, information)</div>
<div class="line"><a id="l02769" name="l02769"></a><span class="lineno"> 2769</span> </div>
<div class="line"><a id="l02770" name="l02770"></a><span class="lineno"> 2770</span><span class="keywordtype">type</span>(<a class="code hl_struct" href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_type</a>), <span class="keywordtype">intent(in)</span> :: obs_fwd_op_ens_handle</div>
<div class="line"><a id="l02771" name="l02771"></a><span class="lineno"> 2771</span><span class="keywordtype">character(len=*)</span>,    <span class="keywordtype">intent(in)</span> :: information</div>
<div class="line"><a id="l02772" name="l02772"></a><span class="lineno"> 2772</span> </div>
<div class="line"><a id="l02773" name="l02773"></a><span class="lineno"> 2773</span><span class="keywordtype">character(len=20)</span>  :: task_str <span class="comment">!! string to hold the task number</span></div>
<div class="line"><a id="l02774" name="l02774"></a><span class="lineno"> 2774</span><span class="keywordtype">character(len=256)</span> :: file_obscopies <span class="comment">!! output file name</span></div>
<div class="line"><a id="l02775" name="l02775"></a><span class="lineno"> 2775</span><span class="keywordtype">integer</span> :: i, iunit</div>
<div class="line"><a id="l02776" name="l02776"></a><span class="lineno"> 2776</span> </div>
<div class="line"><a id="l02777" name="l02777"></a><span class="lineno"> 2777</span><span class="keyword">write</span>(task_str, <span class="stringliteral">&#39;(i10)&#39;</span>) obs_fwd_op_ens_handle%my_pe</div>
<div class="line"><a id="l02778" name="l02778"></a><span class="lineno"> 2778</span>file_obscopies = trim(<span class="stringliteral">&#39;obscopies_&#39;</span> // trim(adjustl(information)) // trim(adjustl(task_str)))</div>
<div class="line"><a id="l02779" name="l02779"></a><span class="lineno"> 2779</span> </div>
<div class="line"><a id="l02780" name="l02780"></a><span class="lineno"> 2780</span>iunit = <a class="code hl_function" href="namespaceutilities__mod.html#a77ad7301456803b1c560cd7c75a37549">open_file</a>(file_obscopies, <span class="stringliteral">&#39;formatted&#39;</span>, <span class="stringliteral">&#39;append&#39;</span>)</div>
<div class="line"><a id="l02781" name="l02781"></a><span class="lineno"> 2781</span> </div>
<div class="line"><a id="l02782" name="l02782"></a><span class="lineno"> 2782</span><span class="keywordflow">do</span> i = 1, obs_fwd_op_ens_handle%num_copies - 4</div>
<div class="line"><a id="l02783" name="l02783"></a><span class="lineno"> 2783</span>   <span class="keyword">write</span>(iunit, *) obs_fwd_op_ens_handle%copies(i,:)</div>
<div class="line"><a id="l02784" name="l02784"></a><span class="lineno"> 2784</span><span class="keywordflow">enddo</span></div>
<div class="line"><a id="l02785" name="l02785"></a><span class="lineno"> 2785</span> </div>
<div class="line"><a id="l02786" name="l02786"></a><span class="lineno"> 2786</span><span class="keyword">close</span>(iunit)</div>
<div class="line"><a id="l02787" name="l02787"></a><span class="lineno"> 2787</span> </div>
</div>
<div class="line"><a id="l02788" name="l02788"></a><span class="lineno"> 2788</span><span class="keyword">end subroutine </span><a class="code hl_function" href="namespacefilter__mod.html#a65acc7e86af9a343955b2e8557a2d00e">test_obs_copies</a></div>
<div class="line"><a id="l02789" name="l02789"></a><span class="lineno"> 2789</span> </div>
<div class="line"><a id="l02790" name="l02790"></a><span class="lineno"> 2790</span><span class="comment">!-------------------------------------------------------------------</span></div>
<div class="line"><a id="l02791" name="l02791"></a><span class="lineno"> 2791</span><span class="keyword">end module </span><a class="code hl_namespace" href="namespacefilter__mod.html">filter_mod</a></div>
<div class="line"><a id="l02792" name="l02792"></a><span class="lineno"> 2792</span> </div>
<div class="ttc" id="agroup__adaptive__inflate_html_ga00966fea8d2aed6b6e341f21c5a9938a"><div class="ttname"><a href="group__adaptive__inflate.html#ga00966fea8d2aed6b6e341f21c5a9938a">adaptive_inflate_mod::prior_inf</a></div><div class="ttdeci">integer, parameter, public prior_inf</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00050">adaptive_inflate_mod.f90:50</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_ga04f520c0ed73033b24269c4624e537ee"><div class="ttname"><a href="group__adaptive__inflate.html#ga04f520c0ed73033b24269c4624e537ee">adaptive_inflate_mod::set_inflation_mean_copy</a></div><div class="ttdeci">subroutine, public set_inflation_mean_copy(inflation_handle, c)</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l01487">adaptive_inflate_mod.f90:1488</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_ga0d3e082200dc5636420dacddccdd35a2"><div class="ttname"><a href="group__adaptive__inflate.html#ga0d3e082200dc5636420dacddccdd35a2">adaptive_inflate_mod::relaxation_to_prior_spread</a></div><div class="ttdeci">integer, parameter, public relaxation_to_prior_spread</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00065">adaptive_inflate_mod.f90:65</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_ga3f51d4c989b159a9a447451cae99116e"><div class="ttname"><a href="group__adaptive__inflate.html#ga3f51d4c989b159a9a447451cae99116e">adaptive_inflate_mod::do_ss_inflate</a></div><div class="ttdeci">logical function, public do_ss_inflate(inflation)</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00201">adaptive_inflate_mod.f90:202</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_ga5e2b2164fc43832ae208ab74dbcbddbc"><div class="ttname"><a href="group__adaptive__inflate.html#ga5e2b2164fc43832ae208ab74dbcbddbc">adaptive_inflate_mod::adaptive_inflate_init</a></div><div class="ttdeci">subroutine, public adaptive_inflate_init(inflate_handle, inf_flavor, mean_from_restart, sd_from_restart, output_inflation, deterministic, inf_initial, sd_initial, inf_lower_bound, inf_upper_bound, sd_lower_bound, sd_max_change, missing_ok, label)</div><div class="ttdoc">Initializes an adaptive_inflate_type.</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00220">adaptive_inflate_mod.f90:224</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_ga60d10130243b2b52a490e7c73874243b"><div class="ttname"><a href="group__adaptive__inflate.html#ga60d10130243b2b52a490e7c73874243b">adaptive_inflate_mod::posterior_inf</a></div><div class="ttdeci">integer, parameter, public posterior_inf</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00051">adaptive_inflate_mod.f90:51</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_ga6b7b01c13f591ca5aaa2450cb0c18d2e"><div class="ttname"><a href="group__adaptive__inflate.html#ga6b7b01c13f591ca5aaa2450cb0c18d2e">adaptive_inflate_mod::mean_from_restart</a></div><div class="ttdeci">logical function, public mean_from_restart(inflation)</div><div class="ttdoc">Accessor functions for adaptive inflate type.</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00110">adaptive_inflate_mod.f90:111</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_ga6cd0390aea56fdaa321b9fb3f58c5e99"><div class="ttname"><a href="group__adaptive__inflate.html#ga6cd0390aea56fdaa321b9fb3f58c5e99">adaptive_inflate_mod::set_inflation_sd_copy</a></div><div class="ttdeci">subroutine, public set_inflation_sd_copy(inflation_handle, c)</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l01499">adaptive_inflate_mod.f90:1500</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_ga81a04174a5714a8630dd252999afa301"><div class="ttname"><a href="group__adaptive__inflate.html#ga81a04174a5714a8630dd252999afa301">adaptive_inflate_mod::no_inflation</a></div><div class="ttdeci">integer, parameter, public no_inflation</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00061">adaptive_inflate_mod.f90:61</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_ga85001cecec972148adcec6c7ef31e1e5"><div class="ttname"><a href="group__adaptive__inflate.html#ga85001cecec972148adcec6c7ef31e1e5">adaptive_inflate_mod::inflate_ens</a></div><div class="ttdeci">subroutine, public inflate_ens(inflate_handle, ens, mean, inflate, var_in, fsprd, asprd)</div><div class="ttdoc">Inflates subset of ensemble members given mean and inflate Selects between deterministic and stochast...</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00524">adaptive_inflate_mod.f90:525</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_ga9b7a2f79554831e034bf1a1ee85090ea"><div class="ttname"><a href="group__adaptive__inflate.html#ga9b7a2f79554831e034bf1a1ee85090ea">adaptive_inflate_mod::validate_inflate_options</a></div><div class="ttdeci">subroutine, public validate_inflate_options(inf_flavor, inf_damping, inf_initial_from_restart, inf_sd_initial_from_restart, inf_deterministic, inf_sd_max_change, do_prior_inflate, do_posterior_inflate, output_inflation, compute_posterior)</div><div class="ttdoc">Make sure the combination of inflation options are legal.</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00409">adaptive_inflate_mod.f90:413</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_gaa8d41eed01259f2e25d03340be3114ef"><div class="ttname"><a href="group__adaptive__inflate.html#gaa8d41eed01259f2e25d03340be3114ef">adaptive_inflate_mod::obs_inflation</a></div><div class="ttdeci">integer, parameter, public obs_inflation</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00062">adaptive_inflate_mod.f90:62</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_gaaa80278515e32002fc8dfa1a431482af"><div class="ttname"><a href="group__adaptive__inflate.html#gaaa80278515e32002fc8dfa1a431482af">adaptive_inflate_mod::do_rtps_inflate</a></div><div class="ttdeci">logical function, public do_rtps_inflate(inflate_handle)</div><div class="ttdoc">Returns true if this inflation type indicates posterior relaxion-to-prior-spread (whitaker &amp; Hamill,...</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00366">adaptive_inflate_mod.f90:367</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_gabc7fca9bfb048d5f738b3da299e18765"><div class="ttname"><a href="group__adaptive__inflate.html#gabc7fca9bfb048d5f738b3da299e18765">adaptive_inflate_mod::enhanced_ss_inflation</a></div><div class="ttdeci">integer, parameter, public enhanced_ss_inflation</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00066">adaptive_inflate_mod.f90:66</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_gabcdf2fa88b452f8772a4812d1696b2fb"><div class="ttname"><a href="group__adaptive__inflate.html#gabcdf2fa88b452f8772a4812d1696b2fb">adaptive_inflate_mod::get_minmax_task_zero</a></div><div class="ttdeci">subroutine, public get_minmax_task_zero(inflation_handle, ens_handle, ss_inflate_index, ss_inflate_sd_index)</div><div class="ttdoc">Collect the min and max of inflation on task 0 this block handles communicating the min/max local val...</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l01441">adaptive_inflate_mod.f90:1443</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_gae3900d28b408cedd58072e5b5d9515a7"><div class="ttname"><a href="group__adaptive__inflate.html#gae3900d28b408cedd58072e5b5d9515a7">adaptive_inflate_mod::sd_from_restart</a></div><div class="ttdeci">logical function, public sd_from_restart(inflation)</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00123">adaptive_inflate_mod.f90:124</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_gaec84d7ffa9da5dbcbd5226e8f8786ba6"><div class="ttname"><a href="group__adaptive__inflate.html#gaec84d7ffa9da5dbcbd5226e8f8786ba6">adaptive_inflate_mod::varying_ss_inflation</a></div><div class="ttdeci">integer, parameter, public varying_ss_inflation</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00063">adaptive_inflate_mod.f90:63</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_gaf8861082a4e0deb56ae02bda79e45dbe"><div class="ttname"><a href="group__adaptive__inflate.html#gaf8861082a4e0deb56ae02bda79e45dbe">adaptive_inflate_mod::single_ss_inflation</a></div><div class="ttdeci">integer, parameter, public single_ss_inflation</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00064">adaptive_inflate_mod.f90:64</a></div></div>
<div class="ttc" id="agroup__adaptive__inflate_html_gaf9ad03b403779b745244bc055e04c6fc"><div class="ttname"><a href="group__adaptive__inflate.html#gaf9ad03b403779b745244bc055e04c6fc">adaptive_inflate_mod::log_inflation_info</a></div><div class="ttdeci">subroutine, public log_inflation_info(inflation_handle, mype, label, single_file)</div><div class="ttdoc">Write to log file what kind of inflation is being used.</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l01268">adaptive_inflate_mod.f90:1269</a></div></div>
<div class="ttc" id="agroup__assim__tools_html_ga593869155163638696fb5a3f593a79b4"><div class="ttname"><a href="group__assim__tools.html#ga593869155163638696fb5a3f593a79b4">assim_tools_mod::filter_assim</a></div><div class="ttdeci">subroutine, public filter_assim(ens_handle, obs_ens_handle, obs_seq, keys, ens_size, num_groups, obs_val_index, inflate, ens_mean_copy, ens_sd_copy, ens_inf_copy, ens_inf_sd_copy, obs_key_copy, obs_global_qc_copy, obs_prior_mean_start, obs_prior_mean_end, obs_prior_var_start, obs_prior_var_end, inflate_only)</div><div class="ttdef"><b>Definition</b> <a href="assim__tools__mod_8f90_source.html#l00305">assim_tools_mod.f90:310</a></div></div>
<div class="ttc" id="agroup__assim__tools_html_gac278264f661864a82a6e3ccdace43d54"><div class="ttname"><a href="group__assim__tools.html#gac278264f661864a82a6e3ccdace43d54">assim_tools_mod::test_state_copies</a></div><div class="ttdeci">subroutine, public test_state_copies(state_ens_handle, information)</div><div class="ttdoc">dump out the copies array for the state ens handle</div><div class="ttdef"><b>Definition</b> <a href="assim__tools__mod_8f90_source.html#l02535">assim_tools_mod.f90:2536</a></div></div>
<div class="ttc" id="agroup__assim__tools_html_gae6a5cb9fd7c12f32393a170017220a72"><div class="ttname"><a href="group__assim__tools.html#gae6a5cb9fd7c12f32393a170017220a72">assim_tools_mod::set_assim_tools_trace</a></div><div class="ttdeci">subroutine, public set_assim_tools_trace(execution_level, timestamp_level)</div><div class="ttdef"><b>Definition</b> <a href="assim__tools__mod_8f90_source.html#l02079">assim_tools_mod.f90:2080</a></div></div>
<div class="ttc" id="agroup__direct__netcdf__mod_html_ga4db4441591f610b3e2c4d06480c28535"><div class="ttname"><a href="group__direct__netcdf__mod.html#ga4db4441591f610b3e2c4d06480c28535">direct_netcdf_mod::write_augmented_state</a></div><div class="ttdeci">subroutine, public write_augmented_state(ens_handle, file_handle)</div><div class="ttdoc">insert the mean and sd into the input file if the user requests this assumes that the files has alrea...</div><div class="ttdef"><b>Definition</b> <a href="direct__netcdf__mod_8f90_source.html#l00751">direct_netcdf_mod.f90:752</a></div></div>
<div class="ttc" id="agroup__direct__netcdf__mod_html_ga5da57561c4275530367b53a116303f9f"><div class="ttname"><a href="group__direct__netcdf__mod.html#ga5da57561c4275530367b53a116303f9f">direct_netcdf_mod::finalize_single_file_io</a></div><div class="ttdeci">subroutine, public finalize_single_file_io(file_handle)</div><div class="ttdef"><b>Definition</b> <a href="direct__netcdf__mod_8f90_source.html#l00445">direct_netcdf_mod.f90:446</a></div></div>
<div class="ttc" id="agroup__direct__netcdf__mod_html_gafb7b451fc6de3f86bffb169fa700f668"><div class="ttname"><a href="group__direct__netcdf__mod.html#gafb7b451fc6de3f86bffb169fa700f668">direct_netcdf_mod::nc_get_num_times</a></div><div class="ttdeci">integer function, public nc_get_num_times(fname)</div><div class="ttdef"><b>Definition</b> <a href="direct__netcdf__mod_8f90_source.html#l02966">direct_netcdf_mod.f90:2967</a></div></div>
<div class="ttc" id="agroup__io__filenames__mod_html_ga0136923a3644e55ac4ddf7216026fbcd"><div class="ttname"><a href="group__io__filenames__mod.html#ga0136923a3644e55ac4ddf7216026fbcd">io_filenames_mod::combine_file_info</a></div><div class="ttdeci">type(file_info_type) function, public combine_file_info(file_info_array)</div><div class="ttdoc">Combine multiple file_info_type into a single file_info.</div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00930">io_filenames_mod.f90:931</a></div></div>
<div class="ttc" id="agroup__io__filenames__mod_html_ga29f2ee6ce9ec4ffb32c45586e7208e1c"><div class="ttname"><a href="group__io__filenames__mod.html#ga29f2ee6ce9ec4ffb32c45586e7208e1c">io_filenames_mod::io_filenames_init</a></div><div class="ttdeci">subroutine, public io_filenames_init(file_info, ncopies, cycling, single_file, restart_files, root_name, check_output_compatibility)</div><div class="ttdoc">Initialize file_info type.</div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00268">io_filenames_mod.f90:270</a></div></div>
<div class="ttc" id="agroup__io__filenames__mod_html_ga519831c8d731b5b4fcc2b2d54cf54e1f"><div class="ttname"><a href="group__io__filenames__mod.html#ga519831c8d731b5b4fcc2b2d54cf54e1f">io_filenames_mod::read_write_copy</a></div><div class="ttdeci">integer, parameter, public read_write_copy</div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00124">io_filenames_mod.f90:124</a></div></div>
<div class="ttc" id="agroup__io__filenames__mod_html_ga65ddf8bef1363ac565c87fbe776abfe2"><div class="ttname"><a href="group__io__filenames__mod.html#ga65ddf8bef1363ac565c87fbe776abfe2">io_filenames_mod::query_copy_present</a></div><div class="ttdeci">logical function, public query_copy_present(copy)</div><div class="ttdoc">Test whether a copy is part of the ensemble.</div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l01138">io_filenames_mod.f90:1139</a></div></div>
<div class="ttc" id="agroup__io__filenames__mod_html_ga70cbfa7f0895d3a51ed17ebc7fea96fa"><div class="ttname"><a href="group__io__filenames__mod.html#ga70cbfa7f0895d3a51ed17ebc7fea96fa">io_filenames_mod::set_member_file_metadata</a></div><div class="ttdeci">subroutine, public set_member_file_metadata(file_info, ens_size, my_copy_start)</div><div class="ttdoc">read file list names</div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00353">io_filenames_mod.f90:354</a></div></div>
<div class="ttc" id="agroup__io__filenames__mod_html_ga84a5562fae8dc096e6b2330ad8da4bbf"><div class="ttname"><a href="group__io__filenames__mod.html#ga84a5562fae8dc096e6b2330ad8da4bbf">io_filenames_mod::check_file_info_variable_shape</a></div><div class="ttdeci">subroutine, public check_file_info_variable_shape(file_info, ens_handle)</div><div class="ttdoc">Check that the netcdf files variables have the correct shape to prevevent overwriting unwanted files.</div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00327">io_filenames_mod.f90:328</a></div></div>
<div class="ttc" id="agroup__io__filenames__mod_html_ga931e77da21e002703282c7662cb77f47"><div class="ttname"><a href="group__io__filenames__mod.html#ga931e77da21e002703282c7662cb77f47">io_filenames_mod::force_copy_back</a></div><div class="ttdeci">logical function, public force_copy_back(name_handle, copy)</div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l01079">io_filenames_mod.f90:1080</a></div></div>
<div class="ttc" id="agroup__io__filenames__mod_html_ga9d485684d292c23c26fae49cb2ba5796"><div class="ttname"><a href="group__io__filenames__mod.html#ga9d485684d292c23c26fae49cb2ba5796">io_filenames_mod::write_copy</a></div><div class="ttdeci">integer, parameter, public write_copy</div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00123">io_filenames_mod.f90:123</a></div></div>
<div class="ttc" id="agroup__io__filenames__mod_html_gaabee83c19c0348d7e3aa7009c1b4411a"><div class="ttname"><a href="group__io__filenames__mod.html#gaabee83c19c0348d7e3aa7009c1b4411a">io_filenames_mod::copy_not_present</a></div><div class="ttdeci">integer, parameter, public copy_not_present</div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00127">io_filenames_mod.f90:127</a></div></div>
<div class="ttc" id="agroup__io__filenames__mod_html_gaae140d2c2c3279b00cf73e97268b14e9"><div class="ttname"><a href="group__io__filenames__mod.html#gaae140d2c2c3279b00cf73e97268b14e9">io_filenames_mod::read_copy</a></div><div class="ttdeci">integer, parameter, public read_copy</div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00122">io_filenames_mod.f90:122</a></div></div>
<div class="ttc" id="agroup__state__structure__mod_html_gad2bdf8059dbbe43bc0a3a3d3c875a0bb"><div class="ttname"><a href="group__state__structure__mod.html#gad2bdf8059dbbe43bc0a3a3d3c875a0bb">state_structure_mod::get_num_domains</a></div><div class="ttdeci">integer function, public get_num_domains()</div><div class="ttdoc">Returns the number of domains being used in the state structure.</div><div class="ttdef"><b>Definition</b> <a href="state__structure__mod_8f90_source.html#l01024">state_structure_mod.f90:1025</a></div></div>
<div class="ttc" id="agroup__state__vector__io__mod_html_ga2cf6bb0500d00f01633c84ba7fc0be63"><div class="ttname"><a href="group__state__vector__io__mod.html#ga2cf6bb0500d00f01633c84ba7fc0be63">state_vector_io_mod::read_state</a></div><div class="ttdeci">subroutine, public read_state(state_ens_handle, file_info, read_time_from_file, model_time, prior_inflate_handle, post_inflate_handle, perturb_from_single_copy)</div><div class="ttdoc">Read in the state vectors into an ensemble handle The copies will end up in the state_ens_handlecopie...</div><div class="ttdef"><b>Definition</b> <a href="state__vector__io__mod_8f90_source.html#l00160">state_vector_io_mod.f90:162</a></div></div>
<div class="ttc" id="agroup__state__vector__io__mod_html_gaa022725c0fb4622a7ee3cc13eb92a2aa"><div class="ttname"><a href="group__state__vector__io__mod.html#gaa022725c0fb4622a7ee3cc13eb92a2aa">state_vector_io_mod::state_vector_io_init</a></div><div class="ttdeci">subroutine, public state_vector_io_init()</div><div class="ttdoc">Initialize module and read the namelist.</div><div class="ttdef"><b>Definition</b> <a href="state__vector__io__mod_8f90_source.html#l00125">state_vector_io_mod.f90:126</a></div></div>
<div class="ttc" id="agroup__state__vector__io__mod_html_gaa80af78515963bcd545f18c9349e8c87"><div class="ttname"><a href="group__state__vector__io__mod.html#gaa80af78515963bcd545f18c9349e8c87">state_vector_io_mod::set_stage_to_write</a></div><div class="ttdeci">subroutine, public set_stage_to_write(stage_name_in, output_stage)</div><div class="ttdoc">set stage names</div><div class="ttdef"><b>Definition</b> <a href="state__vector__io__mod_8f90_source.html#l00502">state_vector_io_mod.f90:503</a></div></div>
<div class="ttc" id="agroup__state__vector__io__mod_html_gab0cd1b1a5e523fff63e58b5e32aa137f"><div class="ttname"><a href="group__state__vector__io__mod.html#gab0cd1b1a5e523fff63e58b5e32aa137f">state_vector_io_mod::write_state</a></div><div class="ttdeci">subroutine, public write_state(state_ens_handle, file_info)</div><div class="ttdoc">Write state vectors from an ensemble_handle The inflation handles are options (used by filter,...</div><div class="ttdef"><b>Definition</b> <a href="state__vector__io__mod_8f90_source.html#l00231">state_vector_io_mod.f90:232</a></div></div>
<div class="ttc" id="agroup__state__vector__io__mod_html_gaedcbb3a5ea01247eb5df8269ce00d4af"><div class="ttname"><a href="group__state__vector__io__mod.html#gaedcbb3a5ea01247eb5df8269ce00d4af">state_vector_io_mod::get_stage_to_write</a></div><div class="ttdeci">logical function, public get_stage_to_write(stage_name_in)</div><div class="ttdoc">set stage names</div><div class="ttdef"><b>Definition</b> <a href="state__vector__io__mod_8f90_source.html#l00520">state_vector_io_mod.f90:521</a></div></div>
<div class="ttc" id="ainterfaceio__filenames__mod_1_1set__file__metadata_html"><div class="ttname"><a href="interfaceio__filenames__mod_1_1set__file__metadata.html">io_filenames_mod::set_file_metadata</a></div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00071">io_filenames_mod.f90:71</a></div></div>
<div class="ttc" id="ainterfaceio__filenames__mod_1_1set__io__copy__flag_html"><div class="ttname"><a href="interfaceio__filenames__mod_1_1set__io__copy__flag.html">io_filenames_mod::set_io_copy_flag</a></div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00066">io_filenames_mod.f90:66</a></div></div>
<div class="ttc" id="anamespaceadaptive__inflate__mod_html"><div class="ttname"><a href="namespaceadaptive__inflate__mod.html">adaptive_inflate_mod</a></div><div class="ttdoc">Operations and storage required for various adaptive inflation algorithms.</div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00007">adaptive_inflate_mod.f90:7</a></div></div>
<div class="ttc" id="anamespacealgorithm__info__mod_html"><div class="ttname"><a href="namespacealgorithm__info__mod.html">algorithm_info_mod</a></div><div class="ttdef"><b>Definition</b> <a href="algorithm__info__mod_8f90_source.html#l00005">algorithm_info_mod.f90:5</a></div></div>
<div class="ttc" id="anamespacealgorithm__info__mod_html_a3d99ad78a28fe88d7430ed7a308c5d05"><div class="ttname"><a href="namespacealgorithm__info__mod.html#a3d99ad78a28fe88d7430ed7a308c5d05">algorithm_info_mod::probit_dist_info</a></div><div class="ttdeci">subroutine, public probit_dist_info(qty, is_state, is_inflation, dist_type, bounded_below, bounded_above, lower_bound, upper_bound)</div><div class="ttdef"><b>Definition</b> <a href="algorithm__info__mod_8f90_source.html#l00366">algorithm_info_mod.f90:368</a></div></div>
<div class="ttc" id="anamespacealgorithm__info__mod_html_ac3aa86f6c6131c861fe87798b65ebf4b"><div class="ttname"><a href="namespacealgorithm__info__mod.html#ac3aa86f6c6131c861fe87798b65ebf4b">algorithm_info_mod::init_algorithm_info_mod</a></div><div class="ttdeci">subroutine, public init_algorithm_info_mod()</div><div class="ttdef"><b>Definition</b> <a href="algorithm__info__mod_8f90_source.html#l00110">algorithm_info_mod.f90:111</a></div></div>
<div class="ttc" id="anamespacealgorithm__info__mod_html_aceea3ca8de97dd02da91db543102682a"><div class="ttname"><a href="namespacealgorithm__info__mod.html#aceea3ca8de97dd02da91db543102682a">algorithm_info_mod::end_algorithm_info_mod</a></div><div class="ttdeci">subroutine, public end_algorithm_info_mod()</div><div class="ttdef"><b>Definition</b> <a href="algorithm__info__mod_8f90_source.html#l00606">algorithm_info_mod.f90:607</a></div></div>
<div class="ttc" id="anamespaceassim__model__mod_html"><div class="ttname"><a href="namespaceassim__model__mod.html">assim_model_mod</a></div><div class="ttdoc">This module is used to wrap around the basic portions of existing dynamical models to add capabilitie...</div><div class="ttdef"><b>Definition</b> <a href="assim__model__mod_8f90_source.html#l00011">assim_model_mod.f90:11</a></div></div>
<div class="ttc" id="anamespaceassim__model__mod_html_a85453749da1f84414285aa89f143bfc6"><div class="ttname"><a href="namespaceassim__model__mod.html#a85453749da1f84414285aa89f143bfc6">assim_model_mod::static_init_assim_model</a></div><div class="ttdeci">subroutine, public static_init_assim_model()</div><div class="ttdef"><b>Definition</b> <a href="assim__model__mod_8f90_source.html#l00061">assim_model_mod.f90:62</a></div></div>
<div class="ttc" id="anamespaceassim__model__mod_html_aaaf9136986343075c66fc81616b24c43"><div class="ttname"><a href="namespaceassim__model__mod.html#aaaf9136986343075c66fc81616b24c43">assim_model_mod::end_assim_model</a></div><div class="ttdeci">subroutine, public end_assim_model()</div><div class="ttdef"><b>Definition</b> <a href="assim__model__mod_8f90_source.html#l00129">assim_model_mod.f90:130</a></div></div>
<div class="ttc" id="anamespaceassim__tools__mod_html"><div class="ttname"><a href="namespaceassim__tools__mod.html">assim_tools_mod</a></div><div class="ttdoc">A variety of operations required by assimilation.</div><div class="ttdef"><b>Definition</b> <a href="assim__tools__mod_8f90_source.html#l00006">assim_tools_mod.f90:6</a></div></div>
<div class="ttc" id="anamespacedirect__netcdf__mod_html"><div class="ttname"><a href="namespacedirect__netcdf__mod.html">direct_netcdf_mod</a></div><div class="ttdef"><b>Definition</b> <a href="direct__netcdf__mod_8f90_source.html#l00005">direct_netcdf_mod.f90:5</a></div></div>
<div class="ttc" id="anamespacedistribution__params__mod_html"><div class="ttname"><a href="namespacedistribution__params__mod.html">distribution_params_mod</a></div><div class="ttdef"><b>Definition</b> <a href="distribution__params__mod_8f90_source.html#l00001">distribution_params_mod.f90:1</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html"><div class="ttname"><a href="namespaceensemble__manager__mod.html">ensemble_manager_mod</a></div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00005">ensemble_manager_mod.f90:5</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a0b1af28e9b02fa19a22a44815e6994be"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a0b1af28e9b02fa19a22a44815e6994be">ensemble_manager_mod::allocate_single_copy</a></div><div class="ttdeci">subroutine, public allocate_single_copy(ens_handle, x)</div><div class="ttdoc">allocate enough space to an allocatable array to hold a single copy requires the ens_handle be copy-c...</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l01684">ensemble_manager_mod.f90:1685</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a0f0832a7c5cabfb5291cf174adcd6b0a"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a0f0832a7c5cabfb5291cf174adcd6b0a">ensemble_manager_mod::compute_copy_mean_sd</a></div><div class="ttdeci">subroutine, public compute_copy_mean_sd(ens_handle, start_copy, end_copy, mean_copy, sd_copy)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l01269">ensemble_manager_mod.f90:1270</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a0fabb5d192d3b09305b5e5e25f3cc39f"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a0fabb5d192d3b09305b5e5e25f3cc39f">ensemble_manager_mod::compute_copy_mean</a></div><div class="ttdeci">subroutine, public compute_copy_mean(ens_handle, start_copy, end_copy, mean_copy)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l01242">ensemble_manager_mod.f90:1243</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a0ff9b71c42eb5e4c87d60428d4edd0db"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a0ff9b71c42eb5e4c87d60428d4edd0db">ensemble_manager_mod::duplicate_ens</a></div><div class="ttdeci">subroutine, public duplicate_ens(ens1, ens2, duplicate_time)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00469">ensemble_manager_mod.f90:470</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a13c0b50b0f720b889565d4f7c69fa619"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a13c0b50b0f720b889565d4f7c69fa619">ensemble_manager_mod::deallocate_single_copy</a></div><div class="ttdeci">subroutine, public deallocate_single_copy(ens_handle, x)</div><div class="ttdoc">cleanup routine</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l01721">ensemble_manager_mod.f90:1722</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a1500b736b8e9992f705b2c5af3870172"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a1500b736b8e9992f705b2c5af3870172">ensemble_manager_mod::get_ensemble_time</a></div><div class="ttdeci">subroutine, public get_ensemble_time(ens_handle, indx, mtime)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00434">ensemble_manager_mod.f90:435</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a1c8d13ec99a69a57f877b584b59d993e"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a1c8d13ec99a69a57f877b584b59d993e">ensemble_manager_mod::print_ens_handle</a></div><div class="ttdeci">subroutine, public print_ens_handle(ens_handle, force, label, contents, limit)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l01378">ensemble_manager_mod.f90:1379</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a2974e8f65e2455080e426fb9ae228c13"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a2974e8f65e2455080e426fb9ae228c13">ensemble_manager_mod::get_my_num_copies</a></div><div class="ttdeci">integer function, public get_my_num_copies(ens_handle)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00508">ensemble_manager_mod.f90:509</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a50a52ae3fca66fdf6cdc3494cff26e65"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a50a52ae3fca66fdf6cdc3494cff26e65">ensemble_manager_mod::put_copy</a></div><div class="ttdeci">subroutine, public put_copy(sending_pe, ens_handle, copy, vars, mtime)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00315">ensemble_manager_mod.f90:316</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a560cdc48f932d328a341116abe462455"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a560cdc48f932d328a341116abe462455">ensemble_manager_mod::all_vars_to_all_copies</a></div><div class="ttdeci">subroutine, public all_vars_to_all_copies(ens_handle, label)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00903">ensemble_manager_mod.f90:904</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a6dba0cf88e6588f7c50b999e0242871b"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a6dba0cf88e6588f7c50b999e0242871b">ensemble_manager_mod::set_ensemble_time</a></div><div class="ttdeci">subroutine, public set_ensemble_time(ens_handle, indx, mtime)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00415">ensemble_manager_mod.f90:416</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a77071efdef7cc8ea113667122f8a86ef"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a77071efdef7cc8ea113667122f8a86ef">ensemble_manager_mod::get_copy_owner_index</a></div><div class="ttdeci">subroutine, public get_copy_owner_index(ens_handle, copy_number, owner, owners_index)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00656">ensemble_manager_mod.f90:657</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a79ff62ccd778cc3782b91291991bbf1c"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a79ff62ccd778cc3782b91291991bbf1c">ensemble_manager_mod::get_single_copy</a></div><div class="ttdeci">subroutine, public get_single_copy(ens_handle, copy, x)</div><div class="ttdoc">get the data from the ensemble handle for this single copy number requires the ens_handle be copy-com...</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l01696">ensemble_manager_mod.f90:1697</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a8484d5e765733567bfc5fc3ac349926c"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a8484d5e765733567bfc5fc3ac349926c">ensemble_manager_mod::broadcast_copy</a></div><div class="ttdeci">subroutine, public broadcast_copy(ens_handle, copy, arraydata)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00376">ensemble_manager_mod.f90:377</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a8e433f241a2a14ca4f6034f70ebe7cc9"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a8e433f241a2a14ca4f6034f70ebe7cc9">ensemble_manager_mod::init_ensemble_manager</a></div><div class="ttdeci">subroutine, public init_ensemble_manager(ens_handle, num_copies, num_vars, distribution_type_in, layout_type, transpose_type_in)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00124">ensemble_manager_mod.f90:126</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a9c12d5753063f93c6e6981ddd4960a99"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a9c12d5753063f93c6e6981ddd4960a99">ensemble_manager_mod::copies_in_window</a></div><div class="ttdeci">integer function, public copies_in_window(ens_handle)</div><div class="ttdoc">return the number of actual ensemble members (not extra copies)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00846">ensemble_manager_mod.f90:847</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_a9f35904acaa6d026fc5d004a23104e23"><div class="ttname"><a href="namespaceensemble__manager__mod.html#a9f35904acaa6d026fc5d004a23104e23">ensemble_manager_mod::set_num_extra_copies</a></div><div class="ttdeci">subroutine, public set_num_extra_copies(ens_handle, n)</div><div class="ttdoc">Aim: allow filter to set the number of extra copies in this module This is necessary for copies_in_wi...</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00889">ensemble_manager_mod.f90:890</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_abc9c33415ca313004a2385fbc7b6b5cb"><div class="ttname"><a href="namespaceensemble__manager__mod.html#abc9c33415ca313004a2385fbc7b6b5cb">ensemble_manager_mod::compute_copy_mean_var</a></div><div class="ttdeci">subroutine, public compute_copy_mean_var(ens_handle, start_copy, end_copy, mean_copy, var_copy)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l01304">ensemble_manager_mod.f90:1305</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_acd680bca47a44ef5b88a7beff4843816"><div class="ttname"><a href="namespaceensemble__manager__mod.html#acd680bca47a44ef5b88a7beff4843816">ensemble_manager_mod::map_pe_to_task</a></div><div class="ttdeci">integer function, public map_pe_to_task(ens_handle, p)</div><div class="ttdoc">Return the physical task for my_pe.</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00834">ensemble_manager_mod.f90:835</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_ad50c046a15db7895115f472f56cecf2e"><div class="ttname"><a href="namespaceensemble__manager__mod.html#ad50c046a15db7895115f472f56cecf2e">ensemble_manager_mod::get_allow_transpose</a></div><div class="ttdeci">logical function, public get_allow_transpose(ens_handle)</div><div class="ttdoc">accessor function</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00819">ensemble_manager_mod.f90:820</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_ad77490836a39d93bafc07d1130b15d03"><div class="ttname"><a href="namespaceensemble__manager__mod.html#ad77490836a39d93bafc07d1130b15d03">ensemble_manager_mod::all_copies_to_all_vars</a></div><div class="ttdeci">subroutine, public all_copies_to_all_vars(ens_handle, label)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l01067">ensemble_manager_mod.f90:1068</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_adf4c59fd6a11b63ca3b348f09b860a16"><div class="ttname"><a href="namespaceensemble__manager__mod.html#adf4c59fd6a11b63ca3b348f09b860a16">ensemble_manager_mod::put_single_copy</a></div><div class="ttdeci">subroutine, public put_single_copy(ens_handle, copy, x)</div><div class="ttdoc">put the data from an array into the ensemble handle for this single copy number requires the ens_hand...</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l01709">ensemble_manager_mod.f90:1710</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_ae290ccc4e130e2cc3280aff6a920eae5"><div class="ttname"><a href="namespaceensemble__manager__mod.html#ae290ccc4e130e2cc3280aff6a920eae5">ensemble_manager_mod::allocate_vars</a></div><div class="ttdeci">subroutine, public allocate_vars(ens_handle)</div><div class="ttdoc">if allow_transpose is ok, allocate the vars if they aren't already allocated, error out if allow_tran...</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l01646">ensemble_manager_mod.f90:1647</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_af5913d365d22029f1cb212eabb965833"><div class="ttname"><a href="namespaceensemble__manager__mod.html#af5913d365d22029f1cb212eabb965833">ensemble_manager_mod::end_ensemble_manager</a></div><div class="ttdeci">subroutine, public end_ensemble_manager(ens_handle)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00453">ensemble_manager_mod.f90:454</a></div></div>
<div class="ttc" id="anamespaceensemble__manager__mod_html_afeab8324b47d0683e6156f466d78ae63"><div class="ttname"><a href="namespaceensemble__manager__mod.html#afeab8324b47d0683e6156f466d78ae63">ensemble_manager_mod::get_copy</a></div><div class="ttdeci">subroutine, public get_copy(receiving_pe, ens_handle, copy, vars, mtime)</div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00246">ensemble_manager_mod.f90:247</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html"><div class="ttname"><a href="namespacefilter__mod.html">filter_mod</a></div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00005">filter_mod.f90:5</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a00df25fc105cbd47c3275cdf0fde6150"><div class="ttname"><a href="namespacefilter__mod.html#a00df25fc105cbd47c3275cdf0fde6150">filter_mod::ens_sd</a></div><div class="ttdeci">integer, parameter ens_sd</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00123">filter_mod.f90:123</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a015eadf785bd049f7206906db314cb39"><div class="ttname"><a href="namespacefilter__mod.html#a015eadf785bd049f7206906db314cb39">filter_mod::get_obs_qc_index</a></div><div class="ttdeci">integer function get_obs_qc_index(seq)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01439">filter_mod.f90:1440</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a01bd6b2eba904d41a35c868fd2ec1c13"><div class="ttname"><a href="namespacefilter__mod.html#a01bd6b2eba904d41a35c868fd2ec1c13">filter_mod::parse_stages_to_write</a></div><div class="ttdeci">subroutine parse_stages_to_write(stages)</div><div class="ttdoc">checks the user input and informs the IO modules which files to write.</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02533">filter_mod.f90:2534</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a03faf9e8afe7f8f8daa826f225c936b4"><div class="ttname"><a href="namespacefilter__mod.html#a03faf9e8afe7f8f8daa826f225c936b4">filter_mod::adv_ens_command</a></div><div class="ttdeci">character(len=256) adv_ens_command</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00234">filter_mod.f90:234</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a04a8050c9f7bf5f2662a066da69ecc60"><div class="ttname"><a href="namespacefilter__mod.html#a04a8050c9f7bf5f2662a066da69ecc60">filter_mod::prior_inf_copy</a></div><div class="ttdeci">integer prior_inf_copy</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00137">filter_mod.f90:137</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a0634f9f751bb949d0a3f550ff2417027"><div class="ttname"><a href="namespacefilter__mod.html#a0634f9f751bb949d0a3f550ff2417027">filter_mod::write_all_stages_at_end</a></div><div class="ttdeci">logical write_all_stages_at_end</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00232">filter_mod.f90:232</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a06e8cc5ba3cc19ea12309e3e787f91ac"><div class="ttname"><a href="namespacefilter__mod.html#a06e8cc5ba3cc19ea12309e3e787f91ac">filter_mod::mem_start</a></div><div class="ttdeci">integer, parameter mem_start</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00120">filter_mod.f90:120</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a0a62226d734bdac0c4382ccb5b40cb32"><div class="ttname"><a href="namespacefilter__mod.html#a0a62226d734bdac0c4382ccb5b40cb32">filter_mod::obs_space_sync_qcs</a></div><div class="ttdeci">subroutine obs_space_sync_qcs(obs_fwd_op_ens_handle, seq, keys, num_obs_in_set, obs_global_qc_copy, dart_qc_index)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01729">filter_mod.f90:1731</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a0b2b5a18e2e9bb9f93959e89ea9442fa"><div class="ttname"><a href="namespacefilter__mod.html#a0b2b5a18e2e9bb9f93959e89ea9442fa">filter_mod::prior_inflate</a></div><div class="ttdeci">type(adaptive_inflate_type) prior_inflate</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00155">filter_mod.f90:155</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a0e052301e8e06be3c37a1a48a908dc6e"><div class="ttname"><a href="namespacefilter__mod.html#a0e052301e8e06be3c37a1a48a908dc6e">filter_mod::inf_sd_max_change</a></div><div class="ttdeci">real(r8), dimension(2) inf_sd_max_change</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00248">filter_mod.f90:248</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a0e0c767617e4028736a0fb444c3542a1"><div class="ttname"><a href="namespacefilter__mod.html#a0e0c767617e4028736a0fb444c3542a1">filter_mod::input_copies</a></div><div class="ttdeci">integer, dimension(num_scopies) input_copies</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00142">filter_mod.f90:142</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a0ff0be69ea73156970fbb804687c8a60"><div class="ttname"><a href="namespacefilter__mod.html#a0ff0be69ea73156970fbb804687c8a60">filter_mod::filter_setup_obs_sequence</a></div><div class="ttdeci">subroutine filter_setup_obs_sequence(seq, in_obs_copy, obs_val_index, input_qc_index, dart_qc_index, do_post)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01283">filter_mod.f90:1285</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a12f0243b9f8139a944865f8ce704247c"><div class="ttname"><a href="namespacefilter__mod.html#a12f0243b9f8139a944865f8ce704247c">filter_mod::async</a></div><div class="ttdeci">integer async</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00168">filter_mod.f90:168</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a1499811bfa0bdd513ba632ec0aeb60f1"><div class="ttname"><a href="namespacefilter__mod.html#a1499811bfa0bdd513ba632ec0aeb60f1">filter_mod::prior_inf_sd_copy</a></div><div class="ttdeci">integer prior_inf_sd_copy</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00138">filter_mod.f90:138</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a18dfcddac920a8f061dabcb6bb209896"><div class="ttname"><a href="namespacefilter__mod.html#a18dfcddac920a8f061dabcb6bb209896">filter_mod::filter_generate_copy_meta_data</a></div><div class="ttdeci">subroutine filter_generate_copy_meta_data(seq, in_obs_copy, prior_obs_mean_index, posterior_obs_mean_index, prior_obs_spread_index, posterior_obs_spread_index, do_post)</div><div class="ttdoc">This generates the copy meta data for the diagnostic files. And also creates the state space diagnost...</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01173">filter_mod.f90:1177</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a1a06628fdb3e51bc068347aad285730a"><div class="ttname"><a href="namespacefilter__mod.html#a1a06628fdb3e51bc068347aad285730a">filter_mod::inf_flavor</a></div><div class="ttdeci">integer, dimension(2) inf_flavor</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00242">filter_mod.f90:242</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a1d29faddb7d7f0f640f15c6a9e39b38b"><div class="ttname"><a href="namespacefilter__mod.html#a1d29faddb7d7f0f640f15c6a9e39b38b">filter_mod::forecast_copies</a></div><div class="ttdeci">integer, dimension(num_scopies) forecast_copies</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00145">filter_mod.f90:145</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a1fa8e21f160e9d2dfb2618ff99b840c4"><div class="ttname"><a href="namespacefilter__mod.html#a1fa8e21f160e9d2dfb2618ff99b840c4">filter_mod::inf_sd_initial</a></div><div class="ttdeci">real(r8), dimension(2) inf_sd_initial</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00247">filter_mod.f90:247</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a24a32282421d3c0070cb5f54e05ea81d"><div class="ttname"><a href="namespacefilter__mod.html#a24a32282421d3c0070cb5f54e05ea81d">filter_mod::inf_deterministic</a></div><div class="ttdeci">logical, dimension(2) inf_deterministic</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00245">filter_mod.f90:245</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a27e9b289aac5155c54ec925951569906"><div class="ttname"><a href="namespacefilter__mod.html#a27e9b289aac5155c54ec925951569906">filter_mod::set_trace</a></div><div class="ttdeci">subroutine set_trace(trace_execution, output_timestamps, silence)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01853">filter_mod.f90:1854</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a29d20310501029db7a1c0444e07498c8"><div class="ttname"><a href="namespacefilter__mod.html#a29d20310501029db7a1c0444e07498c8">filter_mod::filter_sync_keys_time</a></div><div class="ttdeci">subroutine, public filter_sync_keys_time(ens_handle, key_bounds, num_obs_in_set, time1, time2)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01775">filter_mod.f90:1776</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a2a8aaf06161e0c132e0a86f19ff02f0b"><div class="ttname"><a href="namespacefilter__mod.html#a2a8aaf06161e0c132e0a86f19ff02f0b">filter_mod::inf_lower_bound</a></div><div class="ttdeci">real(r8), dimension(2) inf_lower_bound</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00250">filter_mod.f90:250</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a2e635d221f9df63c2e45a0404c77b542"><div class="ttname"><a href="namespacefilter__mod.html#a2e635d221f9df63c2e45a0404c77b542">filter_mod::num_output_state_members</a></div><div class="ttdeci">integer num_output_state_members</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00184">filter_mod.f90:184</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a2e6d996cd39b3f4929f0085c751e6950"><div class="ttname"><a href="namespacefilter__mod.html#a2e6d996cd39b3f4929f0085c751e6950">filter_mod::silence</a></div><div class="ttdeci">logical silence</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00192">filter_mod.f90:192</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a2fdebad08ae532c16952e316b6f9e1c7"><div class="ttname"><a href="namespacefilter__mod.html#a2fdebad08ae532c16952e316b6f9e1c7">filter_mod::single_file_out</a></div><div class="ttdeci">logical single_file_out</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00211">filter_mod.f90:211</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a317b51268d909d4934f51b732df4531c"><div class="ttname"><a href="namespacefilter__mod.html#a317b51268d909d4934f51b732df4531c">filter_mod::output_state_file_list</a></div><div class="ttdeci">character(len=256), dimension(max_num_doms) output_state_file_list</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00203">filter_mod.f90:203</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a349103b2b5767dd7dad2bc4a2d32cd0f"><div class="ttname"><a href="namespacefilter__mod.html#a349103b2b5767dd7dad2bc4a2d32cd0f">filter_mod::trace_execution</a></div><div class="ttdeci">logical trace_execution</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00190">filter_mod.f90:190</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a34bfafb5e98fec24b32f651f7996a59f"><div class="ttname"><a href="namespacefilter__mod.html#a34bfafb5e98fec24b32f651f7996a59f">filter_mod::output_mean</a></div><div class="ttdeci">logical output_mean</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00230">filter_mod.f90:230</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a37200a7c9ffa29cfe45242f45600f38e"><div class="ttname"><a href="namespacefilter__mod.html#a37200a7c9ffa29cfe45242f45600f38e">filter_mod::num_output_obs_members</a></div><div class="ttdeci">integer num_output_obs_members</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00185">filter_mod.f90:185</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a3784b41754c7c894fc931b34344b4dc2"><div class="ttname"><a href="namespacefilter__mod.html#a3784b41754c7c894fc931b34344b4dc2">filter_mod::t_after</a></div><div class="ttdeci">integer, parameter t_after</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00161">filter_mod.f90:161</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a38ed5812756013876b9a3fb4319d1ec5"><div class="ttname"><a href="namespacefilter__mod.html#a38ed5812756013876b9a3fb4319d1ec5">filter_mod::analysis_copies</a></div><div class="ttdeci">integer, dimension(num_scopies) analysis_copies</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00148">filter_mod.f90:148</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a40d30bf4dd881d3b72955859d9741cdf"><div class="ttname"><a href="namespacefilter__mod.html#a40d30bf4dd881d3b72955859d9741cdf">filter_mod::num_scopies</a></div><div class="ttdeci">integer, parameter num_scopies</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00130">filter_mod.f90:130</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a448fd1d40ad4dc01e18b1035f72373f9"><div class="ttname"><a href="namespacefilter__mod.html#a448fd1d40ad4dc01e18b1035f72373f9">filter_mod::set_time_on_extra_copies</a></div><div class="ttdeci">subroutine set_time_on_extra_copies(ens_handle)</div><div class="ttdoc">Set the time on any extra copies that a pe owns Could we just set the time on all copies?</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02169">filter_mod.f90:2170</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a45d8882093c501baf81dab4bbfaecd47"><div class="ttname"><a href="namespacefilter__mod.html#a45d8882093c501baf81dab4bbfaecd47">filter_mod::get_obs_copy_index</a></div><div class="ttdeci">integer function get_obs_copy_index(seq)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01395">filter_mod.f90:1396</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a46f9eeb3cd59c99cc97dc9f23bbc9c6c"><div class="ttname"><a href="namespacefilter__mod.html#a46f9eeb3cd59c99cc97dc9f23bbc9c6c">filter_mod::obs_window_seconds</a></div><div class="ttdeci">integer obs_window_seconds</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00182">filter_mod.f90:182</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a4baff862c93f0257ec0da92bcd70d122"><div class="ttname"><a href="namespacefilter__mod.html#a4baff862c93f0257ec0da92bcd70d122">filter_mod::output_forward_op_errors</a></div><div class="ttdeci">logical output_forward_op_errors</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00188">filter_mod.f90:188</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a57fb40636aeb9aaa81403bb9a1706210"><div class="ttname"><a href="namespacefilter__mod.html#a57fb40636aeb9aaa81403bb9a1706210">filter_mod::t_before</a></div><div class="ttdeci">integer, parameter t_before</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00160">filter_mod.f90:160</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a585dca55b5debccfa928f3ebcf204f33"><div class="ttname"><a href="namespacefilter__mod.html#a585dca55b5debccfa928f3ebcf204f33">filter_mod::get_obs_dartqc_index</a></div><div class="ttdeci">integer function get_obs_dartqc_index(seq)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01472">filter_mod.f90:1473</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a5931e52ebd8d067e36ce011e28b6f8c9"><div class="ttname"><a href="namespacefilter__mod.html#a5931e52ebd8d067e36ce011e28b6f8c9">filter_mod::obs_sequence_in_name</a></div><div class="ttdeci">character(len=256) obs_sequence_in_name</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00234">filter_mod.f90:234</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a5cab9c21b1b37f563e583a4789290337"><div class="ttname"><a href="namespacefilter__mod.html#a5cab9c21b1b37f563e583a4789290337">filter_mod::write_obs_every_cycle</a></div><div class="ttdeci">logical write_obs_every_cycle</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00191">filter_mod.f90:191</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a5e40e9ef4fd38aeac49bc60576a62291"><div class="ttname"><a href="namespacefilter__mod.html#a5e40e9ef4fd38aeac49bc60576a62291">filter_mod::ens_size</a></div><div class="ttdeci">integer ens_size</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00168">filter_mod.f90:168</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a5eecc9eb93e7af86b7aed288d5900de4"><div class="ttname"><a href="namespacefilter__mod.html#a5eecc9eb93e7af86b7aed288d5900de4">filter_mod::next_copy_number</a></div><div class="ttdeci">integer function next_copy_number(cnum, ncopies)</div><div class="ttdoc">checks the user input and informs the IO modules which files to write.</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02567">filter_mod.f90:2568</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a5fcd2a1cd08db2f0df8bb60b53a9f54b"><div class="ttname"><a href="namespacefilter__mod.html#a5fcd2a1cd08db2f0df8bb60b53a9f54b">filter_mod::set_output_file_info</a></div><div class="ttdeci">subroutine set_output_file_info(file_info, num_ens, stage_copies, do_clamping, force_copy)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02493">filter_mod.f90:2494</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a6021be572f1393433e386c5c7072e176"><div class="ttname"><a href="namespacefilter__mod.html#a6021be572f1393433e386c5c7072e176">filter_mod::obs_window_days</a></div><div class="ttdeci">integer obs_window_days</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00181">filter_mod.f90:181</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a6151f2410c1f3bd1431eb143ec1a606a"><div class="ttname"><a href="namespacefilter__mod.html#a6151f2410c1f3bd1431eb143ec1a606a">filter_mod::timestamp_level</a></div><div class="ttdeci">integer timestamp_level</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00110">filter_mod.f90:110</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a61eec52627cc461c7ba4797880958ce5"><div class="ttname"><a href="namespacefilter__mod.html#a61eec52627cc461c7ba4797880958ce5">filter_mod::current_copies</a></div><div class="ttdeci">integer, dimension(num_scopies) current_copies</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00144">filter_mod.f90:144</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a628081f6059e815cc6fc76703393cfbd"><div class="ttname"><a href="namespacefilter__mod.html#a628081f6059e815cc6fc76703393cfbd">filter_mod::set_copies</a></div><div class="ttdeci">subroutine set_copies(cnum, stage_copies)</div><div class="ttdoc">set copy numbers. this is for when writing all stages at end</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02726">filter_mod.f90:2727</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a65acc7e86af9a343955b2e8557a2d00e"><div class="ttname"><a href="namespacefilter__mod.html#a65acc7e86af9a343955b2e8557a2d00e">filter_mod::test_obs_copies</a></div><div class="ttdeci">subroutine test_obs_copies(obs_fwd_op_ens_handle, information)</div><div class="ttdoc">dump out obs_copies to file</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02768">filter_mod.f90:2769</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a65e3afbc0c28ef39281ddd995dbe5ca2"><div class="ttname"><a href="namespacefilter__mod.html#a65e3afbc0c28ef39281ddd995dbe5ca2">filter_mod::do_posterior_inflate</a></div><div class="ttdeci">logical do_posterior_inflate</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00154">filter_mod.f90:154</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a6658b80041969cae23bbf11c69a05759"><div class="ttname"><a href="namespacefilter__mod.html#a6658b80041969cae23bbf11c69a05759">filter_mod::trace_message</a></div><div class="ttdeci">subroutine trace_message(msg, label, threshold)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01883">filter_mod.f90:1884</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a6a0afbade119eb0c73644e49b86b9fb8"><div class="ttname"><a href="namespacefilter__mod.html#a6a0afbade119eb0c73644e49b86b9fb8">filter_mod::output_sd</a></div><div class="ttdeci">logical output_sd</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00231">filter_mod.f90:231</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a6cab091fff584d16a815ee1cae95cfc1"><div class="ttname"><a href="namespacefilter__mod.html#a6cab091fff584d16a815ee1cae95cfc1">filter_mod::store_input</a></div><div class="ttdeci">subroutine store_input(ens_handle, prior_inflate, post_inflate)</div><div class="ttdoc">Copy the current mean, sd, inf_mean, inf_sd to spare copies Assuming that if the spare copy is there ...</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02193">filter_mod.f90:2194</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a6d1b20f110ea472a3a31fbb956e42e0e"><div class="ttname"><a href="namespacefilter__mod.html#a6d1b20f110ea472a3a31fbb956e42e0e">filter_mod::trace_level</a></div><div class="ttdeci">integer trace_level</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00110">filter_mod.f90:110</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a708dee40667170bbe341f1de0f567928"><div class="ttname"><a href="namespacefilter__mod.html#a708dee40667170bbe341f1de0f567928">filter_mod::num_groups</a></div><div class="ttdeci">integer num_groups</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00187">filter_mod.f90:187</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a72faee5fd84c3e52b6191c8f0043693f"><div class="ttname"><a href="namespacefilter__mod.html#a72faee5fd84c3e52b6191c8f0043693f">filter_mod::single_file_in</a></div><div class="ttdeci">logical single_file_in</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00210">filter_mod.f90:210</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a77b537fbf821744ae02ea89603f1c92c"><div class="ttname"><a href="namespacefilter__mod.html#a77b537fbf821744ae02ea89603f1c92c">filter_mod::obs_sequence_out_name</a></div><div class="ttdeci">character(len=256) obs_sequence_out_name</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00234">filter_mod.f90:234</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a782a1d98e3e47c18d480c4397af79f93"><div class="ttname"><a href="namespacefilter__mod.html#a782a1d98e3e47c18d480c4397af79f93">filter_mod::output_state_files</a></div><div class="ttdeci">character(len=256), dimension(max_files) output_state_files</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00199">filter_mod.f90:199</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a7966f96271850d19516047b1c7b38070"><div class="ttname"><a href="namespacefilter__mod.html#a7966f96271850d19516047b1c7b38070">filter_mod::posterior_diag</a></div><div class="ttdeci">integer, parameter posterior_diag</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00113">filter_mod.f90:113</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a7c24d0881a16cb679683d2a6e767fb86"><div class="ttname"><a href="namespacefilter__mod.html#a7c24d0881a16cb679683d2a6e767fb86">filter_mod::init_time_days</a></div><div class="ttdeci">integer init_time_days</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00172">filter_mod.f90:172</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a7d0e49b8aa9528930458f716b6904f0b"><div class="ttname"><a href="namespacefilter__mod.html#a7d0e49b8aa9528930458f716b6904f0b">filter_mod::progress</a></div><div class="ttdeci">subroutine progress(msg, when, dotime, label, threshold, sync)</div><div class="ttdoc">call progress(string, T_BEFORE, P_TIME, label, threshold, sync) ! trace plus timestamp</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01931">filter_mod.f90:1932</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a7d44418ecce7613f1e900dfd71e2c525"><div class="ttname"><a href="namespacefilter__mod.html#a7d44418ecce7613f1e900dfd71e2c525">filter_mod::distributed_state</a></div><div class="ttdeci">logical distributed_state</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00193">filter_mod.f90:193</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a7e4cd481d9e540ad14c261eaa668cbab"><div class="ttname"><a href="namespacefilter__mod.html#a7e4cd481d9e540ad14c261eaa668cbab">filter_mod::print_ens_time</a></div><div class="ttdeci">subroutine print_ens_time(ens_handle, msg)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01990">filter_mod.f90:1991</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a7e5549afa9086b05dd99a6a7369473cf"><div class="ttname"><a href="namespacefilter__mod.html#a7e5549afa9086b05dd99a6a7369473cf">filter_mod::filter_set_initial_time</a></div><div class="ttdeci">subroutine, public filter_set_initial_time(days, seconds, dart_time, read_time_from_file)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01516">filter_mod.f90:1517</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a8576eaefc8bad0b49d7c893588bde7f9"><div class="ttname"><a href="namespacefilter__mod.html#a8576eaefc8bad0b49d7c893588bde7f9">filter_mod::input_state_file_list</a></div><div class="ttdeci">character(len=256), dimension(max_num_doms) input_state_file_list</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00202">filter_mod.f90:202</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a866f1cc719143bd999d9ef28638b2a72"><div class="ttname"><a href="namespacefilter__mod.html#a866f1cc719143bd999d9ef28638b2a72">filter_mod::has_cycling</a></div><div class="ttdeci">logical has_cycling</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00157">filter_mod.f90:157</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a86e1334dd1a82b078eeaa8f5a114c59a"><div class="ttname"><a href="namespacefilter__mod.html#a86e1334dd1a82b078eeaa8f5a114c59a">filter_mod::output_interval</a></div><div class="ttdeci">integer output_interval</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00186">filter_mod.f90:186</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a8d623acb12e1ecbc4363a56084526205"><div class="ttname"><a href="namespacefilter__mod.html#a8d623acb12e1ecbc4363a56084526205">filter_mod::ens_mean_copy</a></div><div class="ttdeci">integer ens_mean_copy</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00135">filter_mod.f90:135</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a8e2ebccfd942a3b044aa43c9b7e82a70"><div class="ttname"><a href="namespacefilter__mod.html#a8e2ebccfd942a3b044aa43c9b7e82a70">filter_mod::get_blank_qc_index</a></div><div class="ttdeci">integer function get_blank_qc_index(seq)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01494">filter_mod.f90:1495</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a8f03d4175a8c5e6dd1666487dfe91226"><div class="ttname"><a href="namespacefilter__mod.html#a8f03d4175a8c5e6dd1666487dfe91226">filter_mod::inf_upper_bound</a></div><div class="ttdeci">real(r8), dimension(2) inf_upper_bound</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00251">filter_mod.f90:251</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a8f715cc2fb31b5b14a58f9bd06cf86f3"><div class="ttname"><a href="namespacefilter__mod.html#a8f715cc2fb31b5b14a58f9bd06cf86f3">filter_mod::output_members</a></div><div class="ttdeci">logical output_members</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00229">filter_mod.f90:229</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a8fd1b250445c2c0f3787fb29ac42070d"><div class="ttname"><a href="namespacefilter__mod.html#a8fd1b250445c2c0f3787fb29ac42070d">filter_mod::filter_ensemble_inflate</a></div><div class="ttdeci">subroutine filter_ensemble_inflate(ens_handle, inflate_copy, inflate, ens_mean_copy, spare_prior_spread, ens_sd_copy)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01549">filter_mod.f90:1551</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a95db313d402d4f31b9ddb5f4347b9a6f"><div class="ttname"><a href="namespacefilter__mod.html#a95db313d402d4f31b9ddb5f4347b9a6f">filter_mod::output_timestamps</a></div><div class="ttdeci">logical output_timestamps</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00189">filter_mod.f90:189</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a982adbff91f97ba1e1ab17dc6023366f"><div class="ttname"><a href="namespacefilter__mod.html#a982adbff91f97ba1e1ab17dc6023366f">filter_mod::tasks_per_model_advance</a></div><div class="ttdeci">integer tasks_per_model_advance</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00169">filter_mod.f90:169</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a98fbf532050fe3d2ac8674e4d7b0eaf7"><div class="ttname"><a href="namespacefilter__mod.html#a98fbf532050fe3d2ac8674e4d7b0eaf7">filter_mod::output_inflation</a></div><div class="ttdeci">logical output_inflation</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00117">filter_mod.f90:117</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a9b1d65085fce43bd275a8fe91bc0725e"><div class="ttname"><a href="namespacefilter__mod.html#a9b1d65085fce43bd275a8fe91bc0725e">filter_mod::set_input_file_info</a></div><div class="ttdeci">subroutine set_input_file_info(file_info, num_ens, stage_copies)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02438">filter_mod.f90:2439</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a9d8ae1aa989d1726a6213d7b5bdee6e1"><div class="ttname"><a href="namespacefilter__mod.html#a9d8ae1aa989d1726a6213d7b5bdee6e1">filter_mod::timestamp_message</a></div><div class="ttdeci">subroutine timestamp_message(msg, sync)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01909">filter_mod.f90:1910</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_a9ee31f0112a3cd495806db9af6204aa4"><div class="ttname"><a href="namespacefilter__mod.html#a9ee31f0112a3cd495806db9af6204aa4">filter_mod::create_ensemble_from_single_file</a></div><div class="ttdeci">subroutine create_ensemble_from_single_file(ens_handle)</div><div class="ttdoc">Produces an ensemble by copying my_vars of the 1st ensemble member and then perturbing the copies arr...</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02086">filter_mod.f90:2087</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aa2746c6159b24107d90e6920c5e029f9"><div class="ttname"><a href="namespacefilter__mod.html#aa2746c6159b24107d90e6920c5e029f9">filter_mod::post_inflate</a></div><div class="ttdeci">type(adaptive_inflate_type) post_inflate</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00155">filter_mod.f90:155</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aa52472d92f849fc0b5de5a57806ed8ad"><div class="ttname"><a href="namespacefilter__mod.html#aa52472d92f849fc0b5de5a57806ed8ad">filter_mod::inf_initial_from_restart</a></div><div class="ttdeci">logical, dimension(2) inf_initial_from_restart</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00243">filter_mod.f90:243</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aa78ffea5f7c1c36719ee2c6497cfeb06"><div class="ttname"><a href="namespacefilter__mod.html#aa78ffea5f7c1c36719ee2c6497cfeb06">filter_mod::preassim_copies</a></div><div class="ttdeci">integer, dimension(num_scopies) preassim_copies</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00146">filter_mod.f90:146</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aa81a00c06bd9825573e5ae0b45676655"><div class="ttname"><a href="namespacefilter__mod.html#aa81a00c06bd9825573e5ae0b45676655">filter_mod::ens_mem_start</a></div><div class="ttdeci">integer ens_mem_start</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00133">filter_mod.f90:133</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aac69510af5cd47b53ce1c782db673a7b"><div class="ttname"><a href="namespacefilter__mod.html#aac69510af5cd47b53ce1c782db673a7b">filter_mod::filter_set_window_time</a></div><div class="ttdeci">subroutine filter_set_window_time(dart_time)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01534">filter_mod.f90:1535</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aade0710f5022a2552c756dfc026fed63"><div class="ttname"><a href="namespacefilter__mod.html#aade0710f5022a2552c756dfc026fed63">filter_mod::count_state_ens_copies</a></div><div class="ttdeci">integer function count_state_ens_copies(ens_size, post_inflate, prior_inflate)</div><div class="ttdoc">Count the number of copies to be allocated for the ensemble manager.</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02278">filter_mod.f90:2279</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aae9ba03698bc72a9d910de225b413d80"><div class="ttname"><a href="namespacefilter__mod.html#aae9ba03698bc72a9d910de225b413d80">filter_mod::priorinf_mean</a></div><div class="ttdeci">integer, parameter priorinf_mean</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00124">filter_mod.f90:124</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aaeea1ee8519ff70f459382d1b0d5fb60"><div class="ttname"><a href="namespacefilter__mod.html#aaeea1ee8519ff70f459382d1b0d5fb60">filter_mod::post_inf_sd_copy</a></div><div class="ttdeci">integer post_inf_sd_copy</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00140">filter_mod.f90:140</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aaf1e25fd8591ef5235d72965ec31be1a"><div class="ttname"><a href="namespacefilter__mod.html#aaf1e25fd8591ef5235d72965ec31be1a">filter_mod::spare_prior_spread</a></div><div class="ttdeci">integer spare_prior_spread</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00150">filter_mod.f90:150</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ab21ff1ee87b3f7e9bfab3fed249624b1"><div class="ttname"><a href="namespacefilter__mod.html#ab21ff1ee87b3f7e9bfab3fed249624b1">filter_mod::perturb_from_single_instance</a></div><div class="ttdeci">logical perturb_from_single_instance</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00206">filter_mod.f90:206</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ab25b55818d4f6cd0b91c8a17365c4736"><div class="ttname"><a href="namespacefilter__mod.html#ab25b55818d4f6cd0b91c8a17365c4736">filter_mod::print_obs_time</a></div><div class="ttdeci">subroutine print_obs_time(seq, key, msg)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02011">filter_mod.f90:2012</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ab2c376d8c98d53a47939ed391ced0654"><div class="ttname"><a href="namespacefilter__mod.html#ab2c376d8c98d53a47939ed391ced0654">filter_mod::filter_initialize_modules_used</a></div><div class="ttdeci">subroutine filter_initialize_modules_used()</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01262">filter_mod.f90:1263</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ab4235d433b1b5d095798608d9032d8f0"><div class="ttname"><a href="namespacefilter__mod.html#ab4235d433b1b5d095798608d9032d8f0">filter_mod::first_obs_seconds</a></div><div class="ttdeci">integer first_obs_seconds</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00177">filter_mod.f90:177</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ab501d4bc83880f73c2b4d8425043701d"><div class="ttname"><a href="namespacefilter__mod.html#ab501d4bc83880f73c2b4d8425043701d">filter_mod::compute_posterior</a></div><div class="ttdeci">logical compute_posterior</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00214">filter_mod.f90:214</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ab751fbc6a9ea198bae7c0f7a23c3f340"><div class="ttname"><a href="namespacefilter__mod.html#ab751fbc6a9ea198bae7c0f7a23c3f340">filter_mod::input_state_files</a></div><div class="ttdeci">character(len=256), dimension(max_files) input_state_files</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00198">filter_mod.f90:198</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ab755c9150a3ba240b43f8930123d861a"><div class="ttname"><a href="namespacefilter__mod.html#ab755c9150a3ba240b43f8930123d861a">filter_mod::inf_initial</a></div><div class="ttdeci">real(r8), dimension(2) inf_initial</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00246">filter_mod.f90:246</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ab7d4c1aa67478d6c8aec44eb82d0c7e7"><div class="ttname"><a href="namespacefilter__mod.html#ab7d4c1aa67478d6c8aec44eb82d0c7e7">filter_mod::postassim_copies</a></div><div class="ttdeci">integer, dimension(num_scopies) postassim_copies</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00147">filter_mod.f90:147</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ab8cdd1126d0e8c7b386f1a31be904877"><div class="ttname"><a href="namespacefilter__mod.html#ab8cdd1126d0e8c7b386f1a31be904877">filter_mod::prior_diag</a></div><div class="ttdeci">integer, parameter prior_diag</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00113">filter_mod.f90:113</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_abe2def69d13835cd3a24a3492fc6d038"><div class="ttname"><a href="namespacefilter__mod.html#abe2def69d13835cd3a24a3492fc6d038">filter_mod::priorinf_sd</a></div><div class="ttdeci">integer, parameter priorinf_sd</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00125">filter_mod.f90:125</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_abee3c2d14c91fe599a09d179c7c0f9a9"><div class="ttname"><a href="namespacefilter__mod.html#abee3c2d14c91fe599a09d179c7c0f9a9">filter_mod::last_obs_seconds</a></div><div class="ttdeci">integer last_obs_seconds</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00179">filter_mod.f90:179</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_abfe5d4c835d0046ed1e49f24094a01ff"><div class="ttname"><a href="namespacefilter__mod.html#abfe5d4c835d0046ed1e49f24094a01ff">filter_mod::filter_main</a></div><div class="ttdeci">subroutine, public filter_main()</div><div class="ttdoc">The code does not use vars arrays except:</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00323">filter_mod.f90:324</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ac167793e46b9ae30bc56975ce777cae4"><div class="ttname"><a href="namespacefilter__mod.html#ac167793e46b9ae30bc56975ce777cae4">filter_mod::broadcast_time_across_copy_owners</a></div><div class="ttdeci">subroutine broadcast_time_across_copy_owners(ens_handle, ens_time)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01825">filter_mod.f90:1826</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ac521f74b797f508d3777d2d1c7a68226"><div class="ttname"><a href="namespacefilter__mod.html#ac521f74b797f508d3777d2d1c7a68226">filter_mod::postinf_sd</a></div><div class="ttdeci">integer, parameter postinf_sd</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00127">filter_mod.f90:127</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ac551eccc90bd5d6a4071dc05aac6eb92"><div class="ttname"><a href="namespacefilter__mod.html#ac551eccc90bd5d6a4071dc05aac6eb92">filter_mod::ens_sd_copy</a></div><div class="ttdeci">integer ens_sd_copy</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00136">filter_mod.f90:136</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ac57764243591fe7c29cffbee0d7882d5"><div class="ttname"><a href="namespacefilter__mod.html#ac57764243591fe7c29cffbee0d7882d5">filter_mod::perturbation_amplitude</a></div><div class="ttdeci">real(r8) perturbation_amplitude</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00207">filter_mod.f90:207</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ac69f82a4c4e290f82acdc71b118edfe3"><div class="ttname"><a href="namespacefilter__mod.html#ac69f82a4c4e290f82acdc71b118edfe3">filter_mod::allow_missing_clm</a></div><div class="ttdeci">logical allow_missing_clm</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00258">filter_mod.f90:258</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ac97d329291d9ed859f969a8cf2ac8c99"><div class="ttname"><a href="namespacefilter__mod.html#ac97d329291d9ed859f969a8cf2ac8c99">filter_mod::mem_end</a></div><div class="ttdeci">integer, parameter mem_end</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00121">filter_mod.f90:121</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_acc88936518a51aed421d731d3c628402"><div class="ttname"><a href="namespacefilter__mod.html#acc88936518a51aed421d731d3c628402">filter_mod::inf_sd_initial_from_restart</a></div><div class="ttdeci">logical, dimension(2) inf_sd_initial_from_restart</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00244">filter_mod.f90:244</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_acea21f1c63d14bee04ce8f04631a3c58"><div class="ttname"><a href="namespacefilter__mod.html#acea21f1c63d14bee04ce8f04631a3c58">filter_mod::perturb_copies_task_bitwise</a></div><div class="ttdeci">subroutine perturb_copies_task_bitwise(ens_handle)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02130">filter_mod.f90:2131</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ad0e36d53a2b4f06843cfe51478df868a"><div class="ttname"><a href="namespacefilter__mod.html#ad0e36d53a2b4f06843cfe51478df868a">filter_mod::postinf_mean</a></div><div class="ttdeci">integer, parameter postinf_mean</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00126">filter_mod.f90:126</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ad673ddbd207f8a0f2c2f29d95b717a78"><div class="ttname"><a href="namespacefilter__mod.html#ad673ddbd207f8a0f2c2f29d95b717a78">filter_mod::set_filename_info</a></div><div class="ttdeci">subroutine set_filename_info(file_info, stage, num_ens, stage_copies)</div><div class="ttdoc">Set file name information. For members restarts can be read from an input_state_file_list or construc...</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02415">filter_mod.f90:2416</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_adb06e014f938682a0f0aa6fa3d73c43c"><div class="ttname"><a href="namespacefilter__mod.html#adb06e014f938682a0f0aa6fa3d73c43c">filter_mod::t_neither</a></div><div class="ttdeci">integer, parameter t_neither</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00162">filter_mod.f90:162</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_adf38423aa561b42883a121952ee4ecd6"><div class="ttname"><a href="namespacefilter__mod.html#adf38423aa561b42883a121952ee4ecd6">filter_mod::first_obs_days</a></div><div class="ttdeci">integer first_obs_days</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00176">filter_mod.f90:176</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_adf56dc433ec988bba9ea76465912e7fe"><div class="ttname"><a href="namespacefilter__mod.html#adf56dc433ec988bba9ea76465912e7fe">filter_mod::obs_space_diagnostics</a></div><div class="ttdeci">subroutine obs_space_diagnostics(obs_fwd_op_ens_handle, qc_ens_handle, ens_size, seq, keys, prior_post, num_output_members, members_index, obs_val_index, obs_key_copy, ens_mean_index, ens_spread_index, num_obs_in_set, obs_mean_start, obs_var_start, obs_global_qc_copy, obs_val_copy, obs_err_var_copy, dart_qc_index, do_post)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01624">filter_mod.f90:1630</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ae2547988fa5bca92f49db99a8c35b884"><div class="ttname"><a href="namespacefilter__mod.html#ae2547988fa5bca92f49db99a8c35b884">filter_mod::get_obs_prior_index</a></div><div class="ttdeci">integer function get_obs_prior_index(seq)</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l01417">filter_mod.f90:1418</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ae4df205a40c5271f63f40b15a355a8ca"><div class="ttname"><a href="namespacefilter__mod.html#ae4df205a40c5271f63f40b15a355a8ca">filter_mod::store_copies</a></div><div class="ttdeci">subroutine store_copies(ens_handle, stage_copies)</div><div class="ttdoc">Copy the current mean, sd, inf_mean, inf_sd to spare copies Assuming that if the spare copy is there ...</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02242">filter_mod.f90:2243</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_ae9eaef91b58f18b6b913aee9aa0ea912"><div class="ttname"><a href="namespacefilter__mod.html#ae9eaef91b58f18b6b913aee9aa0ea912">filter_mod::initialize_file_information</a></div><div class="ttdeci">subroutine initialize_file_information(ncopies, file_info_input, file_info_mean_sd, file_info_forecast, file_info_preassim, file_info_postassim, file_info_analysis, file_info_output)</div><div class="ttdoc">initialize file names and which copies should be read and or written</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02586">filter_mod.f90:2591</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aebdd9c4752f1dbed57bcabc302d614ef"><div class="ttname"><a href="namespacefilter__mod.html#aebdd9c4752f1dbed57bcabc302d614ef">filter_mod::ens_mean</a></div><div class="ttdeci">integer, parameter ens_mean</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00122">filter_mod.f90:122</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aed15c0af9f08f929a1d112381a09f6ad"><div class="ttname"><a href="namespacefilter__mod.html#aed15c0af9f08f929a1d112381a09f6ad">filter_mod::init_time_seconds</a></div><div class="ttdeci">integer init_time_seconds</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00173">filter_mod.f90:173</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_aef5fa665c3d493314f6550f4be65b840"><div class="ttname"><a href="namespacefilter__mod.html#aef5fa665c3d493314f6550f4be65b840">filter_mod::inf_damping</a></div><div class="ttdeci">real(r8), dimension(2) inf_damping</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00249">filter_mod.f90:249</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_af1e7b985d8df3e6af8f2587261d8641b"><div class="ttname"><a href="namespacefilter__mod.html#af1e7b985d8df3e6af8f2587261d8641b">filter_mod::last_obs_days</a></div><div class="ttdeci">integer last_obs_days</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00178">filter_mod.f90:178</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_af31a90166dc2ca62f1779defb2122dbe"><div class="ttname"><a href="namespacefilter__mod.html#af31a90166dc2ca62f1779defb2122dbe">filter_mod::do_prior_inflate</a></div><div class="ttdeci">logical do_prior_inflate</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00153">filter_mod.f90:153</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_af58e04c3bdb3f7063488a3861dfdc442"><div class="ttname"><a href="namespacefilter__mod.html#af58e04c3bdb3f7063488a3861dfdc442">filter_mod::inf_sd_lower_bound</a></div><div class="ttdeci">real(r8), dimension(2) inf_sd_lower_bound</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00252">filter_mod.f90:252</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_af75dd9a652c6247d3ed145ce5e67abdc"><div class="ttname"><a href="namespacefilter__mod.html#af75dd9a652c6247d3ed145ce5e67abdc">filter_mod::ens_mem_end</a></div><div class="ttdeci">integer ens_mem_end</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00134">filter_mod.f90:134</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_af78ca27ca66a25de58fae8a63628b05c"><div class="ttname"><a href="namespacefilter__mod.html#af78ca27ca66a25de58fae8a63628b05c">filter_mod::p_time</a></div><div class="ttdeci">logical, parameter p_time</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00163">filter_mod.f90:163</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_af8c9a989108a0fa174d4a25887ad68cf"><div class="ttname"><a href="namespacefilter__mod.html#af8c9a989108a0fa174d4a25887ad68cf">filter_mod::post_inf_copy</a></div><div class="ttdeci">integer post_inf_copy</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l00139">filter_mod.f90:139</a></div></div>
<div class="ttc" id="anamespacefilter__mod_html_af9da208130303c28f02f238d499069e2"><div class="ttname"><a href="namespacefilter__mod.html#af9da208130303c28f02f238d499069e2">filter_mod::verbose_forward_op_output</a></div><div class="ttdeci">subroutine verbose_forward_op_output(qc_ens_handle, prior_post, ens_size, keys)</div><div class="ttdoc">write out failed forward operators This was part of obs_space_diagnostics</div><div class="ttdef"><b>Definition</b> <a href="filter__mod_8f90_source.html#l02040">filter_mod.f90:2041</a></div></div>
<div class="ttc" id="anamespaceforward__operator__mod_html"><div class="ttname"><a href="namespaceforward__operator__mod.html">forward_operator_mod</a></div><div class="ttdoc">forward_operator_mod.f90</div><div class="ttdef"><b>Definition</b> <a href="forward__operator__mod_8f90_source.html#l00011">forward_operator_mod.f90:11</a></div></div>
<div class="ttc" id="anamespaceforward__operator__mod_html_af35dca4b85910d40d7a83747b059600b"><div class="ttname"><a href="namespaceforward__operator__mod.html#af35dca4b85910d40d7a83747b059600b">forward_operator_mod::get_obs_ens_distrib_state</a></div><div class="ttdeci">subroutine, public get_obs_ens_distrib_state(ens_handle, obs_fwd_op_ens_handle, qc_ens_handle, seq, keys, obs_val_index, input_qc_index, obs_err_var_copy, obs_val_copy, obs_key_copy, obs_global_qc_copy, obs_extra_qc_copy, obs_mean_copy, obs_var_copy, isprior, prior_qc_copy)</div><div class="ttdoc">Subroutine get_obs_ens_distrib_state.</div><div class="ttdef"><b>Definition</b> <a href="forward__operator__mod_8f90_source.html#l00070">forward_operator_mod.f90:75</a></div></div>
<div class="ttc" id="anamespaceio__filenames__mod_html"><div class="ttname"><a href="namespaceio__filenames__mod.html">io_filenames_mod</a></div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00005">io_filenames_mod.f90:5</a></div></div>
<div class="ttc" id="anamespacelocation__mod_html"><div class="ttname"><a href="namespacelocation__mod.html">location_mod</a></div><div class="ttdoc">Implements location interfaces for a three dimensional spherical shell with a choice of vertical coor...</div><div class="ttdef"><b>Definition</b> <a href="annulus_2location__mod_8f90_source.html#l00005">location_mod.f90:5</a></div></div>
<div class="ttc" id="anamespacelocation__mod_html_a1832b28fafc9a444c7bd7d4d14caf758"><div class="ttname"><a href="namespacelocation__mod.html#a1832b28fafc9a444c7bd7d4d14caf758">location_mod::msgstring</a></div><div class="ttdeci">character(len=256) msgstring</div><div class="ttdef"><b>Definition</b> <a href="annulus_2location__mod_8f90_source.html#l00057">location_mod.f90:57</a></div></div>
<div class="ttc" id="anamespacelocation__mod_html_ae9cb3473bac89f57fd3125be735dd702"><div class="ttname"><a href="namespacelocation__mod.html#ae9cb3473bac89f57fd3125be735dd702">location_mod::source</a></div><div class="ttdeci">character(len= *), parameter source</div><div class="ttdef"><b>Definition</b> <a href="annulus_2location__mod_8f90_source.html#l00036">location_mod.f90:36</a></div></div>
<div class="ttc" id="anamespacempi__utilities__mod_html"><div class="ttname"><a href="namespacempi__utilities__mod.html">mpi_utilities_mod</a></div><div class="ttdoc">A collection of interfaces to the MPI (Message Passing Interface) multi-processor communication libra...</div><div class="ttdef"><b>Definition</b> <a href="mpi__utilities__mod_8f90_source.html#l00031">mpi_utilities_mod.f90:31</a></div></div>
<div class="ttc" id="anamespacempi__utilities__mod_html_a19228477ddb48773bf4fb3858c997d82"><div class="ttname"><a href="namespacempi__utilities__mod.html#a19228477ddb48773bf4fb3858c997d82">mpi_utilities_mod::task_sync</a></div><div class="ttdeci">subroutine, public task_sync()</div><div class="ttdoc">Synchronize all tasks. This subroutine does not return until all tasks execute this line of code.</div><div class="ttdef"><b>Definition</b> <a href="mpi__utilities__mod_8f90_source.html#l00522">mpi_utilities_mod.f90:523</a></div></div>
<div class="ttc" id="anamespacempi__utilities__mod_html_a5d695a71f9877df21d7ff2a39dba9821"><div class="ttname"><a href="namespacempi__utilities__mod.html#a5d695a71f9877df21d7ff2a39dba9821">mpi_utilities_mod::broadcast_send</a></div><div class="ttdeci">subroutine, public broadcast_send(from, array1, array2, array3, array4, array5, scalar1, scalar2, scalar3, scalar4, scalar5)</div><div class="ttdoc">this must be paired with the same number of broadcast_recv()s on all other tasks. it will not return ...</div><div class="ttdef"><b>Definition</b> <a href="mpi__utilities__mod_8f90_source.html#l00931">mpi_utilities_mod.f90:933</a></div></div>
<div class="ttc" id="anamespacempi__utilities__mod_html_abf5f213db52aac32b7f0bdf774d1a1d9"><div class="ttname"><a href="namespacempi__utilities__mod.html#abf5f213db52aac32b7f0bdf774d1a1d9">mpi_utilities_mod::broadcast_recv</a></div><div class="ttdeci">subroutine, public broadcast_recv(from, array1, array2, array3, array4, array5, scalar1, scalar2, scalar3, scalar4, scalar5)</div><div class="ttdoc">this must be paired with a single broadcast_send() on one other task, and broadcast_recv() on all oth...</div><div class="ttdef"><b>Definition</b> <a href="mpi__utilities__mod_8f90_source.html#l01002">mpi_utilities_mod.f90:1004</a></div></div>
<div class="ttc" id="anamespacempi__utilities__mod_html_ae08b6543f55b372bd6addea0eb1e04a0"><div class="ttname"><a href="namespacempi__utilities__mod.html#ae08b6543f55b372bd6addea0eb1e04a0">mpi_utilities_mod::my_task_id</a></div><div class="ttdeci">integer function, public my_task_id()</div><div class="ttdoc">Return my unique task id. Values run from 0 to N-1 (where N is the total number of MPI tasks.</div><div class="ttdef"><b>Definition</b> <a href="mpi__utilities__mod_8f90_source.html#l00503">mpi_utilities_mod.f90:504</a></div></div>
<div class="ttc" id="anamespacempi__utilities__mod_html_ae8ccd09884b18c6d167291247089bd27"><div class="ttname"><a href="namespacempi__utilities__mod.html#ae8ccd09884b18c6d167291247089bd27">mpi_utilities_mod::task_count</a></div><div class="ttdeci">integer function, public task_count()</div><div class="ttdoc">Return the total number of MPI tasks. e.g. if the number of tasks is 4, it returns 4....</div><div class="ttdef"><b>Definition</b> <a href="mpi__utilities__mod_8f90_source.html#l00484">mpi_utilities_mod.f90:485</a></div></div>
<div class="ttc" id="anamespaceobs__def__mod_html"><div class="ttname"><a href="namespaceobs__def__mod.html">obs_def_mod</a></div><div class="ttdef"><b>Definition</b> <a href="obs__def__mod_8f90_source.html#l01333">obs_def_mod.f90:1333</a></div></div>
<div class="ttc" id="anamespaceobs__def__mod_html_a766a4b5931e96b862d50f04ad5b56a1a"><div class="ttname"><a href="namespaceobs__def__mod.html#a766a4b5931e96b862d50f04ad5b56a1a">obs_def_mod::get_obs_def_type_of_obs</a></div><div class="ttdeci">integer function, public get_obs_def_type_of_obs(obs_def)</div><div class="ttdef"><b>Definition</b> <a href="obs__def__mod_8f90_source.html#l01960">obs_def_mod.f90:1961</a></div></div>
<div class="ttc" id="anamespaceobs__def__mod_html_abe1a0f69f359ce770251b6e896e4f708"><div class="ttname"><a href="namespaceobs__def__mod.html#abe1a0f69f359ce770251b6e896e4f708">obs_def_mod::get_obs_def_time</a></div><div class="ttdeci">type(time_type) function, public get_obs_def_time(obs_def)</div><div class="ttdef"><b>Definition</b> <a href="obs__def__mod_8f90_source.html#l01975">obs_def_mod.f90:1976</a></div></div>
<div class="ttc" id="anamespaceobs__def__mod_html_aee84192b347db927d7401173240157b8"><div class="ttname"><a href="namespaceobs__def__mod.html#aee84192b347db927d7401173240157b8">obs_def_mod::get_obs_def_error_variance</a></div><div class="ttdeci">real(r8) function, public get_obs_def_error_variance(obs_def)</div><div class="ttdef"><b>Definition</b> <a href="obs__def__mod_8f90_source.html#l01932">obs_def_mod.f90:1933</a></div></div>
<div class="ttc" id="anamespaceobs__def__utilities__mod_html"><div class="ttname"><a href="namespaceobs__def__utilities__mod.html">obs_def_utilities_mod</a></div><div class="ttdoc">Utilities that can be used by any of the obs_def_xxx_mods. In a separate module to obs_def_mod to avo...</div><div class="ttdef"><b>Definition</b> <a href="obs__def__utilities__mod_8f90_source.html#l00009">obs_def_utilities_mod.f90:9</a></div></div>
<div class="ttc" id="anamespaceobs__def__utilities__mod_html_a3732608dacf5a1438cc02de8a53fb764"><div class="ttname"><a href="namespaceobs__def__utilities__mod.html#a3732608dacf5a1438cc02de8a53fb764">obs_def_utilities_mod::set_debug_fwd_op</a></div><div class="ttdeci">subroutine, public set_debug_fwd_op(setme)</div><div class="ttdoc">This routine can be used to set the debugging level of track_status. It is called from filter_mod.</div><div class="ttdef"><b>Definition</b> <a href="obs__def__utilities__mod_8f90_source.html#l00026">obs_def_utilities_mod.f90:27</a></div></div>
<div class="ttc" id="anamespaceobs__model__mod_html"><div class="ttname"><a href="namespaceobs__model__mod.html">obs_model_mod</a></div><div class="ttdef"><b>Definition</b> <a href="obs__model__mod_8f90_source.html#l00005">obs_model_mod.f90:5</a></div></div>
<div class="ttc" id="anamespaceobs__model__mod_html_a03fc749b8153a9183a25baa68e40b6b1"><div class="ttname"><a href="namespaceobs__model__mod.html#a03fc749b8153a9183a25baa68e40b6b1">obs_model_mod::advance_state</a></div><div class="ttdeci">subroutine, public advance_state(ens_handle, ens_size, target_time, async, adv_ens_command, tasks_per_model_advance, file_info_output, file_info_input)</div><div class="ttdef"><b>Definition</b> <a href="obs__model__mod_8f90_source.html#l00284">obs_model_mod.f90:286</a></div></div>
<div class="ttc" id="anamespaceobs__model__mod_html_a5ba75c3d4925959b387beafb52538b89"><div class="ttname"><a href="namespaceobs__model__mod.html#a5ba75c3d4925959b387beafb52538b89">obs_model_mod::set_obs_model_trace</a></div><div class="ttdeci">subroutine, public set_obs_model_trace(execution_level, timestamp_level)</div><div class="ttdef"><b>Definition</b> <a href="obs__model__mod_8f90_source.html#l00571">obs_model_mod.f90:572</a></div></div>
<div class="ttc" id="anamespaceobs__model__mod_html_ab274fdab0af4375f044a81cd6f27cb94"><div class="ttname"><a href="namespaceobs__model__mod.html#ab274fdab0af4375f044a81cd6f27cb94">obs_model_mod::move_ahead</a></div><div class="ttdeci">subroutine, public move_ahead(ens_handle, ens_size, seq, last_key_used, window_time, key_bounds, num_obs_in_set, curr_ens_time, next_ens_time)</div><div class="ttdef"><b>Definition</b> <a href="obs__model__mod_8f90_source.html#l00057">obs_model_mod.f90:59</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html"><div class="ttname"><a href="namespaceobs__sequence__mod.html">obs_sequence_mod</a></div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00012">obs_sequence_mod.f90:12</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a0397f5139207309fc5807b9b3b69f1de"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a0397f5139207309fc5807b9b3b69f1de">obs_sequence_mod::init_obs</a></div><div class="ttdeci">subroutine, public init_obs(obs, num_copies, num_qc)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l02085">obs_sequence_mod.f90:2086</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a04453c924b6c433af2d05c3260432f5a"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a04453c924b6c433af2d05c3260432f5a">obs_sequence_mod::destroy_obs_sequence</a></div><div class="ttdeci">subroutine, public destroy_obs_sequence(seq)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00219">obs_sequence_mod.f90:220</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a0c1486accd611ac04e269ab6799e21ba"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a0c1486accd611ac04e269ab6799e21ba">obs_sequence_mod::get_obs_time_range</a></div><div class="ttdeci">subroutine, public get_obs_time_range(seq, time1, time2, key_bounds, num_keys, out_of_range, obs)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00553">obs_sequence_mod.f90:554</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a23ba15f0f119df95d4d528dd4c77636d"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a23ba15f0f119df95d4d528dd4c77636d">obs_sequence_mod::get_first_obs</a></div><div class="ttdeci">logical function, public get_first_obs(seq, obs)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00947">obs_sequence_mod.f90:948</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a24c15eefbff5a6484a7cf953678e6ca7"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a24c15eefbff5a6484a7cf953678e6ca7">obs_sequence_mod::write_obs_seq</a></div><div class="ttdeci">subroutine, public write_obs_seq(seq, file_name)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l01076">obs_sequence_mod.f90:1077</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a251405e9c2065d7a5bdfb9d50617eb5a"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a251405e9c2065d7a5bdfb9d50617eb5a">obs_sequence_mod::get_num_qc</a></div><div class="ttdeci">integer function, public get_num_qc(seq)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00353">obs_sequence_mod.f90:354</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a2a3abc0b65b16b2ab4c6f3f6f494bedf"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a2a3abc0b65b16b2ab4c6f3f6f494bedf">obs_sequence_mod::replace_obs_values</a></div><div class="ttdeci">subroutine, public replace_obs_values(seq, key, values, copy_indx)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l02403">obs_sequence_mod.f90:2404</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a2b5fc4db58ccaae0b5804d4e77e721f4"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a2b5fc4db58ccaae0b5804d4e77e721f4">obs_sequence_mod::delete_seq_head</a></div><div class="ttdeci">subroutine, public delete_seq_head(first_time, seq, all_gone)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l01397">obs_sequence_mod.f90:1398</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a2d0eb7fd4d5bf9d607023de100ac8a94"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a2d0eb7fd4d5bf9d607023de100ac8a94">obs_sequence_mod::get_qc_meta_data</a></div><div class="ttdeci">character(len=metadatalength) function, public get_qc_meta_data(seq, qc_num)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00401">obs_sequence_mod.f90:402</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a2d6f7b7025c6c9d400bdaa4a9d15013e"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a2d6f7b7025c6c9d400bdaa4a9d15013e">obs_sequence_mod::set_copy_meta_data</a></div><div class="ttdeci">subroutine, public set_copy_meta_data(seq, copy_num, meta_data)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00888">obs_sequence_mod.f90:889</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a2e39be37600163c6a933b87aa1dcb367"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a2e39be37600163c6a933b87aa1dcb367">obs_sequence_mod::delete_seq_tail</a></div><div class="ttdeci">subroutine, public delete_seq_tail(last_time, seq, all_gone)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l01487">obs_sequence_mod.f90:1488</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a31c6f2a944a254a1a8d5c817d2c69cc5"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a31c6f2a944a254a1a8d5c817d2c69cc5">obs_sequence_mod::destroy_obs</a></div><div class="ttdeci">subroutine, public destroy_obs(obs)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l02245">obs_sequence_mod.f90:2246</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a3373f7292e3704ca5ac594e939f0523f"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a3373f7292e3704ca5ac594e939f0523f">obs_sequence_mod::get_copy_meta_data</a></div><div class="ttdeci">character(len=metadatalength) function, public get_copy_meta_data(seq, copy_num)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00388">obs_sequence_mod.f90:389</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a519ce153ee2d450b79117a730296dcc9"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a519ce153ee2d450b79117a730296dcc9">obs_sequence_mod::get_time_range_keys</a></div><div class="ttdeci">subroutine, public get_time_range_keys(seq, key_bounds, num_keys, keys)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00626">obs_sequence_mod.f90:627</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a534a13c649cdf1bc6c1ab4684d185410"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a534a13c649cdf1bc6c1ab4684d185410">obs_sequence_mod::get_qc</a></div><div class="ttdeci">subroutine, public get_qc(obs, qc, qc_indx)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l02419">obs_sequence_mod.f90:2420</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a65bd44dd192cbaa173c1a6abb5e900e2"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a65bd44dd192cbaa173c1a6abb5e900e2">obs_sequence_mod::read_obs_seq</a></div><div class="ttdeci">subroutine, public read_obs_seq(file_name, add_copies, add_qc, add_obs, seq)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l01165">obs_sequence_mod.f90:1166</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a75c8a2e004f5e060234b1ce4e776356c"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a75c8a2e004f5e060234b1ce4e776356c">obs_sequence_mod::read_obs_seq_header</a></div><div class="ttdeci">subroutine, public read_obs_seq_header(file_name, num_copies, num_qc, num_obs, max_num_obs, file_id, read_format, pre_i_format, close_the_file)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l01267">obs_sequence_mod.f90:1269</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a7a13675815775edb06f71a84fa09d334"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a7a13675815775edb06f71a84fa09d334">obs_sequence_mod::get_num_obs</a></div><div class="ttdeci">integer function, public get_num_obs(seq)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00365">obs_sequence_mod.f90:366</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a8126596a8e537768e04be706daec4254"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a8126596a8e537768e04be706daec4254">obs_sequence_mod::get_obs_from_key</a></div><div class="ttdeci">subroutine, public get_obs_from_key(seq, key, obs)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00464">obs_sequence_mod.f90:465</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_a84db51e90a66b42eb04d2fcb29e6d616"><div class="ttname"><a href="namespaceobs__sequence__mod.html#a84db51e90a66b42eb04d2fcb29e6d616">obs_sequence_mod::add_qc</a></div><div class="ttdeci">subroutine, public add_qc(seq, num_to_add)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l01029">obs_sequence_mod.f90:1030</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_aad650f058335a5d9f0215cd0f2426d9f"><div class="ttname"><a href="namespaceobs__sequence__mod.html#aad650f058335a5d9f0215cd0f2426d9f">obs_sequence_mod::delete_obs_from_seq</a></div><div class="ttdeci">subroutine, public delete_obs_from_seq(seq, obs)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00839">obs_sequence_mod.f90:840</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_aaf29a2edd6656bc1159b6e0b81d017bb"><div class="ttname"><a href="namespaceobs__sequence__mod.html#aaf29a2edd6656bc1159b6e0b81d017bb">obs_sequence_mod::set_qc_meta_data</a></div><div class="ttdeci">subroutine, public set_qc_meta_data(seq, qc_num, meta_data)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00918">obs_sequence_mod.f90:919</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_ab79782b84c5c610876e5f96f6d64b895"><div class="ttname"><a href="namespaceobs__sequence__mod.html#ab79782b84c5c610876e5f96f6d64b895">obs_sequence_mod::set_obs_values</a></div><div class="ttdeci">subroutine, public set_obs_values(obs, values, copy_indx)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l02387">obs_sequence_mod.f90:2388</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_ad2d03abd4ff723482610c1bc35eee900"><div class="ttname"><a href="namespaceobs__sequence__mod.html#ad2d03abd4ff723482610c1bc35eee900">obs_sequence_mod::get_obs_values</a></div><div class="ttdeci">subroutine, public get_obs_values(obs, values, copy_indx)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l02370">obs_sequence_mod.f90:2371</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_ae409f58556d2955357b70cce43648b0d"><div class="ttname"><a href="namespaceobs__sequence__mod.html#ae409f58556d2955357b70cce43648b0d">obs_sequence_mod::set_qc</a></div><div class="ttdeci">subroutine, public set_qc(obs, qc, qc_indx)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l02435">obs_sequence_mod.f90:2436</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_ae884000e024da5fcb714a50e3e07235e"><div class="ttname"><a href="namespaceobs__sequence__mod.html#ae884000e024da5fcb714a50e3e07235e">obs_sequence_mod::get_obs_def</a></div><div class="ttdeci">subroutine, public get_obs_def(obs, obs_def)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l02348">obs_sequence_mod.f90:2349</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_aef1831e41128a3eca03600ee6a9f0d46"><div class="ttname"><a href="namespaceobs__sequence__mod.html#aef1831e41128a3eca03600ee6a9f0d46">obs_sequence_mod::set_obs</a></div><div class="ttdeci">subroutine, public set_obs(seq, obs, key_in)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00525">obs_sequence_mod.f90:526</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_af0206e62734fbd29cd26a3487e7a8997"><div class="ttname"><a href="namespaceobs__sequence__mod.html#af0206e62734fbd29cd26a3487e7a8997">obs_sequence_mod::static_init_obs_sequence</a></div><div class="ttdeci">subroutine, public static_init_obs_sequence</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00150">obs_sequence_mod.f90:151</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_af23b49f36e14be5744be1d6046c29299"><div class="ttname"><a href="namespaceobs__sequence__mod.html#af23b49f36e14be5744be1d6046c29299">obs_sequence_mod::replace_qc</a></div><div class="ttdeci">subroutine, public replace_qc(seq, key, qc, qc_indx)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l02451">obs_sequence_mod.f90:2452</a></div></div>
<div class="ttc" id="anamespaceobs__sequence__mod_html_afdc0061940a4415db77188d81429ac97"><div class="ttname"><a href="namespaceobs__sequence__mod.html#afdc0061940a4415db77188d81429ac97">obs_sequence_mod::get_num_copies</a></div><div class="ttdeci">integer function, public get_num_copies(seq)</div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00341">obs_sequence_mod.f90:342</a></div></div>
<div class="ttc" id="anamespaceoptions__mod_html"><div class="ttname"><a href="namespaceoptions__mod.html">options_mod</a></div><div class="ttdef"><b>Definition</b> <a href="options__mod_8f90_source.html#l00009">options_mod.f90:9</a></div></div>
<div class="ttc" id="anamespaceoptions__mod_html_a536448bfef7c5c838d79e714ca7bbb6a"><div class="ttname"><a href="namespaceoptions__mod.html#a536448bfef7c5c838d79e714ca7bbb6a">options_mod::get_missing_ok_status</a></div><div class="ttdeci">logical function, public get_missing_ok_status()</div><div class="ttdef"><b>Definition</b> <a href="options__mod_8f90_source.html#l00032">options_mod.f90:33</a></div></div>
<div class="ttc" id="anamespaceoptions__mod_html_a66a52ec2d5459c7cdb514f26ea6e1c68"><div class="ttname"><a href="namespaceoptions__mod.html#a66a52ec2d5459c7cdb514f26ea6e1c68">options_mod::set_missing_ok_status</a></div><div class="ttdeci">subroutine, public set_missing_ok_status(allow_missing)</div><div class="ttdef"><b>Definition</b> <a href="options__mod_8f90_source.html#l00023">options_mod.f90:24</a></div></div>
<div class="ttc" id="anamespaceprobit__transform__mod_html"><div class="ttname"><a href="namespaceprobit__transform__mod.html">probit_transform_mod</a></div><div class="ttdef"><b>Definition</b> <a href="probit__transform__mod_8f90_source.html#l00008">probit_transform_mod.f90:8</a></div></div>
<div class="ttc" id="anamespaceprobit__transform__mod_html_a3877b6f0aac0e1b3ea4162d37353e08a"><div class="ttname"><a href="namespaceprobit__transform__mod.html#a3877b6f0aac0e1b3ea4162d37353e08a">probit_transform_mod::transform_to_probit</a></div><div class="ttdeci">subroutine, public transform_to_probit(ens_size, state_ens_in, distribution_type, p, probit_ens, use_input_p, bounded_below, bounded_above, lower_bound, upper_bound)</div><div class="ttdef"><b>Definition</b> <a href="probit__transform__mod_8f90_source.html#l00097">probit_transform_mod.f90:99</a></div></div>
<div class="ttc" id="anamespaceprobit__transform__mod_html_a75a14657fa6d3bd74786f41d48c1ebf7"><div class="ttname"><a href="namespaceprobit__transform__mod.html#a75a14657fa6d3bd74786f41d48c1ebf7">probit_transform_mod::transform_from_probit</a></div><div class="ttdeci">subroutine, public transform_from_probit(ens_size, probit_ens, p, state_ens)</div><div class="ttdef"><b>Definition</b> <a href="probit__transform__mod_8f90_source.html#l00470">probit_transform_mod.f90:471</a></div></div>
<div class="ttc" id="anamespacequality__control__mod_html"><div class="ttname"><a href="namespacequality__control__mod.html">quality_control_mod</a></div><div class="ttdoc">quality_control_mod.f90</div><div class="ttdef"><b>Definition</b> <a href="quality__control__mod_8f90_source.html#l00011">quality_control_mod.f90:11</a></div></div>
<div class="ttc" id="anamespacequality__control__mod_html_a342c54d59c3177cff4f0a1b7c963728c"><div class="ttname"><a href="namespacequality__control__mod.html#a342c54d59c3177cff4f0a1b7c963728c">quality_control_mod::initialize_qc</a></div><div class="ttdeci">subroutine, public initialize_qc()</div><div class="ttdoc">Subroutine initialize_qc.</div><div class="ttdef"><b>Definition</b> <a href="quality__control__mod_8f90_source.html#l00075">quality_control_mod.f90:76</a></div></div>
<div class="ttc" id="anamespacerandom__seq__mod_html"><div class="ttname"><a href="namespacerandom__seq__mod.html">random_seq_mod</a></div><div class="ttdoc">Random number and random sequence routines. Can generate random draws from a uniform distribution or ...</div><div class="ttdef"><b>Definition</b> <a href="random__seq__mod_8f90_source.html#l00009">random_seq_mod.f90:9</a></div></div>
<div class="ttc" id="anamespacerandom__seq__mod_html_a70e7d279fc09edf6033d21e78dc41a3c"><div class="ttname"><a href="namespacerandom__seq__mod.html#a70e7d279fc09edf6033d21e78dc41a3c">random_seq_mod::random_gaussian</a></div><div class="ttdeci">real(r8) function, public random_gaussian(r, mean, standard_deviation)</div><div class="ttdoc">return a random draw from a gaussian distribution with the specified mean and standard deviation.</div><div class="ttdef"><b>Definition</b> <a href="random__seq__mod_8f90_source.html#l00118">random_seq_mod.f90:119</a></div></div>
<div class="ttc" id="anamespacerandom__seq__mod_html_a89f70b37eedada36ce65245a8c2f84e6"><div class="ttname"><a href="namespacerandom__seq__mod.html#a89f70b37eedada36ce65245a8c2f84e6">random_seq_mod::init_random_seq</a></div><div class="ttdeci">subroutine, public init_random_seq(r, seed)</div><div class="ttdoc">An integer seed can be used to get a particular repeatable sequence.</div><div class="ttdef"><b>Definition</b> <a href="random__seq__mod_8f90_source.html#l00080">random_seq_mod.f90:81</a></div></div>
<div class="ttc" id="anamespacestate__structure__mod_html"><div class="ttname"><a href="namespacestate__structure__mod.html">state_structure_mod</a></div><div class="ttdef"><b>Definition</b> <a href="state__structure__mod_8f90_source.html#l00007">state_structure_mod.f90:7</a></div></div>
<div class="ttc" id="anamespacestate__vector__io__mod_html"><div class="ttname"><a href="namespacestate__vector__io__mod.html">state_vector_io_mod</a></div><div class="ttdef"><b>Definition</b> <a href="state__vector__io__mod_8f90_source.html#l00005">state_vector_io_mod.f90:5</a></div></div>
<div class="ttc" id="anamespacetime__manager__mod_html"><div class="ttname"><a href="namespacetime__manager__mod.html">time_manager_mod</a></div><div class="ttdef"><b>Definition</b> <a href="time__manager__mod_8f90_source.html#l00005">time_manager_mod.f90:5</a></div></div>
<div class="ttc" id="anamespacetime__manager__mod_html_a49d0e8625bf9d4526a982406e7cd5415"><div class="ttname"><a href="namespacetime__manager__mod.html#a49d0e8625bf9d4526a982406e7cd5415">time_manager_mod::set_time</a></div><div class="ttdeci">type(time_type) function, public set_time(seconds, days)</div><div class="ttdef"><b>Definition</b> <a href="time__manager__mod_8f90_source.html#l00146">time_manager_mod.f90:147</a></div></div>
<div class="ttc" id="anamespacetime__manager__mod_html_a4f3d8b893f84f06cc655708c58098435"><div class="ttname"><a href="namespacetime__manager__mod.html#a4f3d8b893f84f06cc655708c58098435">time_manager_mod::print_time</a></div><div class="ttdeci">subroutine, public print_time(time, str, iunit)</div><div class="ttdef"><b>Definition</b> <a href="time__manager__mod_8f90_source.html#l02898">time_manager_mod.f90:2899</a></div></div>
<div class="ttc" id="anamespacetime__manager__mod_html_a579c796316d18ecb716c5face232cb8c"><div class="ttname"><a href="namespacetime__manager__mod.html#a579c796316d18ecb716c5face232cb8c">time_manager_mod::get_time</a></div><div class="ttdeci">subroutine, public get_time(time, seconds, days)</div><div class="ttdef"><b>Definition</b> <a href="time__manager__mod_8f90_source.html#l00203">time_manager_mod.f90:204</a></div></div>
<div class="ttc" id="anamespacetypes__mod_html"><div class="ttname"><a href="namespacetypes__mod.html">types_mod</a></div><div class="ttdoc">Should only have fortran &quot;kinds&quot; - number of bytes/precision - for integer, real, etc....</div><div class="ttdef"><b>Definition</b> <a href="types__mod_8f90_source.html#l00010">types_mod.f90:10</a></div></div>
<div class="ttc" id="anamespacetypes__mod_html_a1e2772ead7275ce0da368baa04c8cec7"><div class="ttname"><a href="namespacetypes__mod.html#a1e2772ead7275ce0da368baa04c8cec7">types_mod::max_num_doms</a></div><div class="ttdeci">integer, parameter, public max_num_doms</div><div class="ttdef"><b>Definition</b> <a href="types__mod_8f90_source.html#l00035">types_mod.f90:35</a></div></div>
<div class="ttc" id="anamespacetypes__mod_html_a2bcc059ce33ea404751ac973800ef87d"><div class="ttname"><a href="namespacetypes__mod.html#a2bcc059ce33ea404751ac973800ef87d">types_mod::max_files</a></div><div class="ttdeci">integer, parameter, public max_files</div><div class="ttdef"><b>Definition</b> <a href="types__mod_8f90_source.html#l00038">types_mod.f90:38</a></div></div>
<div class="ttc" id="anamespacetypes__mod_html_a4693e78690b9e434602f5a8634988ccf"><div class="ttname"><a href="namespacetypes__mod.html#a4693e78690b9e434602f5a8634988ccf">types_mod::metadatalength</a></div><div class="ttdeci">integer, parameter, public metadatalength</div><div class="ttdef"><b>Definition</b> <a href="types__mod_8f90_source.html#l00028">types_mod.f90:28</a></div></div>
<div class="ttc" id="anamespacetypes__mod_html_a487646d1dd17cda0f0920a943edfb077"><div class="ttname"><a href="namespacetypes__mod.html#a487646d1dd17cda0f0920a943edfb077">types_mod::missing_r8</a></div><div class="ttdeci">real(kind=r8), parameter, public missing_r8</div><div class="ttdef"><b>Definition</b> <a href="types__mod_8f90_source.html#l00115">types_mod.f90:115</a></div></div>
<div class="ttc" id="anamespacetypes__mod_html_aabae290db5d4b324aa0f5e30e7516c23"><div class="ttname"><a href="namespacetypes__mod.html#aabae290db5d4b324aa0f5e30e7516c23">types_mod::r8</a></div><div class="ttdeci">integer, parameter, public r8</div><div class="ttdef"><b>Definition</b> <a href="types__mod_8f90_source.html#l00084">types_mod.f90:84</a></div></div>
<div class="ttc" id="anamespacetypes__mod_html_abf1cb9466172ca1d02137e70ce1ae7e3"><div class="ttname"><a href="namespacetypes__mod.html#abf1cb9466172ca1d02137e70ce1ae7e3">types_mod::i8</a></div><div class="ttdeci">integer, parameter, public i8</div><div class="ttdef"><b>Definition</b> <a href="types__mod_8f90_source.html#l00078">types_mod.f90:78</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html"><div class="ttname"><a href="namespaceutilities__mod.html">utilities_mod</a></div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00005">utilities_mod.f90:5</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_a12b6bcff9ee2f6b821e7a01543fb0dfa"><div class="ttname"><a href="namespaceutilities__mod.html#a12b6bcff9ee2f6b821e7a01543fb0dfa">utilities_mod::error_handler</a></div><div class="ttdeci">subroutine, public error_handler(level, routine, text, src, rev, rdate, aut, text2, text3)</div><div class="ttdoc">write to log and/or standard output, messages, warnings, debug, errors</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00749">utilities_mod.f90:750</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_a2e4229a51f48d48570bb0b7d304662c3"><div class="ttname"><a href="namespaceutilities__mod.html#a2e4229a51f48d48570bb0b7d304662c3">utilities_mod::nmlfileunit</a></div><div class="ttdeci">integer, public nmlfileunit</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00031">utilities_mod.f90:31</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_a3cd818255d7f98765915ab676582b413"><div class="ttname"><a href="namespaceutilities__mod.html#a3cd818255d7f98765915ab676582b413">utilities_mod::to_upper</a></div><div class="ttdeci">subroutine, public to_upper(string)</div><div class="ttdoc">convert a string to upper case in place</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l01326">utilities_mod.f90:1327</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_a57146d1bf098cd251ef93abb838d1f30"><div class="ttname"><a href="namespaceutilities__mod.html#a57146d1bf098cd251ef93abb838d1f30">utilities_mod::do_nml_term</a></div><div class="ttdeci">logical function, public do_nml_term()</div><div class="ttdoc">return whether nml should be written to terminal for more details see above.</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00365">utilities_mod.f90:366</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_a77ad7301456803b1c560cd7c75a37549"><div class="ttname"><a href="namespaceutilities__mod.html#a77ad7301456803b1c560cd7c75a37549">utilities_mod::open_file</a></div><div class="ttdeci">integer function, public open_file(fname, form, action, access, convert, delim, reclen, return_rc)</div><div class="ttdoc">open a file. assigns a unit number to be used for subsequent read/writes. can open an existing file,...</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00846">utilities_mod.f90:847</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_a7f7028c1f8fd499c0964b9955a7c0149"><div class="ttname"><a href="namespaceutilities__mod.html#a7f7028c1f8fd499c0964b9955a7c0149">utilities_mod::logfileunit</a></div><div class="ttdeci">integer, public logfileunit</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00030">utilities_mod.f90:30</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_a8c75319605f966dfc2e15e203d92c6a7"><div class="ttname"><a href="namespaceutilities__mod.html#a8c75319605f966dfc2e15e203d92c6a7">utilities_mod::e_err</a></div><div class="ttdeci">integer, parameter, public e_err</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00020">utilities_mod.f90:20</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_aaa23ed1a0469bb9addcd0de6c52645b8"><div class="ttname"><a href="namespaceutilities__mod.html#aaa23ed1a0469bb9addcd0de6c52645b8">utilities_mod::close_file</a></div><div class="ttdeci">subroutine, public close_file(iunit)</div><div class="ttdoc">Closes the given unit_number if that unit is open. Not an error to call on an already closed unit....</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l01004">utilities_mod.f90:1005</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_ad297e7b3a121a9c280417846a9198ac9"><div class="ttname"><a href="namespaceutilities__mod.html#ad297e7b3a121a9c280417846a9198ac9">utilities_mod::timestamp</a></div><div class="ttdeci">subroutine, public timestamp(string1, string2, string3, pos)</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l01089">utilities_mod.f90:1090</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_ad4d01f7f0f751b03c2480fb100dc7c6a"><div class="ttname"><a href="namespaceutilities__mod.html#ad4d01f7f0f751b03c2480fb100dc7c6a">utilities_mod::find_namelist_in_file</a></div><div class="ttdeci">subroutine, public find_namelist_in_file(namelist_file_name, nml_name, iunit)</div><div class="ttdoc">Opens namelist_file_name if it exists on unit iunit, error if it doesn't exist. Searches file for a l...</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00388">utilities_mod.f90:389</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_ada0bc0fbdb62dda0a03f7b23a7de35aa"><div class="ttname"><a href="namespaceutilities__mod.html#ada0bc0fbdb62dda0a03f7b23a7de35aa">utilities_mod::do_nml_file</a></div><div class="ttdeci">logical function, public do_nml_file()</div><div class="ttdoc">unfortunately you can't pass a namelist as an argument, so all modules with namelists have to call wr...</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00347">utilities_mod.f90:348</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_ada43bd6e7099952a626e082d7fa0e440"><div class="ttname"><a href="namespaceutilities__mod.html#ada43bd6e7099952a626e082d7fa0e440">utilities_mod::check_namelist_read</a></div><div class="ttdeci">subroutine, public check_namelist_read(iunit, iostat_in, nml_name)</div><div class="ttdoc">Confirms that a namelist read was successful. If it failed produces an error message and stops execut...</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00452">utilities_mod.f90:453</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_ae5919d9aaedac3ac4128d1d68ed05769"><div class="ttname"><a href="namespaceutilities__mod.html#ae5919d9aaedac3ac4128d1d68ed05769">utilities_mod::do_output</a></div><div class="ttdeci">logical function, public do_output()</div><div class="ttdoc">return whether output should be written from this task</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l01254">utilities_mod.f90:1255</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_ae928d8495bb269d07c2d8ae26390c5b2"><div class="ttname"><a href="namespaceutilities__mod.html#ae928d8495bb269d07c2d8ae26390c5b2">utilities_mod::e_dbg</a></div><div class="ttdeci">integer, parameter, public e_dbg</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00020">utilities_mod.f90:20</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_ae943a84ea3b7e8579a41d1f744f4be7f"><div class="ttname"><a href="namespaceutilities__mod.html#ae943a84ea3b7e8579a41d1f744f4be7f">utilities_mod::find_textfile_dims</a></div><div class="ttdeci">subroutine, public find_textfile_dims(fname, nlines, linelen)</div><div class="ttdoc">Determines the number of lines and maximum line length of an ascii file.</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l01369">utilities_mod.f90:1370</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_aeafbbb638346cc6ff201d3d9db2ee25b"><div class="ttname"><a href="namespaceutilities__mod.html#aeafbbb638346cc6ff201d3d9db2ee25b">utilities_mod::set_multiple_filename_lists</a></div><div class="ttdeci">subroutine, public set_multiple_filename_lists(name_array, listname, nlists, nentries, caller_name, origin, origin_list)</div><div class="ttdoc">this function is intended to be used when there are 2 ways to specify a KNOWN number of input files,...</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l01664">utilities_mod.f90:1666</a></div></div>
<div class="ttc" id="anamespaceutilities__mod_html_afd52af74c5cda039bd8cb1043678f854"><div class="ttname"><a href="namespaceutilities__mod.html#afd52af74c5cda039bd8cb1043678f854">utilities_mod::e_msg</a></div><div class="ttdeci">integer, parameter, public e_msg</div><div class="ttdef"><b>Definition</b> <a href="utilities__mod_8f90_source.html#l00020">utilities_mod.f90:20</a></div></div>
<div class="ttc" id="astructadaptive__inflate__mod_1_1adaptive__inflate__type_html"><div class="ttname"><a href="structadaptive__inflate__mod_1_1adaptive__inflate__type.html">adaptive_inflate_mod::adaptive_inflate_type</a></div><div class="ttdef"><b>Definition</b> <a href="adaptive__inflate__mod_8f90_source.html#l00069">adaptive_inflate_mod.f90:69</a></div></div>
<div class="ttc" id="astructdistribution__params__mod_1_1distribution__params__type_html"><div class="ttname"><a href="structdistribution__params__mod_1_1distribution__params__type.html">distribution_params_mod::distribution_params_type</a></div><div class="ttdef"><b>Definition</b> <a href="distribution__params__mod_8f90_source.html#l00010">distribution_params_mod.f90:10</a></div></div>
<div class="ttc" id="astructensemble__manager__mod_1_1ensemble__type_html"><div class="ttname"><a href="structensemble__manager__mod_1_1ensemble__type.html">ensemble_manager_mod::ensemble_type</a></div><div class="ttdef"><b>Definition</b> <a href="ensemble__manager__mod_8f90_source.html#l00047">ensemble_manager_mod.f90:47</a></div></div>
<div class="ttc" id="astructio__filenames__mod_1_1file__info__type_html"><div class="ttname"><a href="structio__filenames__mod_1_1file__info__type.html">io_filenames_mod::file_info_type</a></div><div class="ttdef"><b>Definition</b> <a href="io__filenames__mod_8f90_source.html#l00179">io_filenames_mod.f90:179</a></div></div>
<div class="ttc" id="astructlocation__mod_1_1location__type_html"><div class="ttname"><a href="structlocation__mod_1_1location__type.html">location_mod::location_type</a></div><div class="ttdef"><b>Definition</b> <a href="annulus_2location__mod_8f90_source.html#l00038">location_mod.f90:38</a></div></div>
<div class="ttc" id="astructobs__def__mod_1_1obs__def__type_html"><div class="ttname"><a href="structobs__def__mod_1_1obs__def__type.html">obs_def_mod::obs_def_type</a></div><div class="ttdef"><b>Definition</b> <a href="obs__def__mod_8f90_source.html#l01756">obs_def_mod.f90:1756</a></div></div>
<div class="ttc" id="astructobs__sequence__mod_1_1obs__sequence__type_html"><div class="ttname"><a href="structobs__sequence__mod_1_1obs__sequence__type.html">obs_sequence_mod::obs_sequence_type</a></div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00091">obs_sequence_mod.f90:91</a></div></div>
<div class="ttc" id="astructobs__sequence__mod_1_1obs__type_html"><div class="ttname"><a href="structobs__sequence__mod_1_1obs__type.html">obs_sequence_mod::obs_type</a></div><div class="ttdef"><b>Definition</b> <a href="obs__sequence__mod_8f90_source.html#l00109">obs_sequence_mod.f90:109</a></div></div>
<div class="ttc" id="astructrandom__seq__mod_1_1random__seq__type_html"><div class="ttname"><a href="structrandom__seq__mod_1_1random__seq__type.html">random_seq_mod::random_seq_type</a></div><div class="ttdef"><b>Definition</b> <a href="random__seq__mod_8f90_source.html#l00058">random_seq_mod.f90:58</a></div></div>
<div class="ttc" id="astructstate__vector__io__mod_1_1stages__to__write_html"><div class="ttname"><a href="structstate__vector__io__mod_1_1stages__to__write.html">state_vector_io_mod::stages_to_write</a></div><div class="ttdef"><b>Definition</b> <a href="state__vector__io__mod_8f90_source.html#l00097">state_vector_io_mod.f90:97</a></div></div>
<div class="ttc" id="astructtime__manager__mod_1_1time__type_html"><div class="ttname"><a href="structtime__manager__mod_1_1time__type.html">time_manager_mod::time_type</a></div><div class="ttdef"><b>Definition</b> <a href="time__manager__mod_8f90_source.html#l00105">time_manager_mod.f90:105</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
